const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KlineChart-TjQ_Ifr8.js","assets/react-mui-B8w-7gqd.js","assets/vendor-CTCyfRUx.js","assets/charts--AwToQQJ.js"])))=>i.map(i=>d[i]);
import{r as x,u as Fn,a as He,j as t,B as H,D as Re,c as Be,T as un,P as Ie,b as hn,d as fn,e as je,f as W,S as Le,v as Ve,g as gn,R as _e,h as Ke,C as Jt,I as ce,M as Qe,i as Ye,k as dt,l as St,m as Tt,n as Ct,o as pt,p as Dt,q as F,s as Z,F as Zt,t as ae,w as In,A as we,x as qn,y as Ue,z as Ge,E as pn,G as Mn,H as Je,J as zn,K as Pn,L as En,N as mn,O as xn,Q as Nn,V as Wn,U as Hn,W as Ze,X as Rn,Y as me,Z as Bn,_ as Ln,$ as Vn,a0 as Kn,a1 as Qn,a2 as Xe,a3 as tn,a4 as en,a5 as Yn,a6 as Ae,a7 as Un}from"./react-mui-B8w-7gqd.js";import"./vendor-CTCyfRUx.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))g(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&g(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function g(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();const Gn="modulepreload",Jn=function(e){return"/"+e},nn={},qe=function(n,r,g){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(r.map(C=>{if(C=Jn(C),C in nn)return;nn[C]=!0;const v=C.endsWith(".css"),A=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${C}"]${A}`))return;const u=document.createElement("link");if(u.rel=v?"stylesheet":Gn,v||(u.as="script"),u.crossOrigin="",u.href=C,l&&u.setAttribute("nonce",l),document.head.appendChild(u),v)return new Promise((m,_)=>{u.addEventListener("load",m),u.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${C}`)))})}))}function c(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return o.then(i=>{for(const l of i||[])l.status==="rejected"&&c(l.reason);return n().catch(c)})};function sn(e){if(!e||e.length===0)return[0,0];let n=0,r=0;for(const o of e){const c=Number(o.quantity)||0,i=Number(o.price)||0;if(c!==0&&i>0){const l=c*i;r+=l,n+=c}}n=Math.max(0,n);const g=n>0?r/n:0;return[n,g]}function yn(e){return/^[A-Z]{1,5}$/.test(e)}function Zn(e){return yn(e)?e:e.startsWith("00")||e.startsWith("30")?`sz${e}`:`sh${e}`}function ke(e){return e==null?"--":e.toFixed(2)}const Xn=x.lazy(()=>qe(()=>import("./KlineChart-TjQ_Ifr8.js"),__vite__mapDeps([0,1,2,3])).then(e=>({default:e.KlineChart}))),ts=({stock:e,children:n})=>{const{attributes:r,listeners:g,setNodeRef:o,transform:c,transition:i,isDragging:l}=mn({id:e.code}),C={transform:xn.Transform.toString(c),transition:i,opacity:l?.5:1};return t.jsx(je,{ref:o,style:C,sx:{...l&&{backgroundColor:"rgba(0, 0, 0, 0.05)"},"&:nth-of-type(odd)":{backgroundColor:"#f5f5f5"},"&:hover":{backgroundColor:"#e3f2fd"},borderBottom:"none !important",borderTop:"none !important","& td":{borderBottom:"none !important",borderTop:"none !important"}},children:n({attributes:r,listeners:g,isDragging:l})})},es=({stocks:e,privacyMode:n,config:r,onConfigUpdate:g,onAddTransaction:o,onOpenAllTransactionsDialog:c,onToggleCategorySidebar:i})=>{var ye;const[l,C]=x.useState(new Set),[v,A]=x.useState(!1),[u,m]=x.useState(null),[_,I]=x.useState(""),[E,Q]=x.useState(null),[st,U]=x.useState(""),[L,it]=x.useState(null),[tt,at]=x.useState(null),[Y,lt]=x.useState(null),[Mt,Et]=x.useState(!1),[Ot,j]=x.useState([]),[D,$]=x.useState(null),V=s=>{const d=(r.categories||{})[s];return(d==null?void 0:d.isDefault)===!0},S=s=>{const d=(r.categories||{})[s];return(d==null?void 0:d.isHoldings)===!0},M=s=>V(s)||S(s),T=()=>{const s=r.categories||{};for(const[h,d]of Object.entries(s))if(d.isDefault===!0)return h;return null},J=()=>{const s=r.categories||{};for(const[h,d]of Object.entries(s))if(d.isHoldings===!0)return h;return null},ut=()=>{const s=r.categories||{},h=Object.keys(s),d=T(),f=J(),b=[],k=[];for(const B of h)B===d?b.unshift(B):B===f?b.push(B):k.push(B);return k.sort(),[...b,...k]};x.useEffect(()=>{const s=ut();if(s.length>1&&Y===null){const h=T();h&&s.includes(h)?lt(h):s.length>0&&lt(s[0])}},[r.categories,Y]),x.useEffect(()=>{const s=()=>{Et(h=>!h)};return i&&i(s),window.__toggleCategorySidebar=s,()=>{window.__toggleCategorySidebar&&delete window.__toggleCategorySidebar}},[i]);const q=["#1976d2","#2e7d32","#ed6c02","#9c27b0","#c62828","#1565c0","#388e3c","#f57c00","#7b1fa2","#d32f2f"],rt=Fn(He(En),He(Pn,{coordinateGetter:zn})),Ft=s=>{const{active:h,over:d}=s;if(d&&h.id!==d.id){const f=e.findIndex(O=>O.code===h.id),b=e.findIndex(O=>O.code===d.id);if(f===-1||b===-1)return;const k=r.stock_order||e.map(O=>O.code),B=e.map(O=>O.code),et=[...k.filter(O=>B.includes(O)),...B.filter(O=>!k.includes(O))],ht=et.findIndex(O=>O===h.id),X=et.findIndex(O=>O===d.id);if(ht===-1||X===-1)return;const nt=Je(et,ht,X),wt={...r,stock_order:nt};g(wt).then(()=>{console.log("æ’åºé¡ºåºå·²ä¿å­˜:",nt)}).catch(O=>{console.error("ä¿å­˜æ’åºé¡ºåºå¤±è´¥:",O)})}},[ot,bt]=x.useState(null),[zt,z]=x.useState(null),[yt,ct]=x.useState(null),[Kt,Rt]=x.useState("refund"),[xt,vt]=x.useState(null),[Pt,Bt]=x.useState(null),[jt,mt]=x.useState({time:"",quantity:"",totalAmount:""}),Qt=s=>s>0?"error":s<0?"success":"default",ue=s=>s===null?"default":s>0?"error":s<0?"success":"default",Yt=()=>{if(!ot)return;const{stockCode:s,index:h,transaction:d}=ot,f=parseFloat(jt.quantity),b=parseFloat(jt.totalAmount);if(isNaN(f)||f===0||isNaN(b)||b<=0||!jt.time)return;const k=b/Math.abs(f);if(f<0){const It=r.holdings[s];if(It){const oe=Array.isArray(It.transactions)?It.transactions:[];let a=0;for(let y=0;y<oe.length;y++)y!==h&&(a+=Number(oe[y].quantity)||0);const p=a+f;if(p<0){alert(`æŒä»“ä¸è¶³ï¼Œä¿®æ”¹åæŒä»“ï¼š${p.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(f).toFixed(0)}`);return}}}const B=r.holdings[s];if(!B)return;const et=d.totalAmount??Math.abs(d.quantity)*d.price,ht=d.quantity>0?-et:et,X=f>0?-b:b,nt=ht-X,wt=[...B.transactions];wt[h]={id:d.id,time:jt.time,quantity:f,price:k,totalAmount:b};const O=r.funds.available_funds+nt,$t={...r,funds:{...r.funds,available_funds:Math.max(0,O)},holdings:{...r.holdings,[s]:{...B,transactions:wt}}};g($t).then(()=>{bt(null),mt({time:"",quantity:"",totalAmount:""})})},he=async()=>{if(!zt)return;const{stockCode:s,index:h}=zt,d=r.holdings[s];if(!d)return;const f=d.transactions[h],b=f.totalAmount??Math.abs(f.quantity)*f.price;if(f.id){const{deleteTransaction:ht}=await qe(async()=>{const{deleteTransaction:X}=await Promise.resolve().then(()=>ds);return{deleteTransaction:X}},void 0);await ht(f.id)}const k=d.transactions.filter((ht,X)=>X!==h),B=f.quantity>0?r.funds.available_funds+b:r.funds.available_funds-b,et={...r,funds:{...r.funds,available_funds:B},holdings:{...r.holdings,[s]:{...d,transactions:k}}};g(et).then(()=>{z(null)})},Ut=s=>{ct(s)},fe=()=>{if(!xt)return;const{stockCode:s,alerts:h}=xt,d=[];for(const b of h){const k=parseFloat(b.price.trim());!isNaN(k)&&k>0&&d.push({type:b.type,price:k})}const f={...r,holdings:{...r.holdings},watchlist:{...r.watchlist}};f.holdings[s]?f.holdings[s]={...f.holdings[s],alerts:d.length>0?d:void 0}:f.watchlist[s]?f.watchlist[s]={...f.watchlist[s],alerts:d.length>0?d:void 0}:f.watchlist[s]={alerts:d.length>0?d:void 0},vt(null),g(f)},Lt=s=>{const h=r.watchlist[s];if(h!=null&&h.categories&&h.categories.length>0)return h.categories;const d=r.categories||{},f=T();if(f){const k=d[f];if(k&&(k.codes||[]).includes(s))return[f]}const b=[];for(const[k,B]of Object.entries(d))(B.codes||[]).includes(s)&&b.push(k);return b.length>0?b:f?[f]:[]},ge=s=>{const d=(r.categories||{})[s];return(d==null?void 0:d.title)||s},Gt=s=>{const d=(r.categories||{})[s];return(d==null?void 0:d.color)||"#1976d2"},se=s=>{const d=(r.categories||{})[s];return((d==null?void 0:d.codes)||[]).length},ie=()=>{if(!yt)return;const s=yt,h=e.find(O=>O.code===s);if(h!=null&&h.name,Lt(s).length>1){const O={...r.categories};for(const oe of Object.keys(O)){const a=O[oe];a&&a.codes&&(O[oe]={...a,codes:a.codes.filter(p=>p!==s)})}const $t={...r.watchlist};$t[s]&&($t[s]={...$t[s],categories:[]});const It={...r,categories:O,watchlist:$t};g(It).then(()=>{ct(null),Rt("refund"),U("å·²ä»å½“å‰åˆ†ç±»åˆ é™¤")});return}let b=0;if(r.holdings[s]){const O=r.holdings[s];O.transactions,b=O.transactions.reduce(($t,It)=>$t+It.quantity*It.price,0)}const k={...r.holdings};delete k[s];const B={...r.watchlist};let et=r.funds.available_funds;if(Kt==="refund")et=r.funds.available_funds+b,delete B[s];else if(!B[s]){const O=r.holdings[s];B[s]={alerts:O==null?void 0:O.alerts,alert_up:(O==null?void 0:O.alert_up)||null,alert_down:(O==null?void 0:O.alert_down)||null}}const ht={...r.categories};for(const O of Object.keys(ht)){const $t=ht[O];$t&&$t.codes&&(ht[O]={...$t,codes:$t.codes.filter(It=>It!==s)})}const nt=(r.stock_order||[]).filter(O=>O!==s),wt={...r,stock_order:nt,categories:ht,funds:{...r.funds,available_funds:et},holdings:k,watchlist:B,historical_holdings:[]};g(wt).then(()=>{ct(null),Rt("refund")})},pe=s=>{const{active:h,over:d}=s;if(d&&h.id!==d.id){const f=Ot.findIndex(wt=>wt===h.id),b=Ot.findIndex(wt=>wt===d.id);if(f===-1||b===-1)return;const k=T(),B=J(),et=k?Ot.indexOf(k):-1,ht=B?Ot.indexOf(B):-1;if(h.id===k||h.id===B)return;const X=Math.max(et,ht)+1;if(b<X)return;const nt=Je(Ot,f,b);j(nt)}},re=()=>{const s=ut();if(Ot.length===0)return s;const h=[],d=new Set;for(const f of Ot)s.includes(f)&&(h.push(f),d.add(f));for(const f of s)d.has(f)||h.push(f);return h};return t.jsxs(H,{sx:{display:"flex",gap:1},children:[t.jsx(H,{sx:{flex:Mt?"0 0 calc(100% - 200px)":"1 1 auto",transition:"flex 0.3s"},children:t.jsx(Re,{sensors:rt,collisionDetection:Be,onDragEnd:Ft,children:t.jsx(un,{component:Ie,children:t.jsxs(hn,{size:"small",sx:{minWidth:650,borderCollapse:"collapse"},children:[t.jsx(fn,{children:t.jsxs(je,{sx:{backgroundColor:"#1976d2"},children:[t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:40,p:.25,borderBottom:"none !important"}}),t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:140,p:.25,borderBottom:"none !important"},children:"åç§°"}),t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:100,p:.25,borderBottom:"none !important"},children:"ä»£ç "}),t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:80,p:.25,borderBottom:"none !important"},children:"ç°ä»·"}),t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:80,p:.25,borderBottom:"none !important"},children:"æ¶¨è·Œå¹…"}),t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:80,p:.25,borderBottom:"none !important"},children:"æˆæœ¬ä»·"}),t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:80,p:.25,borderBottom:"none !important"},children:"æ•°é‡"}),t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:200,p:.25,borderBottom:"none !important"},children:"ç›ˆäº"}),t.jsx(W,{sx:{color:"white",fontWeight:"bold",width:40,p:.25,borderBottom:"none !important"},children:"æ“ä½œ"})]})}),t.jsx(Le,{items:(()=>{let s=e;if(Y){const d=(r.categories||{})[Y];if(d&&d.codes){const f=new Set(d.codes);s=e.filter(b=>f.has(b.code))}}return s.map(h=>h.code)})(),strategy:Ve,children:t.jsx(gn,{children:(()=>{let s=e;if(Y){const d=(r.categories||{})[Y];if(d&&d.codes){const f=new Set(d.codes);s=e.filter(b=>f.has(b.code))}}return s})().map(s=>{s.last_price!==null&&s.holding_quantity>0&&s.last_price*s.holding_quantity;const h=s.holding_price!==null&&s.holding_quantity>0&&s.last_price!==null?(s.last_price-s.holding_price)*s.holding_quantity:null,d=s.holding_price!==null&&s.holding_price>0&&h!==null?h/(s.holding_price*s.holding_quantity)*100:null,f=h!==null&&d!==null?n?`***(${d.toFixed(2)}%)`:`${h.toFixed(2)}(${d.toFixed(2)}%)`:"--";return l.has(s.code),t.jsx(_e.Fragment,{children:t.jsx(ts,{stock:s,children:({attributes:b,listeners:k})=>t.jsxs(t.Fragment,{children:[t.jsx(W,{sx:{p:.25,cursor:"grab","&:active":{cursor:"grabbing"},borderBottom:"none !important"},...b,...k,children:t.jsx(Ke,{sx:{color:"text.secondary",fontSize:20}})}),t.jsx(W,{sx:{p:.25,borderBottom:"none !important"},children:n?"***":s.name}),t.jsx(W,{sx:{p:.25,borderBottom:"none !important"},children:n?"***":s.code}),t.jsx(W,{sx:{p:.25,borderBottom:"none !important"},children:s.last_price!==null?ke(s.last_price):"--"}),t.jsx(W,{sx:{p:.25,borderBottom:"none !important"},children:t.jsx(Jt,{label:`${s.last_change_pct>=0?"+":""}${s.last_change_pct.toFixed(2)}%`,color:Qt(s.last_change_pct),size:"small",sx:{height:20,fontSize:"0.75rem"}})}),t.jsx(W,{sx:{p:.25,borderBottom:"none !important"},children:s.holding_price!==null?n?"***":ke(s.holding_price):"--"}),t.jsx(W,{sx:{p:.25,borderBottom:"none !important"},children:s.holding_quantity>0?n?"***":String(Math.floor(s.holding_quantity)):"--"}),t.jsx(W,{sx:{p:.25,borderBottom:"none !important"},children:t.jsx(Jt,{label:f,color:ue(h),size:"small",sx:{height:20,fontSize:"0.75rem"}})}),t.jsx(W,{sx:{p:.25,borderBottom:"none !important"},children:t.jsx(H,{sx:{display:"flex",alignItems:"center",gap:0},children:t.jsx(ce,{size:"small",onClick:B=>{$({el:B.currentTarget,stockCode:s.code})},sx:{p:.5},children:t.jsx(Qe,{fontSize:"small"})})})})]})})},s.code)})})})]})})})}),Mt&&t.jsx(H,{sx:{flex:"0 0 200px",border:"1px solid #e0e0e0",borderRadius:0,backgroundColor:"#f5f5f5",p:1},children:t.jsx(Re,{sensors:rt,collisionDetection:Be,onDragEnd:pe,children:t.jsx(Le,{items:re(),strategy:Ve,children:t.jsx(H,{sx:{display:"flex",flexDirection:"column",gap:.5},children:re().map(s=>{const h=M(s),d=Y===s,f=()=>{const{attributes:b,listeners:k,setNodeRef:B,transform:et,transition:ht,isDragging:X}=mn({id:s,disabled:h}),nt={transform:xn.Transform.toString(et),transition:ht,opacity:X?.5:1};return t.jsxs(H,{ref:B,style:nt,sx:{display:"flex",alignItems:"center",gap:.5,p:.5,backgroundColor:d?`${Gt(s)}20`:"transparent",borderRadius:0,cursor:d?"default":"pointer","&:hover":{backgroundColor:d?`${Gt(s)}30`:"rgba(0, 0, 0, 0.04)"}},children:[!h&&t.jsx(H,{...b,...k,sx:{cursor:"grab","&:active":{cursor:"grabbing"}},children:t.jsx(Ke,{sx:{color:"text.secondary",fontSize:16}})}),t.jsx(F,{size:"small",onClick:()=>{lt(s)},sx:{flex:1,justifyContent:"flex-start",color:d?Gt(s):"text.primary",textTransform:"none",minWidth:"auto",padding:"4px 8px",fontSize:"0.875rem",fontWeight:d?"bold":"normal"},children:ge(s)}),t.jsx(ce,{size:"small",onClick:wt=>{it({el:wt.currentTarget,categoryName:s})},sx:{padding:"2px"},children:t.jsx(Qe,{fontSize:"small"})})]})};return t.jsx(f,{},s)})})})})}),t.jsx(Ye,{anchorEl:D==null?void 0:D.el,open:!!D,onClose:()=>$(null),children:D&&(()=>{const s=e.find(f=>f.code===D.stockCode);if(!s)return null;const h=r.holdings[s.code],d=r.watchlist[s.code];return t.jsxs(t.Fragment,{children:[t.jsx(dt,{onClick:()=>{c&&c(s.code),$(null)},sx:{py:.25,fontSize:"0.875rem"},children:"äº¤æ˜“åˆ—è¡¨"}),t.jsx(dt,{onClick:()=>{const b=Lt(s.code).filter(k=>!S(k));m({stockCode:s.code,categories:[...b]}),A(!0),$(null)},sx:{py:.25,fontSize:"0.875rem"},children:"åˆ†ç»„"}),t.jsx(dt,{onClick:()=>{Bt({stockCode:s.code,stockName:s.name}),$(null)},sx:{py:.25,fontSize:"0.875rem"},children:"Kå›¾"}),t.jsx(dt,{onClick:()=>{const f=[];if(h!=null&&h.alerts&&h.alerts.length>0)h.alerts.forEach(b=>{f.push({type:b.type,price:b.price.toString()})});else if(d!=null&&d.alerts&&d.alerts.length>0)d.alerts.forEach(b=>{f.push({type:b.type,price:b.price.toString()})});else{const b=(h==null?void 0:h.alert_up)??(d==null?void 0:d.alert_up)??null,k=(h==null?void 0:h.alert_down)??(d==null?void 0:d.alert_down)??null;b!==null&&f.push({type:"up",price:b.toString()}),k!==null&&f.push({type:"down",price:k.toString()})}f.length===0&&f.push({type:"up",price:""}),vt({stockCode:s.code,alerts:f}),$(null)},sx:{py:.25,fontSize:"0.875rem"},children:"æŠ¥è­¦"}),t.jsx(dt,{onClick:()=>{Ut(s.code),$(null)},sx:{py:.25,fontSize:"0.875rem",color:"error.main"},children:"åˆ é™¤"})]})})()}),t.jsxs(St,{open:!!ot,onClose:()=>bt(null),maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.25,pt:.5,px:1},children:"ç¼–è¾‘äº¤æ˜“è®°å½•"}),t.jsx(Ct,{sx:{pt:.25,px:1},children:t.jsxs(H,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx(pt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",size:"small",fullWidth:!0,variant:"outlined",value:jt.time?(()=>{try{const s=new Date(jt.time),h=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),f=String(s.getDate()).padStart(2,"0"),b=String(s.getHours()).padStart(2,"0"),k=String(s.getMinutes()).padStart(2,"0");return`${h}-${d}-${f}T${b}:${k}`}catch{return""}})():"",onChange:s=>{const h=s.target.value;if(h){const d=new Date(h),f=d.getFullYear(),b=String(d.getMonth()+1).padStart(2,"0"),k=String(d.getDate()).padStart(2,"0"),B=String(d.getHours()).padStart(2,"0"),et=String(d.getMinutes()).padStart(2,"0"),ht=String(d.getSeconds()).padStart(2,"0");mt({...jt,time:`${f}-${b}-${k} ${B}:${et}:${ht}`})}},InputLabelProps:{shrink:!0}}),t.jsx(pt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:jt.quantity,onChange:s=>{const h=s.target.value;(h===""||h==="-"||/^-?\d*\.?\d*$/.test(h))&&mt({...jt,quantity:h})},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡º"}),t.jsx(pt,{label:"å•ä»·",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:jt.price,onChange:s=>mt({...jt,price:s.target.value}),inputProps:{min:0,step:.001}})]})}),t.jsxs(Dt,{sx:{px:1,pb:.25,pt:.25},children:[t.jsx(F,{size:"small",onClick:()=>bt(null),sx:{py:.25,px:1},children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:Yt,variant:"contained",sx:{py:.25,px:1},children:"ä¿å­˜"})]})]}),t.jsxs(St,{open:!!zt,onClose:()=>z(null),maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.25,pt:.5,px:1},children:"ç¡®è®¤åˆ é™¤"}),t.jsx(Ct,{sx:{pt:.25,px:1},children:t.jsx(Z,{variant:"body2",children:"ç¡®å®šè¦åˆ é™¤è¿™æ¡äº¤æ˜“è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"})}),t.jsxs(Dt,{sx:{px:1,pb:.25,pt:.25},children:[t.jsx(F,{size:"small",onClick:()=>z(null),sx:{py:.25,px:1},children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:he,variant:"contained",color:"error",sx:{py:.25,px:1},children:"åˆ é™¤"})]})]}),t.jsxs(St,{open:!!xt,onClose:()=>vt(null),maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"æŠ¥è­¦é…ç½®"}),t.jsx(Ct,{sx:{pt:.5},children:xt&&t.jsxs(t.Fragment,{children:[t.jsx(Z,{variant:"body2",sx:{color:"text.secondary"},children:"è®¾ç½®ä»·æ ¼æŠ¥è­¦è§„åˆ™ï¼Œå½“è‚¡ä»·è¾¾åˆ°è®¾å®šä»·æ ¼æ—¶ä¼šå‘å‡ºæé†’ã€‚å¯ä»¥æ·»åŠ å¤šæ¡è§„åˆ™ã€‚"}),xt.alerts.map((s,h)=>t.jsxs(H,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(Zt,{size:"small",sx:{minWidth:100},children:t.jsxs(ae,{value:s.type,onChange:d=>{const f=[...xt.alerts];f[h].type=d.target.value,vt({...xt,alerts:f})},children:[t.jsx(dt,{value:"up",children:"ä¸Šæ¶¨"}),t.jsx(dt,{value:"down",children:"ä¸‹è·Œ"})]})}),t.jsx(pt,{label:"é‡‘é¢",type:"number",size:"small",fullWidth:!0,value:s.price,onChange:d=>{const f=[...xt.alerts];f[h].price=d.target.value,vt({...xt,alerts:f})},placeholder:"æŠ¥è­¦ä»·æ ¼",inputProps:{step:"0.01",min:"0"}}),t.jsx(ce,{size:"small",onClick:()=>{const d=xt.alerts.filter((f,b)=>b!==h);d.length===0&&d.push({type:"up",price:""}),vt({...xt,alerts:d})},color:"error",children:t.jsx(In,{})})]},h)),t.jsx(F,{size:"small",startIcon:t.jsx(we,{}),onClick:()=>{vt({...xt,alerts:[...xt.alerts,{type:"up",price:""}]})},children:"æ·»åŠ è§„åˆ™"})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:()=>vt(null),children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:fe,variant:"contained",children:"ä¿å­˜"})]})]}),t.jsxs(St,{open:!!yt,onClose:()=>{ct(null),Rt("refund")},maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"ç¡®è®¤åˆ é™¤è‡ªé€‰è‚¡"}),t.jsxs(Ct,{sx:{pt:.5},children:[t.jsx(Z,{variant:"body2",children:"ç¡®å®šè¦åˆ é™¤è¯¥è‡ªé€‰è‚¡å—ï¼Ÿè¯·é€‰æ‹©åˆ é™¤æ–¹å¼ï¼š"}),(!yt||Lt(yt).length<=1)&&t.jsx(Zt,{component:"fieldset",children:t.jsxs(qn,{value:Kt,onChange:s=>Rt(s.target.value),children:[t.jsx(Ue,{value:"refund",control:t.jsx(Ge,{}),label:t.jsxs(H,{children:[t.jsx(Z,{variant:"body1",sx:{fontWeight:"bold"},children:"åˆ é™¤å¹¶é€€å›æ‰€æœ‰äº¤æ˜“"}),t.jsx(Z,{variant:"body2",color:"text.secondary",children:"åˆ é™¤è¯¥è‚¡ç¥¨çš„æ‰€æœ‰äº¤æ˜“è®°å½•ï¼Œå¹¶å°†äº¤æ˜“é‡‘é¢é€€å›å¯ç”¨èµ„é‡‘"})]})}),t.jsx(Ue,{value:"keep",control:t.jsx(Ge,{}),label:t.jsxs(H,{children:[t.jsx(Z,{variant:"body1",sx:{fontWeight:"bold"},children:"åˆ é™¤ä½†ä¿ç•™äº¤æ˜“è®°å½•"}),t.jsx(Z,{variant:"body2",color:"text.secondary",children:"åˆ é™¤è¯¥è‚¡ç¥¨ï¼Œä½†å°†äº¤æ˜“è®°å½•è½¬ç§»åˆ°å†å²äº¤æ˜“æ•°æ®ä¸­ï¼Œä¸é€€å›èµ„é‡‘"})]})})]})}),(!yt||Lt(yt).length<=1)&&t.jsx(Z,{sx:{fontWeight:"bold",color:"error.main"},children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ"})]}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:()=>{ct(null),Rt("refund")},children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:ie,variant:"contained",color:"error",children:"ç¡®è®¤åˆ é™¤"})]})]}),t.jsxs(St,{open:v,onClose:()=>{A(!1),m(null),I("")},maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.25,pt:.5,px:1},children:"åˆ†ç»„ç®¡ç†"}),t.jsx(Ct,{sx:{pt:.25,px:1},children:u&&t.jsxs(t.Fragment,{children:[t.jsxs(Z,{variant:"body2",sx:{color:"text.secondary"},children:["è‚¡ç¥¨ï¼š",((ye=e.find(s=>s.code===u.stockCode))==null?void 0:ye.name)||u.stockCode]}),t.jsxs(H,{sx:{display:"flex",gap:1},children:[t.jsx(pt,{label:"æ–°åˆ†ç»„åç§°",size:"small",fullWidth:!0,value:_,onChange:s=>I(s.target.value),onKeyPress:s=>{if(s.key==="Enter"&&_.trim()){const h=_.trim(),d=T();if(h===d){U("è¯¥åç§°ä¸é»˜è®¤åˆ†ç»„å†²çªï¼Œä¸èƒ½åˆ›å»º");return}if(u.categories.includes(h)){U("è¯¥åˆ†ç»„å·²å­˜åœ¨");return}m({...u,categories:[...u.categories,h]}),I("")}}}),t.jsx(F,{size:"small",variant:"outlined",onClick:()=>{if(_.trim()){const s=_.trim(),h=T();if(s===h){U("è¯¥åç§°ä¸é»˜è®¤åˆ†ç»„å†²çªï¼Œä¸èƒ½åˆ›å»º");return}if(u.categories.includes(s)){U("è¯¥åˆ†ç»„å·²å­˜åœ¨");return}m({...u,categories:[...u.categories,s]}),I("")}},children:"åˆ›å»º"})]}),t.jsx(Z,{variant:"body2",sx:{fontWeight:"bold"},children:"æ‰€å±åˆ†ç»„ï¼š"}),t.jsxs(H,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[u.categories.filter(s=>!S(s)).map(s=>t.jsx(Jt,{label:s,onDelete:()=>{if(M(s)&&u.categories.filter(h=>!S(h)).length===1){U("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªåˆ†ç»„");return}m({...u,categories:u.categories.filter(h=>h!==s)})},color:M(s)?"primary":"default"},s)),u.categories.filter(s=>!S(s)).length===0&&t.jsx(Z,{variant:"body2",color:"text.secondary",children:'æœªåˆ†ç»„ï¼ˆå°†è‡ªåŠ¨æ·»åŠ åˆ°"è‡ªé€‰"åˆ†ç»„ï¼‰'})]}),t.jsx(Z,{variant:"body2",sx:{fontWeight:"bold"},children:"æ·»åŠ åˆ°åˆ†ç»„ï¼š"}),t.jsxs(H,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[Object.keys(r.categories||{}).filter(s=>!u.categories.includes(s)&&!S(s)).map(s=>t.jsx(Jt,{label:s,onClick:()=>{m({...u,categories:[...u.categories,s]})},sx:{cursor:"pointer"}},s)),(!r.categories||Object.keys(r.categories).length===0)&&(()=>{const s=T();return s&&!u.categories.includes(s)})()&&t.jsx(Jt,{label:T()||"è‡ªé€‰",onClick:()=>{const s=T()||"è‡ªé€‰";m({...u,categories:[...u.categories,s]})},sx:{cursor:"pointer"},color:"primary"})]})]})}),t.jsxs(Dt,{sx:{px:1,pb:.25,pt:.25},children:[t.jsx(F,{size:"small",onClick:()=>{A(!1),m(null),I("")},sx:{py:.25,px:1},children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:()=>{if(!u)return;const s=u.stockCode,h=T()||"è‡ªé€‰",d=u.categories.length>0?u.categories:[h],f={...r.categories||{}};for(const X of Object.keys(f)){const nt=f[X];nt&&(nt.codes||(nt.codes=[]),f[X]={...nt,codes:(nt.codes||[]).filter(wt=>wt!==s)})}f[h]||(f[h]={codes:[],title:h,color:"#1976d2",isDefault:!0});const b=J()||"æŒä»“";f[b]||(f[b]={codes:[],title:b,color:"#2e7d32",isHoldings:!0}),f[b].codes||(f[b].codes=[]);const k=e.find(X=>X.code===s);((k==null?void 0:k.holding_quantity)||0)>0?f[b].codes.includes(s)||(f[b]={...f[b],codes:[...f[b].codes||[],s]}):f[b]={...f[b],codes:(f[b].codes||[]).filter(X=>X!==s)};for(const X of d){f[X]||(f[X]={codes:[],title:X,color:"#1976d2"});const nt=f[X];nt&&!nt.codes&&(nt.codes=[]),nt&&nt.codes&&!nt.codes.includes(s)&&(f[X]={...nt,codes:[...nt.codes,s]})}const et={...r.watchlist};et[s]?et[s]={...et[s],categories:d}:et[s]={categories:d};const ht={...r,categories:f,watchlist:et};g(ht).then(()=>{A(!1),m(null),I("")})},variant:"contained",children:"ä¿å­˜"})]})]}),t.jsx(Ye,{anchorEl:L==null?void 0:L.el,open:!!L,onClose:()=>it(null),children:L&&t.jsxs(t.Fragment,{children:[t.jsx(dt,{onClick:()=>{const s=L.categoryName,d=(r.categories||{})[s]||{title:s,color:"#1976d2"};at({name:s,title:d.title||s,color:d.color||"#1976d2"}),it(null)},children:"è®¾ç½®"}),t.jsx(dt,{onClick:()=>{const s=L.categoryName;if(M(s)){U("ç³»ç»Ÿé»˜è®¤åˆ†ç»„ä¸èƒ½åˆ é™¤"),it(null);return}if(se(s)>0){U("è¯¥åˆ†ç»„ä¸­è¿˜æœ‰è‚¡ç¥¨ï¼Œæ— æ³•åˆ é™¤"),it(null);return}const d={...r.categories};delete d[s];const f={...r,categories:d};g(f).then(()=>{it(null)})},disabled:M(L.categoryName)||se(L.categoryName)>0,children:"åˆ é™¤"})]})}),t.jsxs(St,{open:!!tt,onClose:()=>at(null),maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"ç¼–è¾‘åˆ†ç»„"}),t.jsx(Ct,{sx:{pt:.5},children:tt&&t.jsxs(t.Fragment,{children:[t.jsx(pt,{label:"åˆ†ç»„æ ‡é¢˜",size:"small",fullWidth:!0,value:tt.title,onChange:s=>at({...tt,title:s.target.value}),disabled:M(tt.name),helperText:M(tt.name)?"ç³»ç»Ÿé»˜è®¤åˆ†ç»„ä¸å…è®¸ä¿®æ”¹æ ‡é¢˜":""}),t.jsx(Z,{variant:"body2",sx:{color:"text.secondary"},children:"åˆ†ç»„é¢œè‰²"}),t.jsx(H,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:q.map(s=>t.jsx(H,{onClick:()=>at({...tt,color:s}),sx:{width:32,height:32,backgroundColor:s,borderRadius:"4px",cursor:"pointer",border:tt.color===s?"2px solid #000":"2px solid transparent","&:hover":{opacity:.8,transform:"scale(1.1)"},transition:"all 0.2s"}},s))})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:()=>at(null),children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:()=>{if(!tt)return;const s={...r.categories},h=tt.name,d=s[h]||{codes:[]};s[h]={...d,title:tt.title,color:tt.color};const f={...r,categories:s};g(f).then(()=>{at(null)})},variant:"contained",children:"ä¿å­˜"})]})]}),t.jsx(pn,{open:!!st,autoHideDuration:3e3,onClose:()=>U(""),message:st}),Pt&&t.jsx(x.Suspense,{fallback:t.jsx(St,{open:!0,onClose:()=>Bt(null),maxWidth:"lg",fullWidth:!0,children:t.jsx(Ct,{children:t.jsx(H,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:t.jsx(Mn,{})})})}),children:t.jsx(Xn,{open:!!Pt,onClose:()=>Bt(null),stockCode:Pt.stockCode,stockName:Pt.stockName})})]})},ns=({stocks:e,funds:n,privacyMode:r,onPrivacyModeToggle:g,config:o,onConfigUpdate:c})=>{const i=Y=>r?"***":Y.toFixed(2),l=e.reduce((Y,lt)=>lt.last_price!==null&&lt.holding_quantity>0?Y+lt.last_price*lt.holding_quantity:Y,0),C=(o.historical_holdings||[]).reduce((Y,lt)=>Y+lt.transactions.reduce((Mt,Et)=>Mt+Et.quantity*Et.price,0),0),v=n.available_funds+l+C,A=e.filter(Y=>Y.holding_price!==null&&Y.holding_quantity>0).length,u=v-n.total_original_funds,m=n.total_original_funds>0?u/n.total_original_funds*100:0,_=e.length>0?e.reduce((Y,lt)=>Y+lt.last_change_pct,0)/e.length:0,I=v>0?l/v*100:0,E=l>0||A>0,Q=E?_:0,st=E?u:0,U=E?m:0,L=new Date,it=`${L.getFullYear()}-${String(L.getMonth()+1).padStart(2,"0")}-${String(L.getDate()).padStart(2,"0")} ${String(L.getHours()).padStart(2,"0")}:${String(L.getMinutes()).padStart(2,"0")}:${String(L.getSeconds()).padStart(2,"0")}`,tt=o.update_interval??1e3,at=async Y=>{const lt={...o,update_interval:Y};await c(lt)};return t.jsxs(Ie,{sx:{p:.5,mb:.5,backgroundColor:"#f5f5f5",position:"relative",borderRadius:0},children:[t.jsxs(H,{sx:{position:"absolute",top:8,right:8,display:"flex",alignItems:"center",gap:1},children:[t.jsx(Zt,{size:"small",sx:{minWidth:80},children:t.jsxs(ae,{value:tt,onChange:Y=>at(Y.target.value),sx:{fontSize:"0.75rem",height:"28px","& .MuiSelect-select":{py:.5}},children:[t.jsx(dt,{value:1e3,children:"1s"}),t.jsx(dt,{value:3e3,children:"3s"}),t.jsx(dt,{value:5e3,children:"5s"}),t.jsx(dt,{value:1e4,children:"10s"})]})}),t.jsx(Nn,{title:r?"æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯":"éšè—æ•æ„Ÿä¿¡æ¯",children:t.jsx(ce,{onClick:g,sx:{color:r?"text.secondary":"primary.main"},size:"small",children:r?t.jsx(Wn,{}):t.jsx(Hn,{})})})]}),t.jsx(H,{sx:{mb:.5},children:t.jsxs(Z,{variant:"body2",component:"span",sx:{color:"text.secondary",fontSize:"0.875rem"},children:["æ—¶é—´:",it," | è‡ªé€‰:",e.length," | æ¶¨è·Œå¹…:",t.jsxs(Z,{variant:"body2",component:"span",sx:{color:E?Q>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:[Q>=0?"+":"",Q.toFixed(2),"%"]})," | æŒä»“:",A," | ç›ˆäº:",r?t.jsxs(Z,{variant:"body2",component:"span",sx:{color:E?U>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:["***(",U>=0?"+":"",U.toFixed(2),"%)"]}):t.jsxs(Z,{variant:"body2",component:"span",sx:{color:E?st>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:[st>=0?"+":"",i(st),"(",U>=0?"+":"",U.toFixed(2),"%)"]})]})}),t.jsx(H,{children:t.jsxs(Z,{variant:"body2",component:"span",sx:{color:"text.secondary",fontSize:"0.875rem"},children:["æœ¬é‡‘:",i(n.total_original_funds)," | å®æ—¶å¸‚å€¼:",i(v)," | æŒä»“å¸‚å€¼:",i(l)," | å¯ç”¨èµ„é‡‘:",i(n.available_funds)," | ä»“ä½:",I.toFixed(2),"%"]})})]})};async function wn(e){const n=new Map;if(e.length===0)return n;try{const r=e.map(c=>Zn(c)),g=new Map;r.forEach((c,i)=>{g.set(c,e[i])});const o=`https://qt.gtimg.cn/q=${r.join(",")}`;return new Promise((c,i)=>{const l=document.createElement("script"),C=`tencent_batch_callback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;window[C]=()=>{delete window[C],document.body.contains(l)&&document.body.removeChild(l);try{for(const v of r){const A=g.get(v),u=`v_${v}`,m=window[u];if(!m||typeof m!="string")continue;const _=m.split("~");if(_.length<5)continue;const I=_[1]||A,E=parseFloat(_[3])||0,Q=parseFloat(_[4])||0;if(E<=0)continue;let st="";for(let U=0;U<_.length;U++){const L=_[U];if(/^\d{14}$/.test(L)){const it=L.substring(8,10),tt=L.substring(10,12),at=L.substring(12,14);st=`${it}:${tt}:${at}.000`;break}}if(!st){const U=new Date,L=U.getHours().toString().padStart(2,"0"),it=U.getMinutes().toString().padStart(2,"0"),tt=U.getSeconds().toString().padStart(2,"0"),at=U.getMilliseconds().toString().padStart(3,"0");st=`${L}:${it}:${tt}.${at}`}n.set(A,{price:E,name:I,yesterday_close:Q||E,update_time:st})}}catch(v){console.error("è§£æè…¾è®¯APIæ‰¹é‡æ•°æ®å¤±è´¥:",v)}c(n)},l.src=o,l.onerror=()=>{delete window[C],document.body.contains(l)&&document.body.removeChild(l),c(n)},l.onload=()=>{setTimeout(()=>{window[C]?window[C]():c(n)},100)},document.body.appendChild(l),setTimeout(()=>{document.body.contains(l)&&(delete window[C],document.body.removeChild(l),c(n))},1e4)})}catch(r){return console.error("æ‰¹é‡è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥ï¼ˆè…¾è®¯ï¼‰:",r),n}}async function rn(e){try{return(await wn([e])).get(e)||null}catch(n){return console.warn(`è…¾è®¯APIè·å– ${e} å¤±è´¥:`,n),null}}async function $e(e){if(e.length===0)return new Map;try{return await wn(e)}catch(n){return console.error("æ‰¹é‡è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥:",n),new Map}}const ss=!1,rs={available_funds:1e4,total_original_funds:1e4},os={Aè‚¡:{enabled:!0,morning:{start:"09:30",end:"11:30"},afternoon:{start:"13:00",end:"15:00"},weekdays:[1,2,3,4,5]},ç¾è‚¡:{enabled:!1,morning:{start:"22:30",end:"05:00"},afternoon:null,weekdays:[1,2,3,4,5]}},as={},is={600228:{alert_up:null,alert_down:null},"002255":{alert_up:null,alert_down:null}},ls={privacy_mode:ss,funds:rs,market_hours:os,holdings:as,watchlist:is},bn="stocks_db",on=4,Wt="watchlist",At="transactions",ee="config",ne="history";let Xt=null;async function cs(){return new Promise((e,n)=>{const r=indexedDB.deleteDatabase(bn);r.onsuccess=()=>{Xt=null,e()},r.onerror=()=>n(new Error("åˆ é™¤ IndexedDB å¤±è´¥")),r.onblocked=()=>n(new Error("åˆ é™¤ IndexedDB è¢«é˜»å¡"))})}function kt(){return Xt?Promise.resolve(Xt):new Promise((e,n)=>{const r=indexedDB.open(bn,on);r.onerror=()=>{n(new Error("æ‰“å¼€ IndexedDB å¤±è´¥"))},r.onupgradeneeded=g=>{const o=g.target.result,c=g.oldVersion||0;console.log(`IndexedDB å‡çº§: ä»ç‰ˆæœ¬ ${c} åˆ°ç‰ˆæœ¬ ${on}`),c>0&&(o.objectStoreNames.contains("holdings_transactions")&&o.deleteObjectStore("holdings_transactions"),o.objectStoreNames.contains("historical_holdings")&&o.deleteObjectStore("historical_holdings")),o.objectStoreNames.contains(Wt)||o.createObjectStore(Wt,{keyPath:"code"}).createIndex("code","code",{unique:!0}),o.objectStoreNames.contains(At)||o.createObjectStore(At,{keyPath:"id",autoIncrement:!0}).createIndex("code","code",{unique:!1}),o.objectStoreNames.contains(ee)||o.createObjectStore(ee,{keyPath:"key"}).createIndex("key","key",{unique:!0}),o.objectStoreNames.contains(ne)||o.createObjectStore(ne,{keyPath:"date"}).createIndex("date","date",{unique:!0})},r.onsuccess=()=>{Xt=r.result,e(Xt)}})}async function Vt(e){try{const g=(await kt()).transaction([Wt],"readwrite").objectStore(Wt);await new Promise((o,c)=>{const i=g.put(e);i.onsuccess=()=>o(),i.onerror=()=>c(new Error("ä¿å­˜è‡ªé€‰è‚¡å¤±è´¥"))})}catch(n){throw console.error("ä¿å­˜è‡ªé€‰è‚¡å¤±è´¥:",n),n}}async function jn(e){try{const g=(await kt()).transaction([Wt],"readonly").objectStore(Wt);return new Promise((o,c)=>{const i=g.get(e);i.onsuccess=()=>{o(i.result||null)},i.onerror=()=>c(new Error("åŠ è½½è‡ªé€‰è‚¡å¤±è´¥"))})}catch(n){return console.error("åŠ è½½è‡ªé€‰è‚¡å¤±è´¥:",n),null}}async function xe(){try{const r=(await kt()).transaction([Wt],"readonly").objectStore(Wt);return new Promise((g,o)=>{const c=r.getAll();c.onsuccess=()=>{const i={};c.result.forEach(l=>{i[l.code]=l}),g(i)},c.onerror=()=>o(new Error("åŠ è½½æ‰€æœ‰è‡ªé€‰è‚¡å¤±è´¥"))})}catch(e){return console.error("åŠ è½½æ‰€æœ‰è‡ªé€‰è‚¡å¤±è´¥:",e),{}}}async function _n(e){try{const g=(await kt()).transaction([Wt],"readwrite").objectStore(Wt);await new Promise((o,c)=>{const i=g.delete(e);i.onsuccess=()=>o(),i.onerror=()=>c(new Error("åˆ é™¤è‡ªé€‰è‚¡å¤±è´¥"))})}catch(n){throw console.error("åˆ é™¤è‡ªé€‰è‚¡å¤±è´¥:",n),n}}async function Te(e,n){try{const o=(await kt()).transaction([At],"readwrite").objectStore(At),c=new Error().stack,i=n||"unknown";return console.log("ğŸ”µ [æ·»åŠ äº¤æ˜“è®°å½•]",{source:i,code:e.code,time:e.time,quantity:e.quantity,price:e.price,stack:c==null?void 0:c.split(`
`).slice(1,5).join(`
`)}),new Promise((l,C)=>{const v=o.add(e);v.onsuccess=()=>{const A=v.result;console.log("âœ… [äº¤æ˜“è®°å½•å·²æ·»åŠ ]",{source:i,id:A,code:e.code,time:e.time}),l(A)},v.onerror=()=>C(new Error("æ·»åŠ äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(r){throw console.error("âŒ [æ·»åŠ äº¤æ˜“è®°å½•å¤±è´¥]",{source:n||"unknown",error:r,transaction:e}),r}}async function Se(e,n){try{const o=(await kt()).transaction([At],"readwrite").objectStore(At);await new Promise((c,i)=>{const l=o.put({...n,id:e});l.onsuccess=()=>c(),l.onerror=()=>i(new Error("æ›´æ–°äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(r){throw console.error("æ›´æ–°äº¤æ˜“è®°å½•å¤±è´¥:",r),r}}async function Ce(e){try{const g=(await kt()).transaction([At],"readwrite").objectStore(At);await new Promise((o,c)=>{const i=g.delete(e);i.onsuccess=()=>o(),i.onerror=()=>c(new Error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(n){throw console.error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥:",n),n}}async function Me(e){try{const o=(await kt()).transaction([At],"readonly").objectStore(At).index("code");return new Promise((c,i)=>{const l=o.getAll(e);l.onsuccess=()=>{c(l.result||[])},l.onerror=()=>i(new Error("åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(n){return console.error("åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥:",n),[]}}async function ze(){try{const r=(await kt()).transaction([At],"readonly").objectStore(At);return new Promise((g,o)=>{const c=r.getAll();c.onsuccess=()=>{const i={};c.result.forEach(l=>{i[l.code]||(i[l.code]=[]),i[l.code].push(l)}),g(i)},c.onerror=()=>o(new Error("åŠ è½½æ‰€æœ‰äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(e){return console.error("åŠ è½½æ‰€æœ‰äº¤æ˜“è®°å½•å¤±è´¥:",e),{}}}async function Pe(){try{Xt&&(Xt.close(),Xt=null),await new Promise(e=>setTimeout(e,100));try{await cs(),await new Promise(e=>setTimeout(e,100))}catch{console.log("åˆ é™¤æ•°æ®åº“è¢«é˜»å¡ï¼Œæ”¹ä¸ºæ¸…ç©ºå„ä¸ªè¡¨");const n=await kt(),g=n.transaction([Wt],"readwrite").objectStore(Wt);await new Promise((A,u)=>{const m=g.clear();m.onsuccess=()=>A(),m.onerror=()=>u(new Error("æ¸…ç©º watchlist å¤±è´¥"))});const c=n.transaction([At],"readwrite").objectStore(At);await new Promise((A,u)=>{const m=c.clear();m.onsuccess=()=>A(),m.onerror=()=>u(new Error("æ¸…ç©º transactions å¤±è´¥"))});const l=n.transaction([ee],"readwrite").objectStore(ee);await new Promise((A,u)=>{const m=l.clear();m.onsuccess=()=>A(),m.onerror=()=>u(new Error("æ¸…ç©º config å¤±è´¥"))});const v=n.transaction([ne],"readwrite").objectStore(ne);await new Promise((A,u)=>{const m=v.clear();m.onsuccess=()=>A(),m.onerror=()=>u(new Error("æ¸…ç©º history å¤±è´¥"))})}}catch(e){throw console.error("æ¸…ç©ºæ‰€æœ‰æ•°æ®å¤±è´¥:",e),e}}async function Sn(e){try{const g=(await kt()).transaction([At],"readwrite").objectStore(At),o=g.index("code");return new Promise((c,i)=>{const l=o.openKeyCursor(IDBKeyRange.only(e)),C=[];l.onsuccess=v=>{const A=v.target.result;if(A)C.push(A.primaryKey),A.continue();else{const u=C.map(m=>new Promise((_,I)=>{const E=g.delete(m);E.onsuccess=()=>_(),E.onerror=()=>I()}));Promise.all(u).then(()=>c()).catch(i)}},l.onerror=()=>i(new Error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(n){throw console.error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥:",n),n}}async function be(e,n){const r=await Me(e),g=new Set(r.map(o=>o.id).filter(o=>o!==void 0));for(const o of r)o.id&&(n.some(i=>{if(i.id===o.id)return!0;const l=i.time===o.time,C=Math.abs(i.quantity-o.quantity)<1e-4,v=Math.abs(i.price-o.price)<1e-4;return l&&C&&v})||await Ce(o.id));for(const o of n){const c={code:e,time:o.time,quantity:o.quantity,price:o.price,totalAmount:o.totalAmount};if(o.id&&g.has(o.id))await Se(o.id,c);else{let i;for(const l of r)if(l.id){const C=l.time===o.time,v=Math.abs(l.quantity-o.quantity)<1e-4,A=Math.abs(l.price-o.price)<1e-4;if(C&&v&&A){i=l.id;break}}if(i){const l=r.find(C=>C.id===i);l&&(l.time!==c.time||Math.abs(l.quantity-c.quantity)>=1e-4||Math.abs(l.price-c.price)>=1e-4)&&await Se(i,c)}else await Te(c,`saveHoldingsTransactions-${e}`)}}}async function Cn(e){return(await Me(e)).map(r=>({id:r.id,time:r.time,quantity:r.quantity,price:r.price,totalAmount:r.totalAmount}))}async function te(){const e=await ze(),n={};for(const[r,g]of Object.entries(e))n[r]=g.map(o=>({id:o.id,time:o.time,quantity:o.quantity,price:o.price,totalAmount:o.totalAmount}));return n}async function vn(e){await Sn(e)}async function de(e){try{const g=(await kt()).transaction([ee],"readwrite").objectStore(ee),o={key:"main",privacy_mode:e.privacy_mode,update_interval:e.update_interval,stock_order:e.stock_order,categories:e.categories,funds:e.funds,market_hours:e.market_hours,holdings:e.holdings,watchlist:e.watchlist};await new Promise((c,i)=>{const l=g.put(o);l.onsuccess=()=>c(),l.onerror=()=>i(new Error("ä¿å­˜é…ç½®å¤±è´¥"))})}catch(n){throw console.error("ä¿å­˜é…ç½®å¤±è´¥:",n),n}}async function Ee(){try{const r=(await kt()).transaction([ee],"readonly").objectStore(ee);return new Promise((g,o)=>{const c=r.get("main");c.onsuccess=()=>{const i=c.result;g(i?{privacy_mode:i.privacy_mode,update_interval:i.update_interval,stock_order:i.stock_order,categories:i.categories,funds:i.funds,market_hours:i.market_hours,holdings:i.holdings,watchlist:i.watchlist}:null)},c.onerror=()=>o(new Error("åŠ è½½é…ç½®å¤±è´¥"))})}catch(e){return console.error("åŠ è½½é…ç½®å¤±è´¥:",e),null}}async function Ne(e,n){try{const o=(await kt()).transaction([ne],"readwrite").objectStore(ne);await new Promise((c,i)=>{const l=o.put({date:e,data:n});l.onsuccess=()=>c(),l.onerror=()=>i(new Error("ä¿å­˜å†å²æ•°æ®å¤±è´¥"))})}catch(r){throw console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",r),r}}async function Tn(){try{const e=await xe(),n=await ze(),r={};for(const[v,A]of Object.entries(n))r[v]=A.map(u=>({id:u.id,code:u.code,time:u.time,quantity:u.quantity,price:u.price,totalAmount:u.totalAmount}));const{loadHoldingsConfig:g}=await qe(async()=>{const{loadHoldingsConfig:v}=await Promise.resolve().then(()=>us);return{loadHoldingsConfig:v}},void 0),o=await g(),l=(await kt()).transaction([ne],"readonly").objectStore(ne),C={};return await new Promise((v,A)=>{const u=l.getAll();u.onsuccess=()=>{u.result.forEach(m=>{C[m.date]=m.data}),v()},u.onerror=()=>A(new Error("åŠ è½½å†å²æ•°æ®å¤±è´¥"))}),{watchlist:e,transactions:r,config:o,history:C}}catch(e){throw console.error("å¯¼å‡ºæ•°æ®å¤±è´¥:",e),e}}async function Dn(e){try{await Pe();for(const[n,r]of Object.entries(e.watchlist||{}))await Vt(r);for(const[n,r]of Object.entries(e.transactions||{}))if(Array.isArray(r)&&r.length>0)for(const g of r){const{id:o,...c}=g,i={code:n,time:c.time,quantity:c.quantity,price:c.price,totalAmount:c.totalAmount};await Te(i,`import-${n}`)}e.config&&await de(e.config);for(const[n,r]of Object.entries(e.history||{}))await Ne(n,r)}catch(n){throw console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",n),n}}const ds=Object.freeze(Object.defineProperty({__proto__:null,addTransaction:Te,clearAllData:Pe,deleteHoldingsTransactions:vn,deleteTransaction:Ce,deleteTransactionsByCode:Sn,deleteWatchlistItem:_n,exportAllData:Tn,importAllData:Dn,loadAllHoldingsTransactions:te,loadAllTransactions:ze,loadAllWatchlistItems:xe,loadConfig:Ee,loadHoldingsTransactions:Cn,loadTransactionsByCode:Me,loadWatchlistItem:jn,saveConfig:de,saveHistoryData:Ne,saveHoldingsTransactions:be,saveWatchlistItem:Vt,updateTransaction:Se},Symbol.toStringTag,{value:"Module"}));function We(){return ls}async function Oe(){let e=await Ee(),n;if(e)if(n={privacy_mode:e.privacy_mode??!1,update_interval:e.update_interval??1e3,stock_order:e.stock_order,categories:e.categories,funds:e.funds||{available_funds:0,total_original_funds:0},market_hours:e.market_hours||{},holdings:{},watchlist:{},historical_holdings:[]},n.categories){for(const[u,m]of Object.entries(n.categories))u==="è‡ªé€‰"&&!m.isDefault&&(n.categories[u]={...m,isDefault:!0});n.categories.æŒä»“?n.categories.æŒä»“.isHoldings||(n.categories.æŒä»“={...n.categories.æŒä»“,isHoldings:!0}):n.categories.æŒä»“={codes:[],title:"æŒä»“",color:"#2e7d32",isHoldings:!0}}else n.categories={è‡ªé€‰:{codes:[],title:"è‡ªé€‰",color:"#1976d2",isDefault:!0},æŒä»“:{codes:[],title:"æŒä»“",color:"#2e7d32",isHoldings:!0}};else console.log("IndexedDB ä¸­æ²¡æœ‰é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®åˆå§‹åŒ–"),n=We(),n.update_interval||(n.update_interval=1e3),await de(n);const r=await xe(),g=await te();n.holdings={},n.watchlist={};const o=new Date,c=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")} ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}:${String(o.getSeconds()).padStart(2,"0")}`;for(const[u,m]of Object.entries(r)){const _=g[u]||[],I=Array.isArray(_)?_:[],E=m.add_time||c;let Q;m.alert_up!==null&&m.alert_up!==void 0&&(Q=Q||[],Q.push({type:"up",price:m.alert_up})),m.alert_down!==null&&m.alert_down!==void 0&&(Q=Q||[],Q.push({type:"down",price:m.alert_down})),I.length>0?n.holdings[u]={transactions:I,alerts:Q&&Q.length>0?Q:void 0,alert_up:m.alert_up,alert_down:m.alert_down}:n.watchlist[u]={alerts:Q&&Q.length>0?Q:void 0,add_time:E,categories:m.categories,alert_up:m.alert_up,alert_down:m.alert_down},m.add_time||await Vt({...m,add_time:c})}n.historical_holdings=[];const i=new Set;Object.keys(n.holdings||{}).forEach(u=>i.add(u)),Object.keys(n.watchlist||{}).forEach(u=>i.add(u)),n.categories||(n.categories={è‡ªé€‰:{codes:[],title:"è‡ªé€‰",color:"#1976d2",isDefault:!0},æŒä»“:{codes:[],title:"æŒä»“",color:"#2e7d32",isHoldings:!0}});let l=null,C=null;for(const[u,m]of Object.entries(n.categories))m.isDefault===!0&&(l=u),m.isHoldings===!0&&(C=u);l||(l="è‡ªé€‰",n.categories[l]?n.categories[l]={...n.categories[l],isDefault:!0}:n.categories[l]={codes:[],title:"è‡ªé€‰",color:"#1976d2",isDefault:!0}),C||(C="æŒä»“",n.categories[C]?n.categories[C]={...n.categories[C],isHoldings:!0}:n.categories[C]={codes:[],title:"æŒä»“",color:"#2e7d32",isHoldings:!0});const v=new Set;for(const u of Object.values(n.categories))u.codes&&u.codes.forEach(m=>v.add(m));for(const[u,m]of Object.entries(n.watchlist||{}))if(m.categories&&m.categories.length>0)for(const _ of m.categories)n.categories[_]&&(n.categories[_].codes||(n.categories[_].codes=[]),n.categories[_].codes.includes(u)||(n.categories[_].codes.push(u),v.add(u)));let A=!1;for(const u of i)if(!v.has(u)){A=!0;const _=u in(n.holdings||{})?C:l;if(n.categories[_]||(_===l?n.categories[_]={codes:[],title:"è‡ªé€‰",color:"#1976d2",isDefault:!0}:n.categories[_]={codes:[],title:"æŒä»“",color:"#2e7d32",isHoldings:!0}),n.categories[_].codes||(n.categories[_].codes=[]),n.categories[_].codes.includes(u)||n.categories[_].codes.push(u),u in(n.watchlist||{})){const I=n.watchlist[u];(!I.categories||I.categories.length===0)&&(I.categories=[_],await Vt({code:u,name:u,alert_up:I.alert_up,alert_down:I.alert_down,add_time:I.add_time,categories:[_]}))}}return A&&(console.log("æ£€æµ‹åˆ°æ—§æ•°æ®ï¼Œæ­£åœ¨è¿ç§»åˆ°åˆ†ç»„ç³»ç»Ÿ..."),await de(n),console.log("æ•°æ®è¿ç§»å®Œæˆ")),n}async function Fe(){const e=await Ee();let n;e?n={privacy_mode:e.privacy_mode??!1,update_interval:e.update_interval??1e3,funds:e.funds||{available_funds:0,total_original_funds:0},market_hours:e.market_hours||{},holdings:e.holdings||{},watchlist:e.watchlist||{},historical_holdings:[]}:n=We();const r=await xe(),g=await te();n.holdings={},n.watchlist={};const o=new Date,c=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")} ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}:${String(o.getSeconds()).padStart(2,"0")}`;for(const[i,l]of Object.entries(r)){const C=g[i]||[],v=Array.isArray(C)?C:[],A=l.add_time||c;let u;l.alert_up!==null&&l.alert_up!==void 0&&(u=u||[],u.push({type:"up",price:l.alert_up})),l.alert_down!==null&&l.alert_down!==void 0&&(u=u||[],u.push({type:"down",price:l.alert_down})),v.length>0?n.holdings[i]={transactions:v,alerts:u&&u.length>0?u:void 0,alert_up:l.alert_up,alert_down:l.alert_down}:n.watchlist[i]={alerts:u&&u.length>0?u:void 0,add_time:A,categories:l.categories,alert_up:l.alert_up,alert_down:l.alert_down},l.add_time||await Vt({...l,add_time:c})}return n.historical_holdings=[],n}async function ve(e){try{const n=new Set;Object.keys(e.holdings||{}).forEach(i=>n.add(i)),Object.keys(e.watchlist||{}).forEach(i=>n.add(i));for(const i of n){const l=e.holdings[i],C=e.watchlist[i];if(l){const v=await jn(i);let A=(v==null?void 0:v.add_time)||new Date().toISOString().replace("T"," ").substring(0,19);if(l.transactions&&l.transactions.length>0){const _=l.transactions.map(I=>I.time).filter(I=>I);if(_.length>0){const I=_.map(st=>new Date(st.replace(" ","T"))),E=new Date(Math.min(...I.map(st=>st.getTime()))),Q=new Date(A.replace(" ","T"));if(E<Q){const st=E.getFullYear(),U=String(E.getMonth()+1).padStart(2,"0"),L=String(E.getDate()).padStart(2,"0"),it=String(E.getHours()).padStart(2,"0"),tt=String(E.getMinutes()).padStart(2,"0"),at=String(E.getSeconds()).padStart(2,"0");A=`${st}-${U}-${L} ${it}:${tt}:${at}`}}}let u=l.alert_up??null,m=l.alert_down??null;if(l.alerts&&l.alerts.length>0){const _=l.alerts.find(E=>E.type==="up"),I=l.alerts.find(E=>E.type==="down");u=_?_.price:null,m=I?I.price:null}if(await Vt({code:i,name:i,alert_up:u,alert_down:m,add_time:A}),l.transactions&&l.transactions.length>0)if(l.transactions.every(I=>I.id!==void 0))await be(i,l.transactions);else{const I=await Cn(i);I.length===l.transactions.length?await be(i,I):await be(i,l.transactions)}else await vn(i)}else if(C){let v=C.alert_up??null,A=C.alert_down??null;if(C.alerts&&C.alerts.length>0){const u=C.alerts.find(_=>_.type==="up"),m=C.alerts.find(_=>_.type==="down");v=u?u.price:null,A=m?m.price:null}await Vt({code:i,name:i,alert_up:v,alert_down:A,add_time:C.add_time})}}const r=await xe(),g=await te();for(const i of Object.keys(r))n.has(i)||(!g[i]||g[i].length===0)&&await _n(i);await de(e);const o=await te(),c={...e};for(const i of Object.keys(c.holdings||{}))o[i]&&o[i].length>0&&(c.holdings[i]={...c.holdings[i],transactions:o[i]});return c}catch(n){return console.error("ä¿å­˜é…ç½®å¤±è´¥:",n),e}return e}async function An(e,n){try{await Ne(e,n)}catch(r){console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",r)}}function $n(){return new Date().toISOString().split("T")[0]}async function kn(){try{await Pe();const e=We(),n=new Date,r=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;for(const[o,c]of Object.entries(e.watchlist||{}))await Vt({code:o,name:o,alert_up:c.alert_up,alert_down:c.alert_down,add_time:c.add_time||r});for(const[o,c]of Object.entries(e.holdings||{}))if(await Vt({code:o,name:o,alert_up:c.alert_up,alert_down:c.alert_down,add_time:r}),c.transactions&&c.transactions.length>0)for(const i of c.transactions)await Te({code:o,time:i.time,quantity:i.quantity,price:i.price},`resetToDefaultConfig-${o}`);const g={...e,holdings:{},watchlist:{}};return await de(g),{...e,holdings:{},watchlist:{}}}catch(e){throw console.error("é‡ç½®æ•°æ®å¤±è´¥:",e),e}}const us=Object.freeze(Object.defineProperty({__proto__:null,getTodayDate:$n,initializeConfig:Oe,loadHoldingsConfig:Fe,resetToDefaultConfig:kn,saveHistoryData:An,saveHoldingsConfig:ve},Symbol.toStringTag,{value:"Module"})),hs=({config:e,onConfigUpdate:n,onStockAdded:r,stockStates:g,onOpenTransactionDialog:o,onOpenAllTransactionsDialog:c,onToggleCategorySidebar:i})=>{const[l,C]=x.useState({});x.useEffect(()=>{(async()=>{const p=await te();C(p)})()},[e]);const[v,A]=x.useState(!1),[u,m]=x.useState(""),[_,I]=x.useState(!1),[E,Q]=x.useState(""),[st,U]=x.useState(!1),[L,it]=x.useState(""),[tt,at]=x.useState(""),[Y,lt]=x.useState(""),[Mt,Et]=x.useState("100"),[Ot,j]=x.useState(""),[D,$]=x.useState(!1),[V,S]=x.useState(""),[M,T]=x.useState(!1),[J,ut]=x.useState(!1),[q,rt]=x.useState(""),[Ft,ot]=x.useState("add"),[bt,zt]=x.useState(!1),[z,yt]=x.useState(""),[ct,Kt]=x.useState("add"),[Rt,xt]=x.useState(!1),[vt,Pt]=x.useState(null),[Bt,jt]=x.useState(null),[mt,Qt]=x.useState({time:"",quantity:"",totalAmount:""}),[ue,Yt]=x.useState(""),[he,Ut]=x.useState(""),[fe,Lt]=x.useState(""),[ge,Gt]=x.useState(""),[se,ie]=x.useState("gt"),[pe,re]=x.useState(""),ye=()=>{A(!0),m(""),Q("")},s=()=>{A(!1),m(""),Q("")},h=async()=>{if(!u.trim()){Q("è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ");return}const a=u.trim().toUpperCase();if(e.holdings[a]||e.watchlist[a]){Q("è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰æˆ–æŒä»“ä¸­");return}I(!0),Q("");try{if(!await rn(a)){Q("æ— æ³•è·å–è‚¡ç¥¨ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®"),I(!1);return}const y=new Date,K=y.getFullYear(),R=String(y.getMonth()+1).padStart(2,"0"),w=String(y.getDate()).padStart(2,"0"),N=String(y.getHours()).padStart(2,"0"),P=String(y.getMinutes()).padStart(2,"0"),G=String(y.getSeconds()).padStart(2,"0"),_t=`${K}-${R}-${w} ${N}:${P}:${G}`,ft=e.stock_order||[],qt=ft.includes(a)?ft:[...ft,a],Nt={...e.categories||{}};let Ht="è‡ªé€‰";for(const[De,On]of Object.entries(Nt))if(On.isDefault===!0){Ht=De;break}Nt[Ht]||(Nt[Ht]={codes:[],title:Ht,color:"#1976d2",isDefault:!0});const gt=Nt[Ht];gt&&!gt.codes.includes(a)&&(Nt[Ht]={...gt,codes:[...gt.codes,a]});const le={...e,stock_order:qt,categories:Nt,watchlist:{...e.watchlist,[a]:{alert_up:null,alert_down:null,add_time:_t,categories:["è‡ªé€‰"]}}};await n(le),r&&r(a),s()}catch(p){Q(p.message||"æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®")}finally{I(!1)}};x.useEffect(()=>{if(st&&!Y){const a=new Date,p=a.getFullYear(),y=String(a.getMonth()+1).padStart(2,"0"),K=String(a.getDate()).padStart(2,"0"),R=String(a.getHours()).padStart(2,"0"),w=String(a.getMinutes()).padStart(2,"0"),N=String(a.getSeconds()).padStart(2,"0");lt(`${p}-${y}-${K} ${R}:${w}:${N}`)}},[st,Y]);const d=x.useMemo(()=>{const a=parseFloat(Mt),p=parseFloat(Ot);return isNaN(a)||a===0||isNaN(p)||p<=0?null:p/Math.abs(a)},[Mt,Ot]),f=()=>{const a=new Set;return Object.keys(e.holdings||{}).forEach(p=>a.add(p)),Object.keys(e.watchlist||{}).forEach(p=>a.add(p)),Array.from(a).sort()},b=x.useCallback(a=>{U(!0),a?(it(a),at(""),T(!0)):(it(""),at(""),T(!1)),lt(""),Et("100"),S("")},[g]);x.useEffect(()=>(o&&o(b),window.__openTransactionDialog=b,()=>{window.__openTransactionDialog&&delete window.__openTransactionDialog}),[b,o]);const k=x.useCallback(a=>{xt(!0),a?(Yt(a),Ut("")):(Yt(""),Ut("")),Lt(""),Gt(""),ie("gt"),re("")},[]);x.useEffect(()=>{c&&c(k)},[k,c]);const B=()=>{U(!1),it(""),at(""),lt(""),Et("100"),j(""),S(""),T(!1)},et=()=>{xt(!1),Yt(""),Ut(""),Lt(""),Gt(""),ie("gt"),re("")},ht=async()=>{const a=L||tt.trim().toUpperCase();if(!a){S("è¯·é€‰æ‹©æˆ–è¾“å…¥è‚¡ç¥¨ä»£ç ");return}$(!0),S("");try{if(L&&f().includes(L)){T(!0),$(!1);return}if(e.holdings[a]||e.watchlist[a]){S("è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰æˆ–æŒä»“ä¸­ï¼Œè¯·ä»ä¸‹æ‹‰æ¡†é€‰æ‹©"),$(!1);return}if(!await rn(a)){S("æ— æ³•è·å–è‚¡ç¥¨ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®"),$(!1);return}const y={...e,watchlist:{...e.watchlist,[a]:{alert_up:null,alert_down:null,add_time:new Date().toISOString().replace("T"," ").substring(0,19)}}};await n(y),r&&r(a),it(a),at(""),T(!0)}catch(p){S(p.message||"éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®")}finally{$(!1)}},X=()=>{const a=L||tt.trim().toUpperCase();if(!a){S("è¯·é€‰æ‹©æˆ–è¾“å…¥è‚¡ç¥¨ä»£ç ");return}if(!M){S("è¯·å…ˆéªŒè¯è‚¡ç¥¨ä»£ç ");return}if(!Y){S("è¯·è¾“å…¥äº¤æ˜“æ—¶é—´");return}const p=parseFloat(Mt);if(isNaN(p)||p===0){S("è¯·è¾“å…¥æœ‰æ•ˆçš„äº¤æ˜“æ•°é‡ï¼ˆä¸èƒ½ä¸º0ï¼‰");return}const y=parseFloat(Ot);if(isNaN(y)||y<=0){S("è¯·è¾“å…¥æœ‰æ•ˆçš„æ€»é‡‘é¢");return}const K=y/Math.abs(p),R=e.holdings[a]||{transactions:[],alert_up:null,alert_down:null},w=Array.isArray(R.transactions)?R.transactions:[];if(p<0){let gt=0;for(const De of w)gt+=Number(De.quantity)||0;if(gt+p<0){S(`æŒä»“ä¸è¶³ï¼Œå½“å‰æŒä»“ï¼š${gt.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(p).toFixed(0)}`);return}}const N={time:Y,quantity:p,price:K,totalAmount:y},P=p>0?e.funds.available_funds-y:e.funds.available_funds+y,G=e.stock_order||[],_t=G.includes(a)?G:[...G,a],ft={...e.categories||{}};let qt="è‡ªé€‰";for(const[gt,le]of Object.entries(ft))if(le.isDefault===!0){qt=gt;break}ft[qt]||(ft[qt]={codes:[],title:qt,color:"#1976d2",isDefault:!0});let Nt=!1;for(const gt of Object.values(ft))if(gt&&gt.codes&&gt.codes.includes(a)){Nt=!0;break}if(!Nt){const gt=ft[qt];ft[qt]={...gt,codes:[...gt.codes,a]}}const Ht={...e,stock_order:_t,categories:ft,funds:{...e.funds,available_funds:Math.max(0,P)},holdings:{...e.holdings,[a]:{...R,transactions:[...w,N]}}};if(e.watchlist[a]){const{[a]:gt,...le}=e.watchlist;Ht.watchlist=le}n(Ht).then(()=>{B()}).catch(gt=>{console.error("ä¿å­˜äº¤æ˜“å¤±è´¥:",gt),S("ä¿å­˜äº¤æ˜“å¤±è´¥ï¼Œè¯·é‡è¯•")})},nt=()=>{ut(!0),rt(""),ot("add")},wt=()=>{ut(!1),rt(""),ot("add")},O=()=>{const a=parseFloat(q);if(isNaN(a)||a<=0)return;let p=e.funds.total_original_funds,y=e.funds.available_funds;Ft==="add"?(p+=a,y+=a):(p=Math.max(0,p-a),y=Math.max(0,y-a));const K={...e,funds:{...e.funds,total_original_funds:p,available_funds:y}};n(K).then(()=>{wt()})},$t=()=>{zt(!0),yt(""),Kt("add")},It=()=>{zt(!1),yt(""),Kt("add")},oe=()=>{const a=parseFloat(z);if(isNaN(a)||a<=0)return;let p=e.funds.available_funds;ct==="add"?p+=a:p=Math.max(0,p-a);const y={...e,funds:{...e.funds,available_funds:p}};n(y).then(()=>{It()})};return t.jsxs(t.Fragment,{children:[t.jsxs(H,{sx:{mb:.5,display:"flex",justifyContent:"space-between",alignItems:"center",gap:.5},children:[t.jsxs(H,{sx:{display:"flex",gap:.5},children:[t.jsx(F,{variant:"outlined",color:"secondary",size:"small",startIcon:t.jsx(Ze,{}),onClick:nt,children:"å¢å‡æœ¬é‡‘"}),t.jsx(F,{variant:"outlined",color:"secondary",size:"small",startIcon:t.jsx(Ze,{}),onClick:$t,children:"å¢å‡å¯ç”¨èµ„é‡‘"})]}),t.jsxs(H,{sx:{display:"flex",gap:.5},children:[t.jsx(F,{variant:"contained",size:"small",startIcon:t.jsx(we,{}),onClick:ye,children:"è‡ªé€‰"}),t.jsx(F,{variant:"contained",color:"secondary",size:"small",startIcon:t.jsx(we,{}),onClick:()=>b(),children:"äº¤æ˜“"}),t.jsx(F,{variant:"outlined",size:"small",startIcon:t.jsx(Rn,{}),onClick:()=>xt(!0),children:"äº¤æ˜“åˆ—è¡¨"}),t.jsx(F,{variant:"outlined",size:"small",onClick:()=>{window.__toggleCategorySidebar&&window.__toggleCategorySidebar()},children:"è‡ªé€‰åˆ†ç»„"})]})]}),t.jsxs(St,{open:v,onClose:s,maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"æ·»åŠ è‡ªé€‰è‚¡"}),t.jsx(Ct,{sx:{pt:.5},children:t.jsx(pt,{autoFocus:!0,size:"small",label:"è‚¡ç¥¨ä»£ç ",fullWidth:!0,variant:"outlined",value:u,onChange:a=>{m(a.target.value),Q("")},placeholder:"ä¾‹å¦‚ï¼š600228",error:!!E,helperText:E||"è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ",disabled:_,onKeyPress:a=>{a.key==="Enter"&&!_&&h()}})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:s,disabled:_,children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:h,variant:"contained",disabled:_,children:_?"éªŒè¯ä¸­...":"æ·»åŠ "})]})]}),t.jsxs(St,{open:st,onClose:B,maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{children:"æ·»åŠ äº¤æ˜“è®°å½•"}),t.jsx(Ct,{children:t.jsxs(H,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[t.jsxs(Zt,{fullWidth:!0,size:"small",children:[t.jsx(me,{children:"è‚¡ç¥¨ä»£ç "}),t.jsx(ae,{value:L,label:"è‚¡ç¥¨ä»£ç ",onChange:a=>{const p=a.target.value;it(p),at(""),S(""),p&&f().includes(p)?T(!0):T(!1)},disabled:D,children:f().map(a=>{var p,y;return t.jsxs(dt,{value:a,children:[a," ",(p=g==null?void 0:g.get(a))!=null&&p.name?`(${(y=g.get(a))==null?void 0:y.name})`:""]},a)})})]}),t.jsx(pt,{label:"æˆ–è¾“å…¥æ–°ä»£ç ",size:"small",fullWidth:!0,variant:"outlined",value:tt,onChange:a=>{at(a.target.value),it(""),S(""),T(!1)},placeholder:"ä¾‹å¦‚ï¼š600228",disabled:D||!!L,helperText:L?"å·²é€‰æ‹©":"è¾“å…¥åéœ€éªŒè¯"}),!M&&tt&&t.jsx(F,{variant:"outlined",onClick:ht,disabled:D,fullWidth:!0,children:D?"éªŒè¯ä¸­...":"éªŒè¯è‚¡ç¥¨ä»£ç "}),V&&t.jsx(H,{sx:{color:"error.main",fontSize:"0.875rem"},children:V}),M&&t.jsxs(t.Fragment,{children:[t.jsx(pt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",fullWidth:!0,variant:"outlined",value:Y?(()=>{try{const a=new Date(Y),p=a.getFullYear(),y=String(a.getMonth()+1).padStart(2,"0"),K=String(a.getDate()).padStart(2,"0"),R=String(a.getHours()).padStart(2,"0"),w=String(a.getMinutes()).padStart(2,"0");return`${p}-${y}-${K}T${R}:${w}`}catch{return""}})():"",onChange:a=>{const p=a.target.value;if(p){const y=new Date(p),K=y.getFullYear(),R=String(y.getMonth()+1).padStart(2,"0"),w=String(y.getDate()).padStart(2,"0"),N=String(y.getHours()).padStart(2,"0"),P=String(y.getMinutes()).padStart(2,"0"),G=String(y.getSeconds()).padStart(2,"0");lt(`${K}-${R}-${w} ${N}:${P}:${G}`)}},InputLabelProps:{shrink:!0}}),t.jsx(pt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",fullWidth:!0,variant:"outlined",value:Mt,onChange:a=>{const p=a.target.value;(p===""||p==="-"||/^-?\d*\.?\d*$/.test(p))&&Et(p)},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡ºï¼ˆå¦‚ï¼š-100è¡¨ç¤ºå–å‡º100è‚¡ï¼‰"}),t.jsx(pt,{label:"æ€»é‡‘é¢",type:"number",fullWidth:!0,required:!0,variant:"outlined",value:Ot,onChange:a=>j(a.target.value),inputProps:{min:0,step:.01},helperText:"ç”±äºåˆ¸å•†è®¡ç®—è§„åˆ™å¤æ‚ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ï¼ˆåŒ…å«æ‰€æœ‰è´¹ç”¨ï¼‰"}),d!==null&&t.jsx(pt,{label:"å•ä»·ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰",type:"number",fullWidth:!0,variant:"outlined",value:d.toFixed(3),InputProps:{readOnly:!0},helperText:`æ€»é‡‘é¢ Ã· |æ•°é‡| = ${d.toFixed(3)}`})]})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:B,disabled:D,children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:X,variant:"contained",disabled:D||!M,children:"æäº¤"})]})]}),t.jsxs(St,{open:J,onClose:wt,maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"å¢å‡æœ¬é‡‘"}),t.jsx(Ct,{sx:{pt:.5},children:t.jsxs(H,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsxs(Zt,{fullWidth:!0,children:[t.jsx(me,{children:"æ“ä½œç±»å‹"}),t.jsxs(ae,{value:Ft,label:"æ“ä½œç±»å‹",onChange:a=>ot(a.target.value),children:[t.jsx(dt,{value:"add",children:"å¢åŠ æœ¬é‡‘"}),t.jsx(dt,{value:"subtract",children:"å‡å°‘æœ¬é‡‘"})]})]}),t.jsx(pt,{label:"é‡‘é¢",type:"number",fullWidth:!0,variant:"outlined",value:q,onChange:a=>rt(a.target.value),inputProps:{min:0,step:.01},helperText:Ft==="add"?"å¢åŠ æœ¬é‡‘æ—¶ï¼Œå¯ç”¨èµ„é‡‘ä¹Ÿä¼šåŒæ­¥å¢åŠ ":"å‡å°‘æœ¬é‡‘æ—¶ï¼Œå¯ç”¨èµ„é‡‘ä¹Ÿä¼šåŒæ­¥å‡å°‘"}),Ft==="subtract"&&t.jsx(H,{sx:{p:.5,backgroundColor:"#fff3cd",borderRadius:0},children:t.jsxs(Z,{variant:"body2",sx:{color:"#856404",fontSize:"0.75rem"},children:["å½“å‰æœ¬é‡‘ï¼š",e.funds.total_original_funds.toFixed(2)," | å¯ç”¨ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å‡å°‘åæœ¬é‡‘ï¼š",Math.max(0,e.funds.total_original_funds-(parseFloat(q)||0)).toFixed(2)," | å¯ç”¨ï¼š",Math.max(0,e.funds.available_funds-(parseFloat(q)||0)).toFixed(2)]})}),Ft==="add"&&t.jsx(H,{sx:{p:.5,backgroundColor:"#d1ecf1",borderRadius:0},children:t.jsxs(Z,{variant:"body2",sx:{color:"#0c5460",fontSize:"0.75rem"},children:["å½“å‰æœ¬é‡‘ï¼š",e.funds.total_original_funds.toFixed(2)," | å¯ç”¨ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å¢åŠ åæœ¬é‡‘ï¼š",(e.funds.total_original_funds+(parseFloat(q)||0)).toFixed(2)," | å¯ç”¨ï¼š",(e.funds.available_funds+(parseFloat(q)||0)).toFixed(2)]})})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:wt,children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:O,variant:"contained",disabled:!q||parseFloat(q)<=0,children:"ç¡®è®¤"})]})]}),t.jsxs(St,{open:bt,onClose:It,maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"å¢å‡å¯ç”¨èµ„é‡‘"}),t.jsx(Ct,{sx:{pt:.5},children:t.jsxs(H,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsxs(Zt,{fullWidth:!0,size:"small",children:[t.jsx(me,{children:"æ“ä½œç±»å‹"}),t.jsxs(ae,{value:ct,label:"æ“ä½œç±»å‹",onChange:a=>Kt(a.target.value),children:[t.jsx(dt,{value:"add",children:"å¢åŠ å¯ç”¨èµ„é‡‘"}),t.jsx(dt,{value:"subtract",children:"å‡å°‘å¯ç”¨èµ„é‡‘"})]})]}),t.jsx(pt,{size:"small",label:"é‡‘é¢",type:"number",fullWidth:!0,variant:"outlined",value:z,onChange:a=>yt(a.target.value),inputProps:{min:0,step:.01},helperText:ct==="add"?"å¢åŠ å¯ç”¨èµ„é‡‘ï¼ˆä¸å½±å“æœ¬é‡‘ï¼‰":"å‡å°‘å¯ç”¨èµ„é‡‘ï¼ˆä¸å½±å“æœ¬é‡‘ï¼‰"}),ct==="subtract"&&t.jsx(H,{sx:{p:.5,backgroundColor:"#fff3cd",borderRadius:0},children:t.jsxs(Z,{variant:"body2",sx:{color:"#856404",fontSize:"0.75rem"},children:["å½“å‰å¯ç”¨èµ„é‡‘ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å‡å°‘åå¯ç”¨èµ„é‡‘ï¼š",Math.max(0,e.funds.available_funds-(parseFloat(z)||0)).toFixed(2)]})}),ct==="add"&&t.jsx(H,{sx:{p:.5,backgroundColor:"#d1ecf1",borderRadius:0},children:t.jsxs(Z,{variant:"body2",sx:{color:"#0c5460",fontSize:"0.75rem"},children:["å½“å‰å¯ç”¨èµ„é‡‘ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å¢åŠ åå¯ç”¨èµ„é‡‘ï¼š",(e.funds.available_funds+(parseFloat(z)||0)).toFixed(2)]})})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:It,children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:oe,variant:"contained",disabled:!z||parseFloat(z)<=0,children:"ç¡®è®¤"})]})]}),t.jsxs(St,{open:Rt,onClose:et,maxWidth:"lg",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:t.jsxs(H,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(Z,{variant:"h6",children:"æ‰€æœ‰äº¤æ˜“è®°å½•"}),t.jsx(F,{variant:"contained",color:"secondary",startIcon:t.jsx(we,{}),onClick:()=>{xt(!1);const a=ue||he.trim().toUpperCase()||void 0;b(a)},size:"small",children:"äº¤æ˜“"})]})}),t.jsxs(Ct,{sx:{pt:.5},children:[t.jsx(H,{sx:{mt:.5,mb:.5,p:.5,border:"1px solid #e0e0e0",borderRadius:0},children:t.jsxs(H,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs(Zt,{size:"small",sx:{minWidth:100},children:[t.jsx(me,{children:"è‚¡ç¥¨"}),t.jsxs(ae,{value:ue,label:"è‚¡ç¥¨",onChange:a=>{Yt(a.target.value),Ut("")},children:[t.jsx(dt,{value:"",children:"å…¨éƒ¨"}),f().map(a=>{var p,y;return t.jsxs(dt,{value:a,children:[a," ",(p=g==null?void 0:g.get(a))!=null&&p.name?`(${(y=g.get(a))==null?void 0:y.name})`:""]},a)})]})]}),t.jsx(Z,{variant:"body2",sx:{mx:.5},children:"æˆ–"}),t.jsx(pt,{label:"ä»£ç ",size:"small",value:he,onChange:a=>{Ut(a.target.value.toUpperCase()),Yt("")},placeholder:"ä»£ç ",sx:{width:100}}),t.jsx(pt,{label:"å¼€å§‹æ—¥æœŸ",type:"date",size:"small",value:fe,onChange:a=>Lt(a.target.value),InputLabelProps:{shrink:!0},sx:{width:150}}),t.jsx(Z,{variant:"body2",sx:{mx:.5},children:"è‡³"}),t.jsx(pt,{label:"ç»“æŸæ—¥æœŸ",type:"date",size:"small",value:ge,onChange:a=>Gt(a.target.value),InputLabelProps:{shrink:!0},sx:{width:150}}),t.jsxs(Zt,{size:"small",sx:{minWidth:80},children:[t.jsx(me,{children:"é‡‘é¢"}),t.jsxs(ae,{value:se,label:"é‡‘é¢",onChange:a=>ie(a.target.value),children:[t.jsx(dt,{value:"gt",children:"å¤§äº"}),t.jsx(dt,{value:"eq",children:"ç­‰äº"}),t.jsx(dt,{value:"lt",children:"å°äº"})]})]}),t.jsx(pt,{label:"é‡‘é¢",type:"number",size:"small",value:pe,onChange:a=>re(a.target.value),placeholder:"é‡‘é¢",sx:{width:120}}),t.jsx(F,{variant:"outlined",size:"small",onClick:()=>{Yt(""),Ut(""),Lt(""),Gt(""),ie("gt"),re("")},children:"æ¸…é™¤"})]})}),(()=>{var R;const a=[];Object.entries(e.holdings||{}).forEach(([w,N])=>{var _t;const P=Array.isArray(N.transactions)?N.transactions:[],G=((_t=g==null?void 0:g.get(w))==null?void 0:_t.name)||w;P.forEach((ft,qt)=>{a.push({code:w,name:G,transaction:ft,isHistorical:!1,transactionIndex:qt})})});const p=new Set(Object.keys(e.holdings||{}));for(const[w,N]of Object.entries(e.watchlist||{}))if(!p.has(w)){const P=l[w]||[],G=Array.isArray(P)?P:[];if(G.length>0){const _t=((R=g==null?void 0:g.get(w))==null?void 0:R.name)||w;G.forEach((ft,qt)=>{a.push({code:w,name:_t,transaction:ft,isHistorical:!0,transactionIndex:qt})})}}let y=a;const K=ue||he.trim().toUpperCase();if(K&&(y=y.filter(w=>w.code===K)),fe){const w=new Date(fe);w.setHours(0,0,0,0);const N=w.getTime();y=y.filter(P=>{const G=new Date(P.transaction.time);return G.setHours(0,0,0,0),G.getTime()>=N})}if(ge){const w=new Date(ge);w.setHours(23,59,59,999);const N=w.getTime();y=y.filter(P=>new Date(P.transaction.time).getTime()<=N)}if(pe){const w=parseFloat(pe);isNaN(w)||(y=y.filter(N=>{const P=N.transaction.quantity*N.transaction.price;return se==="gt"?P>w:se==="eq"?Math.abs(P-w)<.01:se==="lt"?P<w:!0}))}return y.sort((w,N)=>{const P=new Date(w.transaction.time).getTime();return new Date(N.transaction.time).getTime()-P}),y.length>0?t.jsx(un,{component:Ie,sx:{mt:2},children:t.jsxs(hn,{size:"small",children:[t.jsx(fn,{children:t.jsxs(je,{children:[t.jsx(W,{children:"ID"}),t.jsx(W,{children:"è‚¡ç¥¨ä»£ç "}),t.jsx(W,{children:"è‚¡ç¥¨åç§°"}),t.jsx(W,{children:"çŠ¶æ€"}),t.jsx(W,{children:"äº¤æ˜“æ—¶é—´"}),t.jsx(W,{children:"ç±»å‹"}),t.jsx(W,{children:"æ•°é‡ï¼ˆè‚¡ï¼‰"}),t.jsx(W,{children:"å•ä»·"}),t.jsx(W,{children:"æ€»é‡‘é¢"}),t.jsx(W,{align:"right",children:"æ“ä½œ"})]})}),t.jsx(gn,{children:y.map((w,N)=>{const P=w.transaction.quantity>0,G=w.transaction.totalAmount??Math.abs(w.transaction.quantity)*w.transaction.price;return t.jsxs(je,{children:[t.jsx(W,{children:w.transaction.id||"--"}),t.jsx(W,{children:w.code}),t.jsx(W,{children:w.name}),t.jsx(W,{children:w.isHistorical?t.jsx(Jt,{label:"å·²åˆ é™¤è‡ªé€‰",size:"small",color:"default"}):t.jsx(Jt,{label:"å½“å‰æŒä»“",size:"small",color:"primary"})}),t.jsx(W,{children:w.transaction.time}),t.jsx(W,{children:t.jsx(Jt,{label:P?"ä¹°å…¥":"å–å‡º",size:"small",color:P?"primary":"secondary"})}),t.jsx(W,{children:Math.floor(Math.abs(w.transaction.quantity)).toLocaleString()}),t.jsx(W,{children:ke(w.transaction.price)}),t.jsx(W,{children:G.toFixed(2)}),t.jsxs(W,{align:"right",children:[t.jsx(ce,{size:"small",onClick:()=>{const _t=w.transaction.totalAmount??Math.abs(w.transaction.quantity)*w.transaction.price;Pt({code:w.code,isHistorical:w.isHistorical,transactionIndex:w.transactionIndex,transaction:w.transaction}),Qt({time:w.transaction.time,quantity:w.transaction.quantity.toString(),totalAmount:_t.toString()})},sx:{color:"#1976d2"},children:t.jsx(Bn,{fontSize:"small"})}),t.jsx(ce,{size:"small",onClick:()=>jt({code:w.code,isHistorical:w.isHistorical,transactionIndex:w.transactionIndex}),sx:{color:"error.main"},children:t.jsx(Ln,{fontSize:"small"})})]})]},`${w.isHistorical?"historical":"current"}-${w.code}-${w.transactionIndex}-${N}`)})})]})}):t.jsx(Z,{sx:{mt:2,textAlign:"center",color:"text.secondary"},children:a.length>0?"æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„äº¤æ˜“è®°å½•":"æš‚æ— äº¤æ˜“è®°å½•"})})()]}),t.jsx(Dt,{sx:{px:1,pb:.5},children:t.jsx(F,{onClick:et,children:"å…³é—­"})})]}),t.jsxs(St,{open:!!vt,onClose:()=>Pt(null),maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"ç¼–è¾‘äº¤æ˜“è®°å½•"}),t.jsx(Ct,{sx:{pt:.5},children:t.jsxs(H,{sx:{display:"flex",flexDirection:"column",gap:1.5,mt:.5},children:[t.jsx(pt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",size:"small",fullWidth:!0,variant:"outlined",value:mt.time?(()=>{try{const a=new Date(mt.time),p=a.getFullYear(),y=String(a.getMonth()+1).padStart(2,"0"),K=String(a.getDate()).padStart(2,"0"),R=String(a.getHours()).padStart(2,"0"),w=String(a.getMinutes()).padStart(2,"0");return`${p}-${y}-${K}T${R}:${w}`}catch{return""}})():"",onChange:a=>{const p=a.target.value;if(p){const y=new Date(p),K=y.getFullYear(),R=String(y.getMonth()+1).padStart(2,"0"),w=String(y.getDate()).padStart(2,"0"),N=String(y.getHours()).padStart(2,"0"),P=String(y.getMinutes()).padStart(2,"0"),G=String(y.getSeconds()).padStart(2,"0");Qt({...mt,time:`${K}-${R}-${w} ${N}:${P}:${G}`})}},InputLabelProps:{shrink:!0}}),t.jsx(pt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:mt.quantity,onChange:a=>{const p=a.target.value;(p===""||p==="-"||/^-?\d*\.?\d*$/.test(p))&&Qt({...mt,quantity:p})},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡º"}),t.jsx(pt,{label:"æ€»é‡‘é¢",type:"number",size:"small",fullWidth:!0,required:!0,variant:"outlined",value:mt.totalAmount,onChange:a=>Qt({...mt,totalAmount:a.target.value}),inputProps:{min:0,step:.01},helperText:"ç”±äºåˆ¸å•†è®¡ç®—è§„åˆ™å¤æ‚ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ï¼ˆåŒ…å«æ‰€æœ‰è´¹ç”¨ï¼‰"}),(()=>{const a=parseFloat(mt.quantity),p=parseFloat(mt.totalAmount),y=!isNaN(a)&&a!==0&&!isNaN(p)&&p>0?p/Math.abs(a):null;return y!==null?t.jsx(pt,{label:"å•ä»·ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:y.toFixed(3),InputProps:{readOnly:!0},helperText:`æ€»é‡‘é¢ Ã· |æ•°é‡| = ${y.toFixed(3)}`}):null})()]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:()=>Pt(null),children:"å–æ¶ˆ"}),t.jsx(F,{onClick:async()=>{if(!vt)return;const{code:a,isHistorical:p,transactionIndex:y}=vt,K=parseFloat(mt.quantity),R=parseFloat(mt.totalAmount);if(isNaN(K)||K===0||isNaN(R)||R<=0||!mt.time)return;const w=R/Math.abs(K);if(K<0&&!p){const N=e.holdings[a];if(N){const P=Array.isArray(N.transactions)?N.transactions:[];let G=0;for(let ft=0;ft<P.length;ft++)ft!==y&&(G+=Number(P[ft].quantity)||0);const _t=G+K;if(_t<0){alert(`æŒä»“ä¸è¶³ï¼Œä¿®æ”¹åæŒä»“ï¼š${_t.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(K).toFixed(0)}`);return}}}if(vt.transaction.id,mt.time,p){const P=(l[a]||[])[y];if(P&&P.id){await Se(P.id,{code:a,time:mt.time,quantity:K,price:w,totalAmount:R});const G=await Fe();await n(G),Pt(null),Qt({time:"",quantity:"",totalAmount:""});const _t=await te();C(_t)}}else{const N=e.holdings[a];if(N){const P=N.transactions[y],G=P.totalAmount??Math.abs(P.quantity)*P.price,_t=P.quantity>0?-G:G,ft=K>0?-R:R,qt=_t-ft,Nt=[...N.transactions];Nt[y]={id:P.id,time:mt.time,quantity:K,price:w,totalAmount:R};const Ht=e.funds.available_funds+qt,gt={...e,funds:{...e.funds,available_funds:Math.max(0,Ht)},holdings:{...e.holdings,[a]:{...N,transactions:Nt}}};n(gt).then(()=>{Pt(null),Qt({time:"",quantity:"",price:""})})}}},variant:"contained",children:"ä¿å­˜"})]})]}),t.jsxs(St,{open:!!Bt,onClose:()=>jt(null),children:[t.jsx(Tt,{children:"ç¡®è®¤åˆ é™¤"}),t.jsx(Ct,{children:t.jsx(Z,{children:"ç¡®å®šè¦åˆ é™¤è¿™æ¡äº¤æ˜“è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"})}),t.jsxs(Dt,{children:[t.jsx(F,{onClick:()=>jt(null),children:"å–æ¶ˆ"}),t.jsx(F,{onClick:async()=>{if(!Bt)return;const{code:a,isHistorical:p,transactionIndex:y}=Bt;if(p){const R=(l[a]||[])[y];if(R&&R.id){await Ce(R.id);const w=await Fe();await n(w),jt(null);const N=await te();C(N)}}else{const K=e.holdings[a];if(K){const R=K.transactions[y],w=R.totalAmount??Math.abs(R.quantity)*R.price,N=R.quantity>0?e.funds.available_funds+w:e.funds.available_funds-w;R.id&&await Ce(R.id);const P=[...K.transactions];P.splice(y,1);const G={...e,funds:{...e.funds,available_funds:N},holdings:{...e.holdings,[a]:{...K,transactions:P}}};n(G).then(()=>{jt(null)})}}},size:"small",variant:"contained",color:"error",children:"åˆ é™¤"})]})]})]})},fs=({version:e})=>t.jsxs(H,{component:"footer",sx:{position:"fixed",bottom:0,left:0,right:0,py:1.5,display:"flex",justifyContent:"center",alignItems:"center",gap:2,backgroundColor:"background.paper",zIndex:1e3},children:[t.jsxs(Vn,{href:"https://github.com/respawnlife/respawn-stocks-listen",target:"_blank",rel:"noopener noreferrer",sx:{display:"flex",alignItems:"center",gap:.5,color:"text.secondary",textDecoration:"none","&:hover":{color:"primary.main"}},children:[t.jsx(Kn,{fontSize:"small"}),t.jsx(Z,{variant:"body2",sx:{fontSize:"0.75rem"},children:"GitHub"})]}),e&&t.jsxs(Z,{variant:"body2",sx:{color:"text.secondary",fontSize:"0.75rem"},children:["ç‰ˆæœ¬: ",e]})]}),gs="260121162602";function ps(e,n){const r=yn(e)?"ç¾è‚¡":"Aè‚¡",g=n[r];if(!(g!=null&&g.enabled))return!0;const o=new Date,c=o.getDay()===0?7:o.getDay();if(!(g.weekdays||[1,2,3,4,5]).includes(c))return!1;const l=o.getHours().toString().padStart(2,"0"),C=o.getMinutes().toString().padStart(2,"0"),v=`${l}:${C}`,A=g.morning;if(A){const m=A.start,_=A.end;if(m>_){if(v>=m||v<=_)return!0}else if(v>=m&&v<=_)return!0}const u=g.afternoon;if(u){const m=u.start,_=u.end;if(v>=m&&v<=_)return!0}return!1}function ms(){const e=new Date;return e.getHours()>15||e.getHours()===15&&e.getMinutes()>=1}function an(e,n,r){const g=[];if(r.alert_triggered||(r.alert_triggered=new Set),r.alerts&&r.alerts.length>0){const o=r.last_price;for(const c of r.alerts){const i=`${c.type}-${c.price}`;let l=!1;c.type==="up"?n>=c.price?(!r.alert_triggered.has(i)||o!==null&&o<c.price)&&(l=!0,r.alert_triggered.add(i)):r.alert_triggered.delete(i):c.type==="down"&&(n<=c.price?(!r.alert_triggered.has(i)||o!==null&&o>c.price)&&(l=!0,r.alert_triggered.add(i)):r.alert_triggered.delete(i)),l&&g.push(c)}}else{const o=r.alert_up,c=r.alert_down,i=r.last_price;if(o!==null&&n>=o){const l=`up-${o}`;(!r.alert_triggered.has(l)||i!==null&&i<o)&&(g.push({type:"up",price:o}),r.alert_triggered.add(l))}else o!==null&&n<o&&r.alert_triggered.delete(`up-${o}`);if(c!==null&&n<=c){const l=`down-${c}`;(!r.alert_triggered.has(l)||i!==null&&i>c)&&(g.push({type:"down",price:c}),r.alert_triggered.add(l))}else c!==null&&n>c&&r.alert_triggered.delete(`down-${c}`)}return g}function ln(){try{const e=new(window.AudioContext||window.webkitAudioContext),n=e.createOscillator(),r=e.createGain();n.connect(r),r.connect(e.destination),n.frequency.value=1e3,n.type="sine",r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),n.start(e.currentTime),n.stop(e.currentTime+.5)}catch(e){console.error("æ’­æ”¾å£°éŸ³å¤±è´¥:",e),"Notification"in window&&Notification.permission==="granted"&&new Notification("è‚¡ç¥¨æŠ¥è­¦",{body:"ä»·æ ¼è¾¾åˆ°æŠ¥è­¦é˜ˆå€¼",icon:"/favicon.ico"})}}async function cn(e,n){"Notification"in window&&(Notification.permission==="granted"?new Notification(e,{body:n}):Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&new Notification(e,{body:n}))}const dn=Qn({palette:{mode:"light",primary:{main:"#1976d2"}},shape:{borderRadius:0},components:{MuiPaper:{styleOverrides:{root:{borderRadius:0}}},MuiButton:{styleOverrides:{root:{borderRadius:0}}},MuiChip:{styleOverrides:{root:{borderRadius:0}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:0}}}},MuiSelect:{styleOverrides:{root:{borderRadius:0}}},MuiDialog:{styleOverrides:{paper:{borderRadius:0}}}}});function xs(){const[e,n]=x.useState(null),[r,g]=x.useState(new Map),[o,c]=x.useState(!1),[i,l]=x.useState(""),[C,v]=x.useState(!1),[A,u]=x.useState(!1),[m,_]=x.useState(!1),I=_e.useRef(null),E=x.useRef(null),Q=x.useRef(new Map),st=x.useRef(!1),U=async()=>{try{const j=await Tn(),D=JSON.stringify(j,null,2),$=new Blob([D],{type:"application/json"}),V=URL.createObjectURL($),S=document.createElement("a");S.href=V,S.download=`stocks-backup-${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(V),l("æ•°æ®å¯¼å‡ºæˆåŠŸ")}catch(j){console.error("å¯¼å‡ºæ•°æ®å¤±è´¥:",j),l("å¯¼å‡ºæ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•")}},L=async j=>{var $;const D=($=j.target.files)==null?void 0:$[0];if(D)try{const V=await D.text(),S=JSON.parse(V);if(!S||typeof S!="object"){l("å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®");return}u(!0),window.__pendingImportData=S}catch(V){console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",V),l("å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶è¯»å–é”™è¯¯")}finally{I.current&&(I.current.value="")}},it=async()=>{try{const j=window.__pendingImportData;if(!j){l("å¯¼å…¥å¤±è´¥ï¼šæ•°æ®æ— æ•ˆ");return}await Dn(j);const D=await Oe();n(D),u(!1),l("æ•°æ®å¯¼å…¥æˆåŠŸï¼Œé¡µé¢å°†åˆ·æ–°"),setTimeout(()=>{window.location.reload()},1e3)}catch(j){console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",j),l("å¯¼å…¥æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•"),u(!1)}finally{delete window.__pendingImportData}},tt=async()=>{try{const j=await kn();n(j),E.current=j,v(!1),l("æ•°æ®å·²é‡ç½®ä¸ºé»˜è®¤é…ç½®"),window.location.reload()}catch(j){console.error("é‡ç½®æ•°æ®å¤±è´¥:",j),l("é‡ç½®æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•")}};x.useEffect(()=>{(async()=>{try{const D=await Oe();n(D)}catch(D){console.error("åŠ è½½é…ç½®å¤±è´¥:",D)}})()},[]),x.useEffect(()=>{E.current=e},[e]),x.useEffect(()=>{Q.current=r},[r]),x.useEffect(()=>{e&&g(j=>{const D=new Map,$=Object.keys(e.holdings||{});for(const S of $){const M=e.holdings[S],T=Array.isArray(M.transactions)?M.transactions:[],[J,ut]=sn(T),q=j.get(S);D.set(S,{code:S,name:(q==null?void 0:q.name)||S,last_price:(q==null?void 0:q.last_price)??null,last_time:(q==null?void 0:q.last_time)??null,last_update_time:(q==null?void 0:q.last_update_time)||"--",last_change_pct:(q==null?void 0:q.last_change_pct)??0,holding_price:J>0?ut:null,holding_quantity:J,transactions:T,alerts:M.alerts,alert_up:M.alert_up,alert_down:M.alert_down,alert_triggered:(q==null?void 0:q.alert_triggered)??new Set})}const V=Object.keys(e.watchlist||{});for(const S of V){if(D.has(S))continue;const M=e.watchlist[S],T=j.get(S);D.set(S,{code:S,name:(T==null?void 0:T.name)||S,last_price:(T==null?void 0:T.last_price)??null,last_time:(T==null?void 0:T.last_time)??null,last_update_time:(T==null?void 0:T.last_update_time)||"--",last_change_pct:(T==null?void 0:T.last_change_pct)??0,holding_price:null,holding_quantity:0,transactions:[],alerts:M.alerts,alert_up:M.alert_up,alert_down:M.alert_down,alert_triggered:(T==null?void 0:T.alert_triggered)??new Set})}return D})},[e]),x.useEffect(()=>{if(st.current||o||!e)return;const j=()=>{const D=Array.from(r.keys());if(D.length===0){setTimeout(j,100);return}if(st.current)return;st.current=!0,(async()=>{console.log("æ­£åœ¨åˆå§‹åŒ–ï¼Œè·å–è‚¡ç¥¨æ•°æ®...");const V=await $e(D);g(S=>{const M=new Map(S),T=new Date,J=`${T.getHours().toString().padStart(2,"0")}:${T.getMinutes().toString().padStart(2,"0")}:${T.getSeconds().toString().padStart(2,"0")}`;for(const ut of D){const q=M.get(ut);if(q){const rt=V.get(ut);if(rt){const Ft=rt.yesterday_close>0?(rt.price-rt.yesterday_close)/rt.yesterday_close*100:0,ot=an(ut,rt.price,q);if(ot.length>0){ln();const zt=ot.map(z=>{const yt=z.type==="up"?"ä¸Šæ¶¨":"ä¸‹è·Œ";return`${rt.name}(${ut}) ä»·æ ¼${yt}è‡³ ${rt.price.toFixed(2)}ï¼Œè¾¾åˆ°æŠ¥è­¦ä»·æ ¼ ${z.price.toFixed(2)}`}).join("ï¼›");l(zt),cn("è‚¡ç¥¨æŠ¥è­¦",zt)}M.set(ut,{...q,name:rt.name,last_price:rt.price,last_time:new Date,last_update_time:rt.update_time,last_change_pct:Ft})}else M.set(ut,{...q,last_time:new Date,last_update_time:J})}}return M}),c(!0)})()};j()},[e,o,r]),x.useEffect(()=>{if(!o||!e)return;let j=!0;const D=e.update_interval??1e3,$=async()=>{if(!j)return;const S=Array.from(Q.current.keys());if(S.length===0)return;const M=E.current;if(!M||ms())return;const T=S.filter(J=>ps(J,M.market_hours));if(T.length!==0)try{const J=await $e(T);if(!j)return;g(ut=>{const q=new Map(ut),rt=new Date,Ft=`${rt.getHours().toString().padStart(2,"0")}:${rt.getMinutes().toString().padStart(2,"0")}:${rt.getSeconds().toString().padStart(2,"0")}`;for(const z of T){const yt=q.get(z);if(yt){const ct=J.get(z);if(ct){const Kt=ct.yesterday_close>0?(ct.price-ct.yesterday_close)/ct.yesterday_close*100:0,Rt=an(z,ct.price,yt);if(Rt.length>0){ln();const vt=Rt.map(Pt=>{const Bt=Pt.type==="up"?"ä¸Šæ¶¨":"ä¸‹è·Œ";return`${ct.name}(${z}) ä»·æ ¼${Bt}è‡³ ${ct.price.toFixed(2)}ï¼Œè¾¾åˆ°æŠ¥è­¦ä»·æ ¼ ${Pt.price.toFixed(2)}`}).join("ï¼›");l(vt),cn("è‚¡ç¥¨æŠ¥è­¦",vt)}q.set(z,{...yt,name:ct.name,last_price:ct.price,last_time:new Date,last_update_time:ct.update_time,last_change_pct:Kt})}else q.set(z,{...yt,last_time:new Date,last_update_time:Ft})}}const ot=$n(),bt=E.current,zt={date:ot,stocks:Array.from(q.values()).map(z=>({code:z.code,name:z.name,price:z.last_price,change_pct:z.last_change_pct,holding_price:z.holding_price,holding_quantity:z.holding_quantity,holding_value:z.last_price!==null&&z.holding_quantity>0?z.last_price*z.holding_quantity:0,profit:z.holding_price!==null&&z.holding_quantity>0&&z.last_price!==null?(z.last_price-z.holding_price)*z.holding_quantity:null})),funds:bt.funds,timestamp:new Date().toISOString()};return An(ot,zt).catch(z=>{console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",z)}),q})}catch(J){console.error("è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥:",J)}};$();const V=setInterval($,D);return()=>{j=!1,clearInterval(V)}},[o,e==null?void 0:e.update_interval]);const at=_e.useMemo(()=>{const j=Array.from(r.values()),D=(e==null?void 0:e.stock_order)||[];if(D.length>0){const $=new Map(D.map((V,S)=>[V,S]));return j.sort((V,S)=>{const M=$.get(V.code),T=$.get(S.code);return M!==void 0&&T!==void 0?M-T:M!==void 0?-1:T!==void 0?1:V.code.localeCompare(S.code)})}return j.sort(($,V)=>$.code.localeCompare(V.code))},[r,e==null?void 0:e.stock_order]),Y=async()=>{if(!e)return;const j={...e,privacy_mode:!e.privacy_mode},D=await ve(j);n(D),E.current=D},lt=async j=>{const D={...j},$=D.categories||{};let V="æŒä»“";for(const[T,J]of Object.entries($))if(J.isHoldings===!0){V=T;break}$[V]||($[V]={codes:[],title:V,color:"#2e7d32",isHoldings:!0});const S=new Set;for(const[T,J]of Object.entries(D.holdings||{})){const ut=Array.isArray(J.transactions)?J.transactions:[],[q]=sn(ut);q>0&&S.add(T)}$[V]={...$[V],codes:Array.from(S)},D.categories=$;const M=await ve(D);n(M),E.current=M};x.useEffect(()=>{if(!e){document.title="--";return}const j=Array.from(r.values()),D=j.reduce((ot,bt)=>bt.last_price!==null&&bt.holding_quantity>0?ot+bt.last_price*bt.holding_quantity:ot,0),$=(e.historical_holdings||[]).reduce((ot,bt)=>ot+bt.transactions.reduce((zt,z)=>zt+z.quantity*z.price,0),0),V=e.funds.available_funds+D+$,S=j.filter(ot=>ot.holding_price!==null&&ot.holding_quantity>0).length,M=V-e.funds.total_original_funds,T=e.funds.total_original_funds>0?M/e.funds.total_original_funds*100:0,J=j.length>0?j.reduce((ot,bt)=>ot+bt.last_change_pct,0)/j.length:0,ut=D>0||S>0,q=ut?J:0,rt=ut?M:0,Ft=ut?T:0;if(S>0){const ot=rt>=0?"+":"";document.title=`${ot}${rt.toFixed(2)}(${Ft>=0?"+":""}${Ft.toFixed(2)}%)`}else document.title=`${q>=0?"+":""}${q.toFixed(2)}%`},[e,r]);const Mt=x.useRef(null),Et=x.useRef(null),Ot=async j=>{try{await new Promise($=>setTimeout($,100));const D=await $e([j]);if(D.has(j)){const $=D.get(j);g(V=>{const S=new Map(V);let M=S.get(j);if(!M){const J=E.current.watchlist[j];M={code:j,name:j,last_price:null,last_time:null,last_update_time:"--",last_change_pct:0,holding_price:null,holding_quantity:0,transactions:[],alert_up:(J==null?void 0:J.alert_up)||null,alert_down:(J==null?void 0:J.alert_down)||null,alert_triggered_up:!1,alert_triggered_down:!1}}const T=$.yesterday_close>0?($.price-$.yesterday_close)/$.yesterday_close*100:0;return S.set(j,{...M,name:$.name,last_price:$.price,last_time:new Date,last_update_time:$.update_time,last_change_pct:T}),S})}}catch(D){console.error("è·å–æ–°æ·»åŠ è‚¡ç¥¨æ•°æ®å¤±è´¥:",D)}};return e?t.jsxs(Xe,{theme:dn,children:[t.jsx(tn,{}),t.jsxs(en,{maxWidth:"xl",sx:{mt:0,mb:0,pb:0,px:0},children:[t.jsx(ns,{stocks:at,funds:e.funds,privacyMode:e.privacy_mode,onPrivacyModeToggle:Y,config:e,onConfigUpdate:lt}),t.jsx(hs,{config:e,onConfigUpdate:lt,onStockAdded:Ot,stockStates:new Map(Array.from(r.entries()).map(([j,D])=>[j,{name:D.name,last_price:D.last_price}])),onOpenTransactionDialog:j=>{Mt.current=j},onOpenAllTransactionsDialog:j=>{Et.current=j}}),t.jsx(es,{stocks:at,privacyMode:e.privacy_mode,config:e,onConfigUpdate:lt,onAddTransaction:j=>{Mt.current&&Mt.current(j)},onOpenAllTransactionsDialog:j=>{Et.current&&Et.current(j)},onToggleCategorySidebar:j=>{window.__toggleCategorySidebar=j}}),t.jsx(pn,{open:!!i,autoHideDuration:6e3,onClose:()=>l(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(Yn,{severity:"warning",onClose:()=>l(""),children:i})}),t.jsxs(H,{sx:{mt:3,mb:2,textAlign:"center",display:"flex",gap:2,justifyContent:"center"},children:[t.jsx(F,{variant:"outlined",color:"primary",onClick:()=>_(!0),sx:{textTransform:"none"},children:"æ•°æ®å¯¼å…¥å¯¼å‡º"}),t.jsx(F,{variant:"outlined",color:"error",onClick:()=>v(!0),sx:{textTransform:"none"},children:"é‡ç½®æ‰€æœ‰æ•°æ®"})]}),t.jsx("input",{type:"file",ref:I,accept:".json",style:{display:"none"},onChange:L}),t.jsx(fs,{version:gs}),t.jsxs(St,{open:C,onClose:()=>v(!1),children:[t.jsx(Tt,{children:"ç¡®è®¤é‡ç½®æ•°æ®"}),t.jsx(Ct,{children:t.jsxs(Ae,{children:["æ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ç°æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬è‡ªé€‰è‚¡ã€äº¤æ˜“è®°å½•ã€å†å²æ•°æ®ç­‰ï¼‰ï¼Œå¹¶ç”¨é»˜è®¤é…ç½®è¦†ç›–ã€‚",t.jsx("br",{}),t.jsx("strong",{children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼"})]})}),t.jsxs(Dt,{children:[t.jsx(F,{onClick:()=>v(!1),children:"å–æ¶ˆ"}),t.jsx(F,{onClick:tt,color:"error",variant:"contained",children:"ç¡®è®¤é‡ç½®"})]})]}),t.jsxs(St,{open:m,onClose:()=>_(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{children:"æ•°æ®å¯¼å…¥å¯¼å‡º"}),t.jsxs(Ct,{children:[t.jsxs(Ae,{sx:{mb:3},children:["æœ¬é¡¹ç›®ä¸ä¼šä¸Šä¼ ä»»ä½•æ•°æ®åˆ°äº’è”ç½‘ï¼Œæ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ã€‚",t.jsx("br",{}),"å¦‚æœ‰å¤šè®¾å¤‡ä½¿ç”¨ï¼Œè¯·è‡ªè¡Œé€šè¿‡å¯¼å…¥å¯¼å‡ºåŠŸèƒ½åŒæ­¥æ•°æ®ã€‚"]}),t.jsxs(H,{sx:{display:"flex",gap:2,justifyContent:"center",mt:2},children:[t.jsx(F,{variant:"contained",color:"primary",onClick:()=>{_(!1),U()},sx:{textTransform:"none"},children:"å¯¼å‡ºæ•°æ®"}),t.jsx(F,{variant:"contained",color:"primary",onClick:()=>{var j;_(!1),(j=I.current)==null||j.click()},sx:{textTransform:"none"},children:"å¯¼å…¥æ•°æ®"})]})]}),t.jsx(Dt,{children:t.jsx(F,{onClick:()=>_(!1),children:"å…³é—­"})})]}),t.jsxs(St,{open:A,onClose:()=>u(!1),children:[t.jsx(Tt,{children:"ç¡®è®¤å¯¼å…¥æ•°æ®"}),t.jsx(Ct,{children:t.jsxs(Ae,{children:["æ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ç°æœ‰æ•°æ®ï¼Œå¹¶ç”¨å¯¼å…¥çš„æ•°æ®è¦†ç›–ã€‚",t.jsx("br",{}),t.jsx("strong",{children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼"})]})}),t.jsxs(Dt,{children:[t.jsx(F,{onClick:()=>{u(!1),delete window.__pendingImportData},children:"å–æ¶ˆ"}),t.jsx(F,{onClick:it,color:"primary",variant:"contained",children:"ç¡®è®¤å¯¼å…¥"})]})]})]})]}):t.jsxs(Xe,{theme:dn,children:[t.jsx(tn,{}),t.jsx(en,{maxWidth:"xl",sx:{mt:2,mb:2},children:t.jsx(Z,{children:"åŠ è½½é…ç½®ä¸­..."})})]})}function ys(e){try{const n=JSON.parse(e),r={privacy_mode:n.privacy_mode||!1,funds:n.funds||{available_funds:0,total_original_funds:0},market_hours:n.market_hours||{Aè‚¡:{enabled:!0,morning:{start:"09:30",end:"11:30"},afternoon:{start:"13:00",end:"15:00"},weekdays:[1,2,3,4,5]},ç¾è‚¡:{enabled:!1,morning:{start:"22:30",end:"05:00"},afternoon:null,weekdays:[1,2,3,4,5]}},stocks:n.stocks||{}};return ve(r).catch(g=>{console.error("ä¿å­˜é…ç½®å¤±è´¥:",g)}),!0}catch(n){return console.error("å¯¼å…¥é…ç½®å¤±è´¥:",n),!1}}typeof window<"u"&&(window.importStockConfig=ys);"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission();Un.createRoot(document.getElementById("root")).render(t.jsx(_e.StrictMode,{children:t.jsx(xs,{})}));export{sn as c,Zn as f,Me as l};
