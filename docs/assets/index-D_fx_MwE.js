const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KlineChart-Cyb4lT1e.js","assets/react-mui-D92-AcIL.js","assets/vendor-CTCyfRUx.js","assets/charts--AwToQQJ.js"])))=>i.map(i=>d[i]);
import{r as w,j as t,T as Ve,P as we,a as fe,b as me,c as Ft,d as v,e as ge,R as je,C as Ot,B as R,f as D,g as L,h as xn,A as Ht,I as Wt,E as Ue,D as Ye,i as ct,k as pt,l as dt,m as tt,n as ft,F as bt,S as qt,M as at,o as yn,p as wn,q as Pe,s as Ie,t as jn,u as _n,V as bn,v as Sn,w as ze,H as vn,x as Nt,L as Cn,G as Tn,y as An,z as Ee,J as Me,K as Oe,N as $n,O as Dn,Q as he,U as Fn}from"./react-mui-D92-AcIL.js";import"./vendor-CTCyfRUx.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function d(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();const qn="modulepreload",Pn=function(e){return"/"+e},We={},_e=function(n,a,d){let s=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=Promise.allSettled(a.map(b=>{if(b=Pn(b),b in We)return;We[b]=!0;const _=b.endsWith(".css"),C=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${C}`))return;const u=document.createElement("link");if(u.rel=_?"stylesheet":qn,_||(u.as="script"),u.crossOrigin="",u.href=b,l&&u.setAttribute("nonce",l),document.head.appendChild(u),_)return new Promise((S,$)=>{u.addEventListener("load",S),u.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${b}`)))})}))}function o(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return s.then(c=>{for(const l of c||[])l.status==="rejected"&&o(l.reason);return n().catch(o)})};function In(e){if(!e||e.length===0)return[0,0];let n=0,a=0;for(const s of e){const o=Number(s.quantity)||0,c=Number(s.price)||0;if(o!==0&&c>0){const l=o*c;a+=l,n+=o}}n=Math.max(0,n);const d=n>0?a/n:0;return[n,d]}function Ke(e){return/^[A-Z]{1,5}$/.test(e)}function zn(e){return Ke(e)?e:e.startsWith("00")||e.startsWith("30")?`sz${e}`:`sh${e}`}function Gt(e){return e==null?"--":e.toFixed(3)}const En=w.lazy(()=>_e(()=>import("./KlineChart-Cyb4lT1e.js"),__vite__mapDeps([0,1,2,3])).then(e=>({default:e.KlineChart}))),Mn=({stocks:e,privacyMode:n,config:a,onConfigUpdate:d,onAddTransaction:s,onOpenAllTransactionsDialog:o})=>{const[c,l]=w.useState(new Set),[b,_]=w.useState(null),[C,u]=w.useState(null),[S,$]=w.useState(null),[et,P]=w.useState("refund"),[B,Y]=w.useState(null),[N,V]=w.useState(null),[K,X]=w.useState({time:"",quantity:"",totalAmount:""}),nt=r=>r>0?"error":r<0?"success":"default",G=r=>r===null?"default":r>0?"error":r<0?"success":"default",Z=r=>{if(!r||r==="--")return"--";if(r.includes(".")){const f=r.split(".")[0];return f.includes(" ")&&f.split(" ")[1]||f}return r.includes(" ")&&r.split(" ")[1]||r},xt=(r,f,h)=>{_({stockCode:r,index:f,transaction:h});const j=h.totalAmount??Math.abs(h.quantity)*h.price;X({time:h.time,quantity:h.quantity.toString(),totalAmount:j.toString()})},mt=()=>{if(!b)return;const{stockCode:r,index:f,transaction:h}=b,j=parseFloat(K.quantity),A=parseFloat(K.totalAmount);if(isNaN(j)||j===0||isNaN(A)||A<=0||!K.time)return;const x=A/Math.abs(j);if(j<0){const At=a.holdings[r];if(At){const jt=Array.isArray(At.transactions)?At.transactions:[];let _t=0;for(let wt=0;wt<jt.length;wt++)wt!==f&&(_t+=Number(jt[wt].quantity)||0);const yt=_t+j;if(yt<0){alert(`æŒä»“ä¸è¶³ï¼Œä¿®æ”¹åæŒä»“ï¼š${yt.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(j).toFixed(0)}`);return}}}const T=a.holdings[r];if(!T)return;const F=h.totalAmount??Math.abs(h.quantity)*h.price,z=h.quantity>0?-F:F,Q=j>0?-A:A,ot=z-Q,E=[...T.transactions];E[f]={id:h.id,time:K.time,quantity:j,price:x,totalAmount:A};const ht=a.funds.available_funds+ot,st={...a,funds:{...a.funds,available_funds:Math.max(0,ht)},holdings:{...a.holdings,[r]:{...T,transactions:E}}};d(st).then(()=>{_(null),X({time:"",quantity:"",totalAmount:""})})},It=(r,f)=>{u({stockCode:r,index:f})},g=async()=>{if(!C)return;const{stockCode:r,index:f}=C,h=a.holdings[r];if(!h)return;const j=h.transactions[f],A=j.totalAmount??Math.abs(j.quantity)*j.price;if(j.id){const{deleteTransaction:z}=await _e(async()=>{const{deleteTransaction:Q}=await Promise.resolve().then(()=>Vn);return{deleteTransaction:Q}},void 0);await z(j.id)}const x=h.transactions.filter((z,Q)=>Q!==f),T=j.quantity>0?a.funds.available_funds+A:a.funds.available_funds-A,F={...a,funds:{...a.funds,available_funds:T},holdings:{...a.holdings,[r]:{...h,transactions:x}}};d(F).then(()=>{u(null)})},q=r=>{$(r)},U=()=>{if(!B)return;const{stockCode:r,alerts:f}=B,h=[];for(const A of f){const x=parseFloat(A.price.trim());!isNaN(x)&&x>0&&h.push({type:A.type,price:x})}const j={...a,holdings:{...a.holdings},watchlist:{...a.watchlist}};j.holdings[r]?j.holdings[r]={...j.holdings[r],alerts:h.length>0?h:void 0}:j.watchlist[r]?j.watchlist[r]={...j.watchlist[r],alerts:h.length>0?h:void 0}:j.watchlist[r]={alerts:h.length>0?h:void 0},Y(null),d(j)},W=()=>{if(!S)return;const r=S,f=e.find(F=>F.code===r);f!=null&&f.name;let h=0;if(a.holdings[r]){const F=a.holdings[r];F.transactions,h=F.transactions.reduce((z,Q)=>z+Q.quantity*Q.price,0)}const j={...a.holdings};delete j[r];const A={...a.watchlist};let x=a.funds.available_funds;if(et==="refund")x=a.funds.available_funds+h,delete A[r];else if(!A[r]){const F=a.holdings[r];A[r]={alerts:F==null?void 0:F.alerts,alert_up:(F==null?void 0:F.alert_up)||null,alert_down:(F==null?void 0:F.alert_down)||null}}const T={...a,funds:{...a.funds,available_funds:x},holdings:j,watchlist:A,historical_holdings:[]};d(T).then(()=>{$(null),P("refund")})};return t.jsxs(Ve,{component:we,children:[t.jsxs(fe,{size:"small",sx:{minWidth:650},children:[t.jsx(me,{children:t.jsxs(Ft,{sx:{backgroundColor:"#1976d2"},children:[t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:140},children:"åç§°"}),t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:100},children:"ä»£ç "}),t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:80},children:"ç°ä»·"}),t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:80},children:"æ¶¨è·Œå¹…"}),t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:80},children:"æˆæœ¬ä»·"}),t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:80},children:"æ•°é‡"}),t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:200},children:"ç›ˆäº"}),t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:140},children:"æ—¶é—´"}),t.jsx(v,{sx:{color:"white",fontWeight:"bold",width:100},children:"æ“ä½œ"})]})}),t.jsx(ge,{children:e.map(r=>{r.last_price!==null&&r.holding_quantity>0&&r.last_price*r.holding_quantity;const f=r.holding_price!==null&&r.holding_quantity>0&&r.last_price!==null?(r.last_price-r.holding_price)*r.holding_quantity:null,h=r.holding_price!==null&&r.holding_price>0&&f!==null?f/(r.holding_price*r.holding_quantity)*100:null,j=f!==null&&h!==null?n?`***(${h.toFixed(2)}%)`:`${f.toFixed(2)}(${h.toFixed(2)}%)`:"--",A=c.has(r.code);return t.jsxs(je.Fragment,{children:[t.jsxs(Ft,{sx:{"&:nth-of-type(odd)":{backgroundColor:"#f5f5f5"},"&:hover":{backgroundColor:"#e3f2fd"}},children:[t.jsx(v,{children:n?"***":r.name}),t.jsx(v,{children:n?"***":r.code}),t.jsx(v,{children:r.last_price!==null?Gt(r.last_price):"--"}),t.jsx(v,{children:t.jsx(Ot,{label:`${r.last_change_pct>=0?"+":""}${r.last_change_pct.toFixed(2)}%`,color:nt(r.last_change_pct),size:"small"})}),t.jsx(v,{children:r.holding_price!==null?n?"***":Gt(r.holding_price):"--"}),t.jsx(v,{children:r.holding_quantity>0?n?"***":String(Math.floor(r.holding_quantity)):"--"}),t.jsx(v,{children:t.jsx(Ot,{label:j,color:G(f),size:"small"})}),t.jsx(v,{children:Z(r.last_update_time)}),t.jsx(v,{children:t.jsxs(R,{sx:{display:"flex",alignItems:"center",gap:0},children:[t.jsx(D,{size:"small",onClick:()=>{o&&o(r.code)},sx:{color:"#1976d2",textTransform:"none",minWidth:"auto",padding:"4px 4px"},children:"äº¤æ˜“"}),t.jsx(L,{component:"span",sx:{color:"text.secondary",fontSize:"0.875rem",mx:0},children:"|"}),t.jsx(D,{size:"small",onClick:()=>{V({stockCode:r.code,stockName:r.name})},sx:{color:"#9c27b0",textTransform:"none",minWidth:"auto",padding:"4px 4px"},children:"Kå›¾"}),t.jsx(L,{component:"span",sx:{color:"text.secondary",fontSize:"0.875rem",mx:0},children:"|"}),t.jsx(D,{size:"small",onClick:()=>{const x=a.holdings[r.code],T=a.watchlist[r.code],F=[];if(x!=null&&x.alerts&&x.alerts.length>0)x.alerts.forEach(z=>{F.push({type:z.type,price:z.price.toString()})});else if(T!=null&&T.alerts&&T.alerts.length>0)T.alerts.forEach(z=>{F.push({type:z.type,price:z.price.toString()})});else{const z=(x==null?void 0:x.alert_up)??(T==null?void 0:T.alert_up)??null,Q=(x==null?void 0:x.alert_down)??(T==null?void 0:T.alert_down)??null;z!==null&&F.push({type:"up",price:z.toString()}),Q!==null&&F.push({type:"down",price:Q.toString()})}F.length===0&&F.push({type:"up",price:""}),Y({stockCode:r.code,alerts:F})},sx:{color:"#ed6c02",textTransform:"none",minWidth:"auto",padding:"4px 4px"},children:"æŠ¥è­¦"}),t.jsx(L,{component:"span",sx:{color:"text.secondary",fontSize:"0.875rem",mx:0},children:"|"}),t.jsx(D,{size:"small",onClick:()=>q(r.code),sx:{color:"error.main",textTransform:"none",minWidth:"auto",padding:"4px 4px"},children:"åˆ é™¤"})]})})]}),t.jsx(Ft,{children:t.jsx(v,{colSpan:9,sx:{py:0,border:0},children:t.jsx(xn,{in:A,timeout:"auto",unmountOnExit:!0,children:t.jsxs(R,{sx:{margin:2},children:[t.jsxs(R,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(L,{variant:"h6",children:"äº¤æ˜“è®°å½•"}),t.jsx(D,{startIcon:t.jsx(Ht,{}),onClick:()=>{s?s(r.code):window.__openTransactionDialog&&window.__openTransactionDialog(r.code)},sx:{textTransform:"none",color:"#9c27b0","&:hover":{backgroundColor:"transparent",textDecoration:"underline"}},children:"äº¤æ˜“"})]}),r.transactions&&r.transactions.length>0?t.jsxs(fe,{size:"small",children:[t.jsx(me,{children:t.jsxs(Ft,{children:[t.jsx(v,{children:"ID"}),t.jsx(v,{children:"æ—¶é—´"}),t.jsx(v,{children:"ç±»å‹"}),t.jsx(v,{children:"æ•°é‡ï¼ˆè‚¡ï¼‰"}),t.jsx(v,{children:"å•ä»·"}),t.jsx(v,{children:"æ€»é‡‘é¢"}),t.jsx(v,{align:"right",children:"æ“ä½œ"})]})}),t.jsx(ge,{children:r.transactions.map((x,T)=>{const F=x.quantity>0,z=x.totalAmount??Math.abs(x.quantity)*x.price;return t.jsxs(Ft,{children:[t.jsx(v,{children:x.id||"--"}),t.jsx(v,{children:x.time}),t.jsx(v,{children:t.jsx(Ot,{label:F?"ä¹°å…¥":"å–å‡º",size:"small",color:F?"primary":"secondary"})}),t.jsx(v,{children:n?"***":Math.floor(Math.abs(x.quantity)).toLocaleString()}),t.jsx(v,{children:n?"***":Gt(x.price)}),t.jsx(v,{children:n?"***":z.toFixed(2)}),t.jsxs(v,{align:"right",children:[t.jsx(Wt,{size:"small",onClick:()=>xt(r.code,T,x),sx:{color:"#1976d2"},children:t.jsx(Ue,{fontSize:"small"})}),t.jsx(Wt,{size:"small",onClick:()=>It(r.code,T),sx:{color:"error.main"},children:t.jsx(Ye,{fontSize:"small"})})]})]},T)})})]}):t.jsx(R,{sx:{textAlign:"center",py:3,color:"text.secondary"},children:t.jsx(L,{variant:"body2",children:"æš‚æ— äº¤æ˜“è®°å½•"})})]})})})})]},r.code)})})]}),t.jsxs(ct,{open:!!b,onClose:()=>_(null),maxWidth:"xs",fullWidth:!0,children:[t.jsx(pt,{sx:{pb:1},children:"ç¼–è¾‘äº¤æ˜“è®°å½•"}),t.jsx(dt,{sx:{pt:1},children:t.jsxs(R,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsx(tt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",size:"small",fullWidth:!0,variant:"outlined",value:K.time?(()=>{try{const r=new Date(K.time),f=r.getFullYear(),h=String(r.getMonth()+1).padStart(2,"0"),j=String(r.getDate()).padStart(2,"0"),A=String(r.getHours()).padStart(2,"0"),x=String(r.getMinutes()).padStart(2,"0");return`${f}-${h}-${j}T${A}:${x}`}catch{return""}})():"",onChange:r=>{const f=r.target.value;if(f){const h=new Date(f),j=h.getFullYear(),A=String(h.getMonth()+1).padStart(2,"0"),x=String(h.getDate()).padStart(2,"0"),T=String(h.getHours()).padStart(2,"0"),F=String(h.getMinutes()).padStart(2,"0"),z=String(h.getSeconds()).padStart(2,"0");X({...K,time:`${j}-${A}-${x} ${T}:${F}:${z}`})}},InputLabelProps:{shrink:!0}}),t.jsx(tt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:K.quantity,onChange:r=>{const f=r.target.value;(f===""||f==="-"||/^-?\d*\.?\d*$/.test(f))&&X({...K,quantity:f})},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡º"}),t.jsx(tt,{label:"å•ä»·",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:K.price,onChange:r=>X({...K,price:r.target.value}),inputProps:{min:0,step:.001}})]})}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:()=>_(null),children:"å–æ¶ˆ"}),t.jsx(D,{size:"small",onClick:mt,variant:"contained",children:"ä¿å­˜"})]})]}),t.jsxs(ct,{open:!!C,onClose:()=>u(null),maxWidth:"xs",fullWidth:!0,children:[t.jsx(pt,{sx:{pb:1},children:"ç¡®è®¤åˆ é™¤"}),t.jsx(dt,{sx:{pt:1},children:t.jsx(L,{variant:"body2",children:"ç¡®å®šè¦åˆ é™¤è¿™æ¡äº¤æ˜“è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"})}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:()=>u(null),children:"å–æ¶ˆ"}),t.jsx(D,{size:"small",onClick:g,variant:"contained",color:"error",children:"åˆ é™¤"})]})]}),t.jsxs(ct,{open:!!B,onClose:()=>Y(null),maxWidth:"sm",fullWidth:!0,children:[t.jsx(pt,{sx:{pb:1},children:"æŠ¥è­¦é…ç½®"}),t.jsx(dt,{sx:{pt:1},children:B&&t.jsxs(t.Fragment,{children:[t.jsx(L,{variant:"body2",sx:{mb:1.5,color:"text.secondary"},children:"è®¾ç½®ä»·æ ¼æŠ¥è­¦è§„åˆ™ï¼Œå½“è‚¡ä»·è¾¾åˆ°è®¾å®šä»·æ ¼æ—¶ä¼šå‘å‡ºæé†’ã€‚å¯ä»¥æ·»åŠ å¤šæ¡è§„åˆ™ã€‚"}),B.alerts.map((r,f)=>t.jsxs(R,{sx:{display:"flex",gap:1,mb:2,alignItems:"center"},children:[t.jsx(bt,{size:"small",sx:{minWidth:100},children:t.jsxs(qt,{value:r.type,onChange:h=>{const j=[...B.alerts];j[f].type=h.target.value,Y({...B,alerts:j})},children:[t.jsx(at,{value:"up",children:"ä¸Šæ¶¨"}),t.jsx(at,{value:"down",children:"ä¸‹è·Œ"})]})}),t.jsx(tt,{label:"é‡‘é¢",type:"number",size:"small",fullWidth:!0,value:r.price,onChange:h=>{const j=[...B.alerts];j[f].price=h.target.value,Y({...B,alerts:j})},placeholder:"æŠ¥è­¦ä»·æ ¼",inputProps:{step:"0.01",min:"0"}}),t.jsx(Wt,{size:"small",onClick:()=>{const h=B.alerts.filter((j,A)=>A!==f);h.length===0&&h.push({type:"up",price:""}),Y({...B,alerts:h})},color:"error",children:t.jsx(yn,{})})]},f)),t.jsx(D,{size:"small",startIcon:t.jsx(Ht,{}),onClick:()=>{Y({...B,alerts:[...B.alerts,{type:"up",price:""}]})},sx:{mt:1},children:"æ·»åŠ è§„åˆ™"})]})}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:()=>Y(null),children:"å–æ¶ˆ"}),t.jsx(D,{size:"small",onClick:U,variant:"contained",children:"ä¿å­˜"})]})]}),t.jsxs(ct,{open:!!S,onClose:()=>{$(null),P("refund")},maxWidth:"sm",fullWidth:!0,children:[t.jsx(pt,{sx:{pb:1},children:"ç¡®è®¤åˆ é™¤è‡ªé€‰è‚¡"}),t.jsxs(dt,{sx:{pt:1},children:[t.jsx(L,{variant:"body2",sx:{mb:1.5},children:"ç¡®å®šè¦åˆ é™¤è¯¥è‡ªé€‰è‚¡å—ï¼Ÿè¯·é€‰æ‹©åˆ é™¤æ–¹å¼ï¼š"}),t.jsx(bt,{component:"fieldset",children:t.jsxs(wn,{value:et,onChange:r=>P(r.target.value),children:[t.jsx(Pe,{value:"refund",control:t.jsx(Ie,{}),label:t.jsxs(R,{children:[t.jsx(L,{variant:"body1",sx:{fontWeight:"bold"},children:"åˆ é™¤å¹¶é€€å›æ‰€æœ‰äº¤æ˜“"}),t.jsx(L,{variant:"body2",color:"text.secondary",children:"åˆ é™¤è¯¥è‚¡ç¥¨çš„æ‰€æœ‰äº¤æ˜“è®°å½•ï¼Œå¹¶å°†äº¤æ˜“é‡‘é¢é€€å›å¯ç”¨èµ„é‡‘"})]})}),t.jsx(Pe,{value:"keep",control:t.jsx(Ie,{}),label:t.jsxs(R,{children:[t.jsx(L,{variant:"body1",sx:{fontWeight:"bold"},children:"åˆ é™¤ä½†ä¿ç•™äº¤æ˜“è®°å½•"}),t.jsx(L,{variant:"body2",color:"text.secondary",children:"åˆ é™¤è¯¥è‚¡ç¥¨ï¼Œä½†å°†äº¤æ˜“è®°å½•è½¬ç§»åˆ°å†å²äº¤æ˜“æ•°æ®ä¸­ï¼Œä¸é€€å›èµ„é‡‘"})]})})]})}),t.jsx(L,{sx:{mt:2,fontWeight:"bold",color:"error.main"},children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ"})]}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:()=>{$(null),P("refund")},children:"å–æ¶ˆ"}),t.jsx(D,{size:"small",onClick:W,variant:"contained",color:"error",children:"ç¡®è®¤åˆ é™¤"})]})]}),N&&t.jsx(w.Suspense,{fallback:t.jsx(ct,{open:!0,onClose:()=>V(null),maxWidth:"lg",fullWidth:!0,children:t.jsx(dt,{children:t.jsx(R,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:t.jsx(jn,{})})})}),children:t.jsx(En,{open:!!N,onClose:()=>V(null),stockCode:N.stockCode,stockName:N.stockName})})]})},On=({stocks:e,funds:n,privacyMode:a,onPrivacyModeToggle:d,config:s,onConfigUpdate:o})=>{const c=G=>a?"***":G.toFixed(2),l=e.reduce((G,Z)=>Z.last_price!==null&&Z.holding_quantity>0?G+Z.last_price*Z.holding_quantity:G,0),b=(s.historical_holdings||[]).reduce((G,Z)=>G+Z.transactions.reduce((xt,mt)=>xt+mt.quantity*mt.price,0),0),_=n.available_funds+l+b,C=e.filter(G=>G.holding_price!==null&&G.holding_quantity>0).length,u=_-n.total_original_funds,S=n.total_original_funds>0?u/n.total_original_funds*100:0,$=e.length>0?e.reduce((G,Z)=>G+Z.last_change_pct,0)/e.length:0,et=_>0?l/_*100:0,P=l>0||C>0,B=P?$:0,Y=P?u:0,N=P?S:0,V=new Date,K=`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}-${String(V.getDate()).padStart(2,"0")} ${String(V.getHours()).padStart(2,"0")}:${String(V.getMinutes()).padStart(2,"0")}:${String(V.getSeconds()).padStart(2,"0")}`,X=s.update_interval??1e3,nt=async G=>{const Z={...s,update_interval:G};await o(Z)};return t.jsxs(we,{sx:{p:1.5,mb:1.5,backgroundColor:"#f5f5f5",position:"relative"},children:[t.jsxs(R,{sx:{position:"absolute",top:8,right:8,display:"flex",alignItems:"center",gap:1},children:[t.jsx(bt,{size:"small",sx:{minWidth:80},children:t.jsxs(qt,{value:X,onChange:G=>nt(G.target.value),sx:{fontSize:"0.75rem",height:"28px","& .MuiSelect-select":{py:.5}},children:[t.jsx(at,{value:1e3,children:"1s"}),t.jsx(at,{value:3e3,children:"3s"}),t.jsx(at,{value:5e3,children:"5s"}),t.jsx(at,{value:1e4,children:"10s"})]})}),t.jsx(_n,{title:a?"æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯":"éšè—æ•æ„Ÿä¿¡æ¯",children:t.jsx(Wt,{onClick:d,sx:{color:a?"text.secondary":"primary.main"},size:"small",children:a?t.jsx(bn,{}):t.jsx(Sn,{})})})]}),t.jsx(R,{sx:{mb:.5},children:t.jsxs(L,{variant:"body2",component:"span",sx:{color:"text.secondary",fontSize:"0.875rem"},children:["æ—¶é—´:",K," | è‡ªé€‰:",e.length," | æ¶¨è·Œå¹…:",t.jsxs(L,{variant:"body2",component:"span",sx:{color:P?B>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:[B>=0?"+":"",B.toFixed(2),"%"]})," | æŒä»“:",C," | ç›ˆäº:",a?t.jsxs(L,{variant:"body2",component:"span",sx:{color:P?N>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:["***(",N>=0?"+":"",N.toFixed(2),"%)"]}):t.jsxs(L,{variant:"body2",component:"span",sx:{color:P?Y>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:[Y>=0?"+":"",c(Y),"(",N>=0?"+":"",N.toFixed(2),"%)"]})]})}),t.jsx(R,{children:t.jsxs(L,{variant:"body2",component:"span",sx:{color:"text.secondary",fontSize:"0.875rem"},children:["æœ¬é‡‘:",c(n.total_original_funds)," | å®æ—¶å¸‚å€¼:",c(_)," | æŒä»“å¸‚å€¼:",c(l)," | å¯ç”¨èµ„é‡‘:",c(n.available_funds)," | ä»“ä½:",et.toFixed(2),"%"]})})]})};async function Qe(e){const n=new Map;if(e.length===0)return n;try{const a=e.map(o=>zn(o)),d=new Map;a.forEach((o,c)=>{d.set(o,e[c])});const s=`https://qt.gtimg.cn/q=${a.join(",")}`;return new Promise((o,c)=>{const l=document.createElement("script"),b=`tencent_batch_callback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;window[b]=()=>{delete window[b],document.body.contains(l)&&document.body.removeChild(l);try{for(const _ of a){const C=d.get(_),u=`v_${_}`,S=window[u];if(!S||typeof S!="string")continue;const $=S.split("~");if($.length<5)continue;const et=$[1]||C,P=parseFloat($[3])||0,B=parseFloat($[4])||0;if(P<=0)continue;let Y="";for(let N=0;N<$.length;N++){const V=$[N];if(/^\d{14}$/.test(V)){const K=V.substring(8,10),X=V.substring(10,12),nt=V.substring(12,14);Y=`${K}:${X}:${nt}.000`;break}}if(!Y){const N=new Date,V=N.getHours().toString().padStart(2,"0"),K=N.getMinutes().toString().padStart(2,"0"),X=N.getSeconds().toString().padStart(2,"0"),nt=N.getMilliseconds().toString().padStart(3,"0");Y=`${V}:${K}:${X}.${nt}`}n.set(C,{price:P,name:et,yesterday_close:B||P,update_time:Y})}}catch(_){console.error("è§£æè…¾è®¯APIæ‰¹é‡æ•°æ®å¤±è´¥:",_)}o(n)},l.src=s,l.onerror=()=>{delete window[b],document.body.contains(l)&&document.body.removeChild(l),o(n)},l.onload=()=>{setTimeout(()=>{window[b]?window[b]():o(n)},100)},document.body.appendChild(l),setTimeout(()=>{document.body.contains(l)&&(delete window[b],document.body.removeChild(l),o(n))},1e4)})}catch(a){return console.error("æ‰¹é‡è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥ï¼ˆè…¾è®¯ï¼‰:",a),n}}async function ke(e){try{return(await Qe([e])).get(e)||null}catch(n){return console.warn(`è…¾è®¯APIè·å– ${e} å¤±è´¥:`,n),null}}async function pe(e){if(e.length===0)return new Map;try{return await Qe(e)}catch(n){return console.error("æ‰¹é‡è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥:",n),new Map}}const Wn=!1,kn={available_funds:1e4,total_original_funds:1e4},Nn={Aè‚¡:{enabled:!0,morning:{start:"09:30",end:"11:30"},afternoon:{start:"13:00",end:"15:00"},weekdays:[1,2,3,4,5]},ç¾è‚¡:{enabled:!1,morning:{start:"22:30",end:"05:00"},afternoon:null,weekdays:[1,2,3,4,5]}},Hn={},Rn={600228:{alert_up:null,alert_down:null},"002255":{alert_up:null,alert_down:null}},Ln={privacy_mode:Wn,funds:kn,market_hours:Nn,holdings:Hn,watchlist:Rn},Ge="stocks_db",Ne=4,gt="watchlist",rt="transactions",vt="config",Ct="history";let St=null;async function Bn(){return new Promise((e,n)=>{const a=indexedDB.deleteDatabase(Ge);a.onsuccess=()=>{St=null,e()},a.onerror=()=>n(new Error("åˆ é™¤ IndexedDB å¤±è´¥")),a.onblocked=()=>n(new Error("åˆ é™¤ IndexedDB è¢«é˜»å¡"))})}function ut(){return St?Promise.resolve(St):new Promise((e,n)=>{const a=indexedDB.open(Ge,Ne);a.onerror=()=>{n(new Error("æ‰“å¼€ IndexedDB å¤±è´¥"))},a.onupgradeneeded=d=>{const s=d.target.result,o=d.oldVersion||0;console.log(`IndexedDB å‡çº§: ä»ç‰ˆæœ¬ ${o} åˆ°ç‰ˆæœ¬ ${Ne}`),o>0&&(s.objectStoreNames.contains("holdings_transactions")&&s.deleteObjectStore("holdings_transactions"),s.objectStoreNames.contains("historical_holdings")&&s.deleteObjectStore("historical_holdings")),s.objectStoreNames.contains(gt)||s.createObjectStore(gt,{keyPath:"code"}).createIndex("code","code",{unique:!0}),s.objectStoreNames.contains(rt)||s.createObjectStore(rt,{keyPath:"id",autoIncrement:!0}).createIndex("code","code",{unique:!1}),s.objectStoreNames.contains(vt)||s.createObjectStore(vt,{keyPath:"key"}).createIndex("key","key",{unique:!0}),s.objectStoreNames.contains(Ct)||s.createObjectStore(Ct,{keyPath:"date"}).createIndex("date","date",{unique:!0})},a.onsuccess=()=>{St=a.result,e(St)}})}async function Tt(e){try{const d=(await ut()).transaction([gt],"readwrite").objectStore(gt);await new Promise((s,o)=>{const c=d.put(e);c.onsuccess=()=>s(),c.onerror=()=>o(new Error("ä¿å­˜è‡ªé€‰è‚¡å¤±è´¥"))})}catch(n){throw console.error("ä¿å­˜è‡ªé€‰è‚¡å¤±è´¥:",n),n}}async function Je(e){try{const d=(await ut()).transaction([gt],"readonly").objectStore(gt);return new Promise((s,o)=>{const c=d.get(e);c.onsuccess=()=>{s(c.result||null)},c.onerror=()=>o(new Error("åŠ è½½è‡ªé€‰è‚¡å¤±è´¥"))})}catch(n){return console.error("åŠ è½½è‡ªé€‰è‚¡å¤±è´¥:",n),null}}async function Rt(){try{const a=(await ut()).transaction([gt],"readonly").objectStore(gt);return new Promise((d,s)=>{const o=a.getAll();o.onsuccess=()=>{const c={};o.result.forEach(l=>{c[l.code]=l}),d(c)},o.onerror=()=>s(new Error("åŠ è½½æ‰€æœ‰è‡ªé€‰è‚¡å¤±è´¥"))})}catch(e){return console.error("åŠ è½½æ‰€æœ‰è‡ªé€‰è‚¡å¤±è´¥:",e),{}}}async function Ze(e){try{const d=(await ut()).transaction([gt],"readwrite").objectStore(gt);await new Promise((s,o)=>{const c=d.delete(e);c.onsuccess=()=>s(),c.onerror=()=>o(new Error("åˆ é™¤è‡ªé€‰è‚¡å¤±è´¥"))})}catch(n){throw console.error("åˆ é™¤è‡ªé€‰è‚¡å¤±è´¥:",n),n}}async function ee(e,n){try{const s=(await ut()).transaction([rt],"readwrite").objectStore(rt),o=new Error().stack,c=n||"unknown";return console.log("ğŸ”µ [æ·»åŠ äº¤æ˜“è®°å½•]",{source:c,code:e.code,time:e.time,quantity:e.quantity,price:e.price,stack:o==null?void 0:o.split(`
`).slice(1,5).join(`
`)}),new Promise((l,b)=>{const _=s.add(e);_.onsuccess=()=>{const C=_.result;console.log("âœ… [äº¤æ˜“è®°å½•å·²æ·»åŠ ]",{source:c,id:C,code:e.code,time:e.time}),l(C)},_.onerror=()=>b(new Error("æ·»åŠ äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(a){throw console.error("âŒ [æ·»åŠ äº¤æ˜“è®°å½•å¤±è´¥]",{source:n||"unknown",error:a,transaction:e}),a}}async function Zt(e,n){try{const s=(await ut()).transaction([rt],"readwrite").objectStore(rt);await new Promise((o,c)=>{const l=s.put({...n,id:e});l.onsuccess=()=>o(),l.onerror=()=>c(new Error("æ›´æ–°äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(a){throw console.error("æ›´æ–°äº¤æ˜“è®°å½•å¤±è´¥:",a),a}}async function Xt(e){try{const d=(await ut()).transaction([rt],"readwrite").objectStore(rt);await new Promise((s,o)=>{const c=d.delete(e);c.onsuccess=()=>s(),c.onerror=()=>o(new Error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(n){throw console.error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥:",n),n}}async function be(e){try{const s=(await ut()).transaction([rt],"readonly").objectStore(rt).index("code");return new Promise((o,c)=>{const l=s.getAll(e);l.onsuccess=()=>{o(l.result||[])},l.onerror=()=>c(new Error("åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(n){return console.error("åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥:",n),[]}}async function Se(){try{const a=(await ut()).transaction([rt],"readonly").objectStore(rt);return new Promise((d,s)=>{const o=a.getAll();o.onsuccess=()=>{const c={};o.result.forEach(l=>{c[l.code]||(c[l.code]=[]),c[l.code].push(l)}),d(c)},o.onerror=()=>s(new Error("åŠ è½½æ‰€æœ‰äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(e){return console.error("åŠ è½½æ‰€æœ‰äº¤æ˜“è®°å½•å¤±è´¥:",e),{}}}async function ve(){try{St&&(St.close(),St=null),await new Promise(e=>setTimeout(e,100));try{await Bn(),await new Promise(e=>setTimeout(e,100))}catch{console.log("åˆ é™¤æ•°æ®åº“è¢«é˜»å¡ï¼Œæ”¹ä¸ºæ¸…ç©ºå„ä¸ªè¡¨");const n=await ut(),d=n.transaction([gt],"readwrite").objectStore(gt);await new Promise((C,u)=>{const S=d.clear();S.onsuccess=()=>C(),S.onerror=()=>u(new Error("æ¸…ç©º watchlist å¤±è´¥"))});const o=n.transaction([rt],"readwrite").objectStore(rt);await new Promise((C,u)=>{const S=o.clear();S.onsuccess=()=>C(),S.onerror=()=>u(new Error("æ¸…ç©º transactions å¤±è´¥"))});const l=n.transaction([vt],"readwrite").objectStore(vt);await new Promise((C,u)=>{const S=l.clear();S.onsuccess=()=>C(),S.onerror=()=>u(new Error("æ¸…ç©º config å¤±è´¥"))});const _=n.transaction([Ct],"readwrite").objectStore(Ct);await new Promise((C,u)=>{const S=_.clear();S.onsuccess=()=>C(),S.onerror=()=>u(new Error("æ¸…ç©º history å¤±è´¥"))})}}catch(e){throw console.error("æ¸…ç©ºæ‰€æœ‰æ•°æ®å¤±è´¥:",e),e}}async function Xe(e){try{const d=(await ut()).transaction([rt],"readwrite").objectStore(rt),s=d.index("code");return new Promise((o,c)=>{const l=s.openKeyCursor(IDBKeyRange.only(e)),b=[];l.onsuccess=_=>{const C=_.target.result;if(C)b.push(C.primaryKey),C.continue();else{const u=b.map(S=>new Promise(($,et)=>{const P=d.delete(S);P.onsuccess=()=>$(),P.onerror=()=>et()}));Promise.all(u).then(()=>o()).catch(c)}},l.onerror=()=>c(new Error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(n){throw console.error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥:",n),n}}async function Jt(e,n){const a=await be(e),d=new Set(a.map(s=>s.id).filter(s=>s!==void 0));for(const s of a)s.id&&(n.some(c=>{if(c.id===s.id)return!0;const l=c.time===s.time,b=Math.abs(c.quantity-s.quantity)<1e-4,_=Math.abs(c.price-s.price)<1e-4;return l&&b&&_})||await Xt(s.id));for(const s of n){const o={code:e,time:s.time,quantity:s.quantity,price:s.price,totalAmount:s.totalAmount};if(s.id&&d.has(s.id))await Zt(s.id,o);else{let c;for(const l of a)if(l.id){const b=l.time===s.time,_=Math.abs(l.quantity-s.quantity)<1e-4,C=Math.abs(l.price-s.price)<1e-4;if(b&&_&&C){c=l.id;break}}if(c){const l=a.find(b=>b.id===c);l&&(l.time!==o.time||Math.abs(l.quantity-o.quantity)>=1e-4||Math.abs(l.price-o.price)>=1e-4)&&await Zt(c,o)}else await ee(o,`saveHoldingsTransactions-${e}`)}}}async function tn(e){return(await be(e)).map(a=>({id:a.id,time:a.time,quantity:a.quantity,price:a.price,totalAmount:a.totalAmount}))}async function Pt(){const e=await Se(),n={};for(const[a,d]of Object.entries(e))n[a]=d.map(s=>({id:s.id,time:s.time,quantity:s.quantity,price:s.price,totalAmount:s.totalAmount}));return n}async function en(e){await Xe(e)}async function Lt(e){try{const d=(await ut()).transaction([vt],"readwrite").objectStore(vt),s={key:"main",privacy_mode:e.privacy_mode,update_interval:e.update_interval,funds:e.funds,market_hours:e.market_hours,holdings:e.holdings,watchlist:e.watchlist};await new Promise((o,c)=>{const l=d.put(s);l.onsuccess=()=>o(),l.onerror=()=>c(new Error("ä¿å­˜é…ç½®å¤±è´¥"))})}catch(n){throw console.error("ä¿å­˜é…ç½®å¤±è´¥:",n),n}}async function Ce(){try{const a=(await ut()).transaction([vt],"readonly").objectStore(vt);return new Promise((d,s)=>{const o=a.get("main");o.onsuccess=()=>{const c=o.result;d(c?{privacy_mode:c.privacy_mode,update_interval:c.update_interval,funds:c.funds,market_hours:c.market_hours,holdings:c.holdings,watchlist:c.watchlist}:null)},o.onerror=()=>s(new Error("åŠ è½½é…ç½®å¤±è´¥"))})}catch(e){return console.error("åŠ è½½é…ç½®å¤±è´¥:",e),null}}async function Te(e,n){try{const s=(await ut()).transaction([Ct],"readwrite").objectStore(Ct);await new Promise((o,c)=>{const l=s.put({date:e,data:n});l.onsuccess=()=>o(),l.onerror=()=>c(new Error("ä¿å­˜å†å²æ•°æ®å¤±è´¥"))})}catch(a){throw console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",a),a}}async function nn(){try{const e=await Rt(),n=await Se(),a={};for(const[_,C]of Object.entries(n))a[_]=C.map(u=>({id:u.id,code:u.code,time:u.time,quantity:u.quantity,price:u.price,totalAmount:u.totalAmount}));const{loadHoldingsConfig:d}=await _e(async()=>{const{loadHoldingsConfig:_}=await Promise.resolve().then(()=>Un);return{loadHoldingsConfig:_}},void 0),s=await d(),l=(await ut()).transaction([Ct],"readonly").objectStore(Ct),b={};return await new Promise((_,C)=>{const u=l.getAll();u.onsuccess=()=>{u.result.forEach(S=>{b[S.date]=S.data}),_()},u.onerror=()=>C(new Error("åŠ è½½å†å²æ•°æ®å¤±è´¥"))}),{watchlist:e,transactions:a,config:s,history:b}}catch(e){throw console.error("å¯¼å‡ºæ•°æ®å¤±è´¥:",e),e}}async function sn(e){try{await ve();for(const[n,a]of Object.entries(e.watchlist||{}))await Tt(a);for(const[n,a]of Object.entries(e.transactions||{}))if(Array.isArray(a)&&a.length>0)for(const d of a){const{id:s,...o}=d,c={code:n,time:o.time,quantity:o.quantity,price:o.price,totalAmount:o.totalAmount};await ee(c,`import-${n}`)}e.config&&await Lt(e.config);for(const[n,a]of Object.entries(e.history||{}))await Te(n,a)}catch(n){throw console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",n),n}}const Vn=Object.freeze(Object.defineProperty({__proto__:null,addTransaction:ee,clearAllData:ve,deleteHoldingsTransactions:en,deleteTransaction:Xt,deleteTransactionsByCode:Xe,deleteWatchlistItem:Ze,exportAllData:nn,importAllData:sn,loadAllHoldingsTransactions:Pt,loadAllTransactions:Se,loadAllWatchlistItems:Rt,loadConfig:Ce,loadHoldingsTransactions:tn,loadTransactionsByCode:be,loadWatchlistItem:Je,saveConfig:Lt,saveHistoryData:Te,saveHoldingsTransactions:Jt,saveWatchlistItem:Tt,updateTransaction:Zt},Symbol.toStringTag,{value:"Module"}));function Ae(){return Ln}async function xe(){let e=await Ce(),n;e?n={privacy_mode:e.privacy_mode??!1,update_interval:e.update_interval??1e3,funds:e.funds||{available_funds:0,total_original_funds:0},market_hours:e.market_hours||{},holdings:e.holdings||{},watchlist:e.watchlist||{},historical_holdings:[]}:(console.log("IndexedDB ä¸­æ²¡æœ‰é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®åˆå§‹åŒ–"),n=Ae(),n.update_interval||(n.update_interval=1e3),await Lt(n));const a=await Rt(),d=await Pt();n.holdings={},n.watchlist={};const s=new Date,o=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")} ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}:${String(s.getSeconds()).padStart(2,"0")}`;for(const[c,l]of Object.entries(a)){const b=d[c]||[],_=Array.isArray(b)?b:[],C=l.add_time||o;let u;l.alert_up!==null&&l.alert_up!==void 0&&(u=u||[],u.push({type:"up",price:l.alert_up})),l.alert_down!==null&&l.alert_down!==void 0&&(u=u||[],u.push({type:"down",price:l.alert_down})),_.length>0?n.holdings[c]={transactions:_,alerts:u&&u.length>0?u:void 0,alert_up:l.alert_up,alert_down:l.alert_down}:n.watchlist[c]={alerts:u&&u.length>0?u:void 0,add_time:C,alert_up:l.alert_up,alert_down:l.alert_down},l.add_time||await Tt({...l,add_time:o})}return n.historical_holdings=[],n}async function ye(){const e=await Ce();let n;e?n={privacy_mode:e.privacy_mode??!1,update_interval:e.update_interval??1e3,funds:e.funds||{available_funds:0,total_original_funds:0},market_hours:e.market_hours||{},holdings:e.holdings||{},watchlist:e.watchlist||{},historical_holdings:[]}:n=Ae();const a=await Rt(),d=await Pt();n.holdings={},n.watchlist={};const s=new Date,o=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")} ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}:${String(s.getSeconds()).padStart(2,"0")}`;for(const[c,l]of Object.entries(a)){const b=d[c]||[],_=Array.isArray(b)?b:[],C=l.add_time||o;let u;l.alert_up!==null&&l.alert_up!==void 0&&(u=u||[],u.push({type:"up",price:l.alert_up})),l.alert_down!==null&&l.alert_down!==void 0&&(u=u||[],u.push({type:"down",price:l.alert_down})),_.length>0?n.holdings[c]={transactions:_,alerts:u&&u.length>0?u:void 0,alert_up:l.alert_up,alert_down:l.alert_down}:n.watchlist[c]={alerts:u&&u.length>0?u:void 0,add_time:C,alert_up:l.alert_up,alert_down:l.alert_down},l.add_time||await Tt({...l,add_time:o})}return n.historical_holdings=[],n}async function te(e){try{const n=new Set;Object.keys(e.holdings||{}).forEach(s=>n.add(s)),Object.keys(e.watchlist||{}).forEach(s=>n.add(s));for(const s of n){const o=e.holdings[s],c=e.watchlist[s];if(o){const l=await Je(s);let b=(l==null?void 0:l.add_time)||new Date().toISOString().replace("T"," ").substring(0,19);if(o.transactions&&o.transactions.length>0){const u=o.transactions.map(S=>S.time).filter(S=>S);if(u.length>0){const S=u.map(P=>new Date(P.replace(" ","T"))),$=new Date(Math.min(...S.map(P=>P.getTime()))),et=new Date(b.replace(" ","T"));if($<et){const P=$.getFullYear(),B=String($.getMonth()+1).padStart(2,"0"),Y=String($.getDate()).padStart(2,"0"),N=String($.getHours()).padStart(2,"0"),V=String($.getMinutes()).padStart(2,"0"),K=String($.getSeconds()).padStart(2,"0");b=`${P}-${B}-${Y} ${N}:${V}:${K}`}}}let _=o.alert_up??null,C=o.alert_down??null;if(o.alerts&&o.alerts.length>0){const u=o.alerts.find($=>$.type==="up"),S=o.alerts.find($=>$.type==="down");_=u?u.price:null,C=S?S.price:null}if(await Tt({code:s,name:s,alert_up:_,alert_down:C,add_time:b}),o.transactions&&o.transactions.length>0)if(o.transactions.every(S=>S.id!==void 0))await Jt(s,o.transactions);else{const S=await tn(s);S.length===o.transactions.length?await Jt(s,S):await Jt(s,o.transactions)}else await en(s)}else if(c){let l=c.alert_up??null,b=c.alert_down??null;if(c.alerts&&c.alerts.length>0){const _=c.alerts.find(u=>u.type==="up"),C=c.alerts.find(u=>u.type==="down");l=_?_.price:null,b=C?C.price:null}await Tt({code:s,name:s,alert_up:l,alert_down:b,add_time:c.add_time})}}const a=await Rt(),d=await Pt();for(const s of Object.keys(a))n.has(s)||(!d[s]||d[s].length===0)&&await Ze(s);await Lt(e)}catch(n){console.error("ä¿å­˜é…ç½®å¤±è´¥:",n)}}async function an(e,n){try{await Te(e,n)}catch(a){console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",a)}}function rn(){return new Date().toISOString().split("T")[0]}async function on(){try{await ve();const e=Ae(),n=new Date,a=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;for(const[d,s]of Object.entries(e.watchlist||{}))await Tt({code:d,name:d,alert_up:s.alert_up,alert_down:s.alert_down,add_time:s.add_time||a});for(const[d,s]of Object.entries(e.holdings||{}))if(await Tt({code:d,name:d,alert_up:s.alert_up,alert_down:s.alert_down,add_time:a}),s.transactions&&s.transactions.length>0)for(const o of s.transactions)await ee({code:d,time:o.time,quantity:o.quantity,price:o.price},`resetToDefaultConfig-${d}`);return await Lt(e),e}catch(e){throw console.error("é‡ç½®æ•°æ®å¤±è´¥:",e),e}}const Un=Object.freeze(Object.defineProperty({__proto__:null,getTodayDate:rn,initializeConfig:xe,loadHoldingsConfig:ye,resetToDefaultConfig:on,saveHistoryData:an,saveHoldingsConfig:te},Symbol.toStringTag,{value:"Module"})),Yn=({config:e,onConfigUpdate:n,onStockAdded:a,stockStates:d,onOpenTransactionDialog:s,onOpenAllTransactionsDialog:o})=>{const[c,l]=w.useState({});w.useEffect(()=>{(async()=>{const p=await Pt();l(p)})()},[e]);const[b,_]=w.useState(!1),[C,u]=w.useState(""),[S,$]=w.useState(!1),[et,P]=w.useState(""),[B,Y]=w.useState(!1),[N,V]=w.useState(""),[K,X]=w.useState(""),[nt,G]=w.useState(""),[Z,xt]=w.useState("100"),[mt,It]=w.useState(""),[g,q]=w.useState(!1),[U,W]=w.useState(""),[r,f]=w.useState(!1),[h,j]=w.useState(!1),[A,x]=w.useState(""),[T,F]=w.useState("add"),[z,Q]=w.useState(!1),[ot,E]=w.useState(""),[ht,st]=w.useState("add"),[At,jt]=w.useState(!1),[_t,yt]=w.useState(null),[wt,$t]=w.useState(null),[it,zt]=w.useState({time:"",quantity:"",totalAmount:""}),[ne,Et]=w.useState(""),[se,Mt]=w.useState(""),[ae,Bt]=w.useState(""),[re,Vt]=w.useState(""),[Ut,Yt]=w.useState("gt"),[oe,Kt]=w.useState(""),ln=()=>{_(!0),u(""),P("")},ie=()=>{_(!1),u(""),P("")},$e=async()=>{if(!C.trim()){P("è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ");return}const i=C.trim().toUpperCase();if(e.holdings[i]||e.watchlist[i]){P("è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰æˆ–æŒä»“ä¸­");return}$(!0),P("");try{if(!await ke(i)){P("æ— æ³•è·å–è‚¡ç¥¨ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®"),$(!1);return}const y=new Date,k=y.getFullYear(),O=String(y.getMonth()+1).padStart(2,"0"),m=String(y.getDate()).padStart(2,"0"),M=String(y.getHours()).padStart(2,"0"),I=String(y.getMinutes()).padStart(2,"0"),H=String(y.getSeconds()).padStart(2,"0"),J=`${k}-${O}-${m} ${M}:${I}:${H}`,lt={...e,watchlist:{...e.watchlist,[i]:{alert_up:null,alert_down:null,add_time:J}}};await n(lt),a&&a(i),ie()}catch(p){P(p.message||"æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®")}finally{$(!1)}};w.useEffect(()=>{if(B&&!nt){const i=new Date,p=i.getFullYear(),y=String(i.getMonth()+1).padStart(2,"0"),k=String(i.getDate()).padStart(2,"0"),O=String(i.getHours()).padStart(2,"0"),m=String(i.getMinutes()).padStart(2,"0"),M=String(i.getSeconds()).padStart(2,"0");G(`${p}-${y}-${k} ${O}:${m}:${M}`)}},[B,nt]);const le=w.useMemo(()=>{const i=parseFloat(Z),p=parseFloat(mt);return isNaN(i)||i===0||isNaN(p)||p<=0?null:p/Math.abs(i)},[Z,mt]),Qt=()=>{const i=new Set;return Object.keys(e.holdings||{}).forEach(p=>i.add(p)),Object.keys(e.watchlist||{}).forEach(p=>i.add(p)),Array.from(i).sort()},kt=w.useCallback(i=>{Y(!0),i?(V(i),X(""),f(!0)):(V(""),X(""),f(!1)),G(""),xt("100"),W("")},[d]);w.useEffect(()=>(s&&s(kt),window.__openTransactionDialog=kt,()=>{window.__openTransactionDialog&&delete window.__openTransactionDialog}),[kt,s]);const De=w.useCallback(i=>{jt(!0),i?(Et(i),Mt("")):(Et(""),Mt("")),Bt(""),Vt(""),Yt("gt"),Kt("")},[]);w.useEffect(()=>{o&&o(De)},[De,o]);const ce=()=>{Y(!1),V(""),X(""),G(""),xt("100"),It(""),W(""),f(!1)},Fe=()=>{jt(!1),Et(""),Mt(""),Bt(""),Vt(""),Yt("gt"),Kt("")},cn=async()=>{const i=N||K.trim().toUpperCase();if(!i){W("è¯·é€‰æ‹©æˆ–è¾“å…¥è‚¡ç¥¨ä»£ç ");return}q(!0),W("");try{if(N&&Qt().includes(N)){f(!0),q(!1);return}if(e.holdings[i]||e.watchlist[i]){W("è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰æˆ–æŒä»“ä¸­ï¼Œè¯·ä»ä¸‹æ‹‰æ¡†é€‰æ‹©"),q(!1);return}if(!await ke(i)){W("æ— æ³•è·å–è‚¡ç¥¨ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®"),q(!1);return}const y={...e,watchlist:{...e.watchlist,[i]:{alert_up:null,alert_down:null,add_time:new Date().toISOString().replace("T"," ").substring(0,19)}}};await n(y),a&&a(i),V(i),X(""),f(!0)}catch(p){W(p.message||"éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®")}finally{q(!1)}},dn=()=>{const i=N||K.trim().toUpperCase();if(!i){W("è¯·é€‰æ‹©æˆ–è¾“å…¥è‚¡ç¥¨ä»£ç ");return}if(!r){W("è¯·å…ˆéªŒè¯è‚¡ç¥¨ä»£ç ");return}if(!nt){W("è¯·è¾“å…¥äº¤æ˜“æ—¶é—´");return}const p=parseFloat(Z);if(isNaN(p)||p===0){W("è¯·è¾“å…¥æœ‰æ•ˆçš„äº¤æ˜“æ•°é‡ï¼ˆä¸èƒ½ä¸º0ï¼‰");return}const y=parseFloat(mt);if(isNaN(y)||y<=0){W("è¯·è¾“å…¥æœ‰æ•ˆçš„æ€»é‡‘é¢");return}const k=y/Math.abs(p),O=e.holdings[i]||{transactions:[],alert_up:null,alert_down:null},m=Array.isArray(O.transactions)?O.transactions:[];if(p<0){let J=0;for(const Dt of m)J+=Number(Dt.quantity)||0;if(J+p<0){W(`æŒä»“ä¸è¶³ï¼Œå½“å‰æŒä»“ï¼š${J.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(p).toFixed(0)}`);return}}const M={time:nt,quantity:p,price:k,totalAmount:y},I=p>0?e.funds.available_funds-y:e.funds.available_funds+y,H={...e,funds:{...e.funds,available_funds:Math.max(0,I)},holdings:{...e.holdings,[i]:{...O,transactions:[...m,M]}}};if(e.watchlist[i]){const{[i]:J,...lt}=e.watchlist;H.watchlist=lt}n(H).then(()=>{ce()}).catch(J=>{console.error("ä¿å­˜äº¤æ˜“å¤±è´¥:",J),W("ä¿å­˜äº¤æ˜“å¤±è´¥ï¼Œè¯·é‡è¯•")})},un=()=>{j(!0),x(""),F("add")},de=()=>{j(!1),x(""),F("add")},hn=()=>{const i=parseFloat(A);if(isNaN(i)||i<=0)return;let p=e.funds.total_original_funds,y=e.funds.available_funds;T==="add"?(p+=i,y+=i):(p=Math.max(0,p-i),y=Math.max(0,y-i));const k={...e,funds:{...e.funds,total_original_funds:p,available_funds:y}};n(k).then(()=>{de()})},pn=()=>{Q(!0),E(""),st("add")},ue=()=>{Q(!1),E(""),st("add")},fn=()=>{const i=parseFloat(ot);if(isNaN(i)||i<=0)return;let p=e.funds.available_funds;ht==="add"?p+=i:p=Math.max(0,p-i);const y={...e,funds:{...e.funds,available_funds:p}};n(y).then(()=>{ue()})};return t.jsxs(t.Fragment,{children:[t.jsxs(R,{sx:{mb:1,display:"flex",justifyContent:"space-between",alignItems:"center",gap:.5},children:[t.jsxs(R,{sx:{display:"flex",gap:.5},children:[t.jsx(D,{variant:"outlined",color:"secondary",size:"small",startIcon:t.jsx(ze,{}),onClick:un,children:"å¢å‡æœ¬é‡‘"}),t.jsx(D,{variant:"outlined",color:"secondary",size:"small",startIcon:t.jsx(ze,{}),onClick:pn,children:"å¢å‡å¯ç”¨èµ„é‡‘"})]}),t.jsxs(R,{sx:{display:"flex",gap:.5},children:[t.jsx(D,{variant:"contained",size:"small",startIcon:t.jsx(Ht,{}),onClick:ln,children:"è‡ªé€‰"}),t.jsx(D,{variant:"contained",color:"secondary",size:"small",startIcon:t.jsx(Ht,{}),onClick:()=>kt(),children:"äº¤æ˜“"}),t.jsx(D,{variant:"outlined",size:"small",startIcon:t.jsx(vn,{}),onClick:()=>jt(!0),children:"äº¤æ˜“åˆ—è¡¨"})]})]}),t.jsxs(ct,{open:b,onClose:ie,maxWidth:"xs",fullWidth:!0,children:[t.jsx(pt,{sx:{pb:1},children:"æ·»åŠ è‡ªé€‰è‚¡"}),t.jsx(dt,{sx:{pt:1},children:t.jsx(tt,{autoFocus:!0,size:"small",label:"è‚¡ç¥¨ä»£ç ",fullWidth:!0,variant:"outlined",value:C,onChange:i=>{u(i.target.value),P("")},placeholder:"ä¾‹å¦‚ï¼š600228",error:!!et,helperText:et||"è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ",disabled:S,onKeyPress:i=>{i.key==="Enter"&&!S&&$e()}})}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:ie,disabled:S,children:"å–æ¶ˆ"}),t.jsx(D,{size:"small",onClick:$e,variant:"contained",disabled:S,children:S?"éªŒè¯ä¸­...":"æ·»åŠ "})]})]}),t.jsxs(ct,{open:B,onClose:ce,maxWidth:"sm",fullWidth:!0,children:[t.jsx(pt,{children:"æ·»åŠ äº¤æ˜“è®°å½•"}),t.jsx(dt,{children:t.jsxs(R,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[t.jsxs(bt,{fullWidth:!0,size:"small",children:[t.jsx(Nt,{children:"è‚¡ç¥¨ä»£ç "}),t.jsx(qt,{value:N,label:"è‚¡ç¥¨ä»£ç ",onChange:i=>{const p=i.target.value;V(p),X(""),W(""),p&&Qt().includes(p)?f(!0):f(!1)},disabled:g,children:Qt().map(i=>{var p,y;return t.jsxs(at,{value:i,children:[i," ",(p=d==null?void 0:d.get(i))!=null&&p.name?`(${(y=d.get(i))==null?void 0:y.name})`:""]},i)})})]}),t.jsx(tt,{label:"æˆ–è¾“å…¥æ–°ä»£ç ",size:"small",fullWidth:!0,variant:"outlined",value:K,onChange:i=>{X(i.target.value),V(""),W(""),f(!1)},placeholder:"ä¾‹å¦‚ï¼š600228",disabled:g||!!N,helperText:N?"å·²é€‰æ‹©":"è¾“å…¥åéœ€éªŒè¯"}),!r&&K&&t.jsx(D,{variant:"outlined",onClick:cn,disabled:g,fullWidth:!0,children:g?"éªŒè¯ä¸­...":"éªŒè¯è‚¡ç¥¨ä»£ç "}),U&&t.jsx(R,{sx:{color:"error.main",fontSize:"0.875rem"},children:U}),r&&t.jsxs(t.Fragment,{children:[t.jsx(tt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",fullWidth:!0,variant:"outlined",value:nt?(()=>{try{const i=new Date(nt),p=i.getFullYear(),y=String(i.getMonth()+1).padStart(2,"0"),k=String(i.getDate()).padStart(2,"0"),O=String(i.getHours()).padStart(2,"0"),m=String(i.getMinutes()).padStart(2,"0");return`${p}-${y}-${k}T${O}:${m}`}catch{return""}})():"",onChange:i=>{const p=i.target.value;if(p){const y=new Date(p),k=y.getFullYear(),O=String(y.getMonth()+1).padStart(2,"0"),m=String(y.getDate()).padStart(2,"0"),M=String(y.getHours()).padStart(2,"0"),I=String(y.getMinutes()).padStart(2,"0"),H=String(y.getSeconds()).padStart(2,"0");G(`${k}-${O}-${m} ${M}:${I}:${H}`)}},InputLabelProps:{shrink:!0}}),t.jsx(tt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",fullWidth:!0,variant:"outlined",value:Z,onChange:i=>{const p=i.target.value;(p===""||p==="-"||/^-?\d*\.?\d*$/.test(p))&&xt(p)},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡ºï¼ˆå¦‚ï¼š-100è¡¨ç¤ºå–å‡º100è‚¡ï¼‰"}),t.jsx(tt,{label:"æ€»é‡‘é¢",type:"number",fullWidth:!0,required:!0,variant:"outlined",value:mt,onChange:i=>It(i.target.value),inputProps:{min:0,step:.01},helperText:"ç”±äºåˆ¸å•†è®¡ç®—è§„åˆ™å¤æ‚ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ï¼ˆåŒ…å«æ‰€æœ‰è´¹ç”¨ï¼‰"}),le!==null&&t.jsx(tt,{label:"å•ä»·ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰",type:"number",fullWidth:!0,variant:"outlined",value:le.toFixed(3),InputProps:{readOnly:!0},helperText:`æ€»é‡‘é¢ Ã· |æ•°é‡| = ${le.toFixed(3)}`})]})]})}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:ce,disabled:g,children:"å–æ¶ˆ"}),t.jsx(D,{size:"small",onClick:dn,variant:"contained",disabled:g||!r,children:"æäº¤"})]})]}),t.jsxs(ct,{open:h,onClose:de,maxWidth:"xs",fullWidth:!0,children:[t.jsx(pt,{sx:{pb:1},children:"å¢å‡æœ¬é‡‘"}),t.jsx(dt,{sx:{pt:1},children:t.jsxs(R,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsxs(bt,{fullWidth:!0,children:[t.jsx(Nt,{children:"æ“ä½œç±»å‹"}),t.jsxs(qt,{value:T,label:"æ“ä½œç±»å‹",onChange:i=>F(i.target.value),children:[t.jsx(at,{value:"add",children:"å¢åŠ æœ¬é‡‘"}),t.jsx(at,{value:"subtract",children:"å‡å°‘æœ¬é‡‘"})]})]}),t.jsx(tt,{label:"é‡‘é¢",type:"number",fullWidth:!0,variant:"outlined",value:A,onChange:i=>x(i.target.value),inputProps:{min:0,step:.01},helperText:T==="add"?"å¢åŠ æœ¬é‡‘æ—¶ï¼Œå¯ç”¨èµ„é‡‘ä¹Ÿä¼šåŒæ­¥å¢åŠ ":"å‡å°‘æœ¬é‡‘æ—¶ï¼Œå¯ç”¨èµ„é‡‘ä¹Ÿä¼šåŒæ­¥å‡å°‘"}),T==="subtract"&&t.jsx(R,{sx:{p:1,backgroundColor:"#fff3cd",borderRadius:1},children:t.jsxs(L,{variant:"body2",sx:{color:"#856404",fontSize:"0.75rem"},children:["å½“å‰æœ¬é‡‘ï¼š",e.funds.total_original_funds.toFixed(2)," | å¯ç”¨ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å‡å°‘åæœ¬é‡‘ï¼š",Math.max(0,e.funds.total_original_funds-(parseFloat(A)||0)).toFixed(2)," | å¯ç”¨ï¼š",Math.max(0,e.funds.available_funds-(parseFloat(A)||0)).toFixed(2)]})}),T==="add"&&t.jsx(R,{sx:{p:1,backgroundColor:"#d1ecf1",borderRadius:1},children:t.jsxs(L,{variant:"body2",sx:{color:"#0c5460",fontSize:"0.75rem"},children:["å½“å‰æœ¬é‡‘ï¼š",e.funds.total_original_funds.toFixed(2)," | å¯ç”¨ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å¢åŠ åæœ¬é‡‘ï¼š",(e.funds.total_original_funds+(parseFloat(A)||0)).toFixed(2)," | å¯ç”¨ï¼š",(e.funds.available_funds+(parseFloat(A)||0)).toFixed(2)]})})]})}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:de,children:"å–æ¶ˆ"}),t.jsx(D,{size:"small",onClick:hn,variant:"contained",disabled:!A||parseFloat(A)<=0,children:"ç¡®è®¤"})]})]}),t.jsxs(ct,{open:z,onClose:ue,maxWidth:"xs",fullWidth:!0,children:[t.jsx(pt,{sx:{pb:1},children:"å¢å‡å¯ç”¨èµ„é‡‘"}),t.jsx(dt,{sx:{pt:1},children:t.jsxs(R,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsxs(bt,{fullWidth:!0,size:"small",children:[t.jsx(Nt,{children:"æ“ä½œç±»å‹"}),t.jsxs(qt,{value:ht,label:"æ“ä½œç±»å‹",onChange:i=>st(i.target.value),children:[t.jsx(at,{value:"add",children:"å¢åŠ å¯ç”¨èµ„é‡‘"}),t.jsx(at,{value:"subtract",children:"å‡å°‘å¯ç”¨èµ„é‡‘"})]})]}),t.jsx(tt,{size:"small",label:"é‡‘é¢",type:"number",fullWidth:!0,variant:"outlined",value:ot,onChange:i=>E(i.target.value),inputProps:{min:0,step:.01},helperText:ht==="add"?"å¢åŠ å¯ç”¨èµ„é‡‘ï¼ˆä¸å½±å“æœ¬é‡‘ï¼‰":"å‡å°‘å¯ç”¨èµ„é‡‘ï¼ˆä¸å½±å“æœ¬é‡‘ï¼‰"}),ht==="subtract"&&t.jsx(R,{sx:{p:1,backgroundColor:"#fff3cd",borderRadius:1},children:t.jsxs(L,{variant:"body2",sx:{color:"#856404",fontSize:"0.75rem"},children:["å½“å‰å¯ç”¨èµ„é‡‘ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å‡å°‘åå¯ç”¨èµ„é‡‘ï¼š",Math.max(0,e.funds.available_funds-(parseFloat(ot)||0)).toFixed(2)]})}),ht==="add"&&t.jsx(R,{sx:{p:1,backgroundColor:"#d1ecf1",borderRadius:1},children:t.jsxs(L,{variant:"body2",sx:{color:"#0c5460",fontSize:"0.75rem"},children:["å½“å‰å¯ç”¨èµ„é‡‘ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å¢åŠ åå¯ç”¨èµ„é‡‘ï¼š",(e.funds.available_funds+(parseFloat(ot)||0)).toFixed(2)]})})]})}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:ue,children:"å–æ¶ˆ"}),t.jsx(D,{size:"small",onClick:fn,variant:"contained",disabled:!ot||parseFloat(ot)<=0,children:"ç¡®è®¤"})]})]}),t.jsxs(ct,{open:At,onClose:Fe,maxWidth:"lg",fullWidth:!0,children:[t.jsx(pt,{children:t.jsxs(R,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(L,{variant:"h6",children:"æ‰€æœ‰äº¤æ˜“è®°å½•"}),t.jsx(D,{variant:"contained",color:"secondary",startIcon:t.jsx(Ht,{}),onClick:()=>{jt(!1);const i=ne||se.trim().toUpperCase()||void 0;kt(i)},size:"small",children:"äº¤æ˜“"})]})}),t.jsxs(dt,{children:[t.jsx(R,{sx:{mt:1,mb:1,p:1,border:"1px solid #e0e0e0",borderRadius:1},children:t.jsxs(R,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs(bt,{size:"small",sx:{minWidth:100},children:[t.jsx(Nt,{children:"è‚¡ç¥¨"}),t.jsxs(qt,{value:ne,label:"è‚¡ç¥¨",onChange:i=>{Et(i.target.value),Mt("")},children:[t.jsx(at,{value:"",children:"å…¨éƒ¨"}),Qt().map(i=>{var p,y;return t.jsxs(at,{value:i,children:[i," ",(p=d==null?void 0:d.get(i))!=null&&p.name?`(${(y=d.get(i))==null?void 0:y.name})`:""]},i)})]})]}),t.jsx(L,{variant:"body2",sx:{mx:.5},children:"æˆ–"}),t.jsx(tt,{label:"ä»£ç ",size:"small",value:se,onChange:i=>{Mt(i.target.value.toUpperCase()),Et("")},placeholder:"ä»£ç ",sx:{width:100}}),t.jsx(tt,{label:"å¼€å§‹æ—¥æœŸ",type:"date",size:"small",value:ae,onChange:i=>Bt(i.target.value),InputLabelProps:{shrink:!0},sx:{width:150}}),t.jsx(L,{variant:"body2",sx:{mx:.5},children:"è‡³"}),t.jsx(tt,{label:"ç»“æŸæ—¥æœŸ",type:"date",size:"small",value:re,onChange:i=>Vt(i.target.value),InputLabelProps:{shrink:!0},sx:{width:150}}),t.jsxs(bt,{size:"small",sx:{minWidth:80},children:[t.jsx(Nt,{children:"é‡‘é¢"}),t.jsxs(qt,{value:Ut,label:"é‡‘é¢",onChange:i=>Yt(i.target.value),children:[t.jsx(at,{value:"gt",children:"å¤§äº"}),t.jsx(at,{value:"eq",children:"ç­‰äº"}),t.jsx(at,{value:"lt",children:"å°äº"})]})]}),t.jsx(tt,{label:"é‡‘é¢",type:"number",size:"small",value:oe,onChange:i=>Kt(i.target.value),placeholder:"é‡‘é¢",sx:{width:120}}),t.jsx(D,{variant:"outlined",size:"small",onClick:()=>{Et(""),Mt(""),Bt(""),Vt(""),Yt("gt"),Kt("")},children:"æ¸…é™¤"})]})}),(()=>{var O;const i=[];Object.entries(e.holdings||{}).forEach(([m,M])=>{var J;const I=Array.isArray(M.transactions)?M.transactions:[],H=((J=d==null?void 0:d.get(m))==null?void 0:J.name)||m;I.forEach((lt,Dt)=>{i.push({code:m,name:H,transaction:lt,isHistorical:!1,transactionIndex:Dt})})});const p=new Set(Object.keys(e.holdings||{}));for(const[m,M]of Object.entries(e.watchlist||{}))if(!p.has(m)){const I=c[m]||[],H=Array.isArray(I)?I:[];if(H.length>0){const J=((O=d==null?void 0:d.get(m))==null?void 0:O.name)||m;H.forEach((lt,Dt)=>{i.push({code:m,name:J,transaction:lt,isHistorical:!0,transactionIndex:Dt})})}}let y=i;const k=ne||se.trim().toUpperCase();if(k&&(y=y.filter(m=>m.code===k)),ae){const m=new Date(ae);m.setHours(0,0,0,0);const M=m.getTime();y=y.filter(I=>{const H=new Date(I.transaction.time);return H.setHours(0,0,0,0),H.getTime()>=M})}if(re){const m=new Date(re);m.setHours(23,59,59,999);const M=m.getTime();y=y.filter(I=>new Date(I.transaction.time).getTime()<=M)}if(oe){const m=parseFloat(oe);isNaN(m)||(y=y.filter(M=>{const I=M.transaction.quantity*M.transaction.price;return Ut==="gt"?I>m:Ut==="eq"?Math.abs(I-m)<.01:Ut==="lt"?I<m:!0}))}return y.sort((m,M)=>{const I=new Date(m.transaction.time).getTime();return new Date(M.transaction.time).getTime()-I}),y.length>0?t.jsx(Ve,{component:we,sx:{mt:2},children:t.jsxs(fe,{size:"small",children:[t.jsx(me,{children:t.jsxs(Ft,{children:[t.jsx(v,{children:"ID"}),t.jsx(v,{children:"è‚¡ç¥¨ä»£ç "}),t.jsx(v,{children:"è‚¡ç¥¨åç§°"}),t.jsx(v,{children:"çŠ¶æ€"}),t.jsx(v,{children:"äº¤æ˜“æ—¶é—´"}),t.jsx(v,{children:"ç±»å‹"}),t.jsx(v,{children:"æ•°é‡ï¼ˆè‚¡ï¼‰"}),t.jsx(v,{children:"å•ä»·"}),t.jsx(v,{children:"æ€»é‡‘é¢"}),t.jsx(v,{align:"right",children:"æ“ä½œ"})]})}),t.jsx(ge,{children:y.map((m,M)=>{const I=m.transaction.quantity>0,H=m.transaction.totalAmount??Math.abs(m.transaction.quantity)*m.transaction.price;return t.jsxs(Ft,{children:[t.jsx(v,{children:m.transaction.id||"--"}),t.jsx(v,{children:m.code}),t.jsx(v,{children:m.name}),t.jsx(v,{children:m.isHistorical?t.jsx(Ot,{label:"å·²åˆ é™¤è‡ªé€‰",size:"small",color:"default"}):t.jsx(Ot,{label:"å½“å‰æŒä»“",size:"small",color:"primary"})}),t.jsx(v,{children:m.transaction.time}),t.jsx(v,{children:t.jsx(Ot,{label:I?"ä¹°å…¥":"å–å‡º",size:"small",color:I?"primary":"secondary"})}),t.jsx(v,{children:Math.floor(Math.abs(m.transaction.quantity)).toLocaleString()}),t.jsx(v,{children:Gt(m.transaction.price)}),t.jsx(v,{children:H.toFixed(2)}),t.jsxs(v,{align:"right",children:[t.jsx(Wt,{size:"small",onClick:()=>{const J=m.transaction.totalAmount??Math.abs(m.transaction.quantity)*m.transaction.price;yt({code:m.code,isHistorical:m.isHistorical,transactionIndex:m.transactionIndex,transaction:m.transaction}),zt({time:m.transaction.time,quantity:m.transaction.quantity.toString(),totalAmount:J.toString()})},sx:{color:"#1976d2"},children:t.jsx(Ue,{fontSize:"small"})}),t.jsx(Wt,{size:"small",onClick:()=>$t({code:m.code,isHistorical:m.isHistorical,transactionIndex:m.transactionIndex}),sx:{color:"error.main"},children:t.jsx(Ye,{fontSize:"small"})})]})]},`${m.isHistorical?"historical":"current"}-${m.code}-${m.transactionIndex}-${M}`)})})]})}):t.jsx(L,{sx:{mt:2,textAlign:"center",color:"text.secondary"},children:i.length>0?"æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„äº¤æ˜“è®°å½•":"æš‚æ— äº¤æ˜“è®°å½•"})})()]}),t.jsx(ft,{children:t.jsx(D,{onClick:Fe,children:"å…³é—­"})})]}),t.jsxs(ct,{open:!!_t,onClose:()=>yt(null),maxWidth:"sm",fullWidth:!0,children:[t.jsx(pt,{children:"ç¼–è¾‘äº¤æ˜“è®°å½•"}),t.jsx(dt,{children:t.jsxs(R,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[t.jsx(tt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",size:"small",fullWidth:!0,variant:"outlined",value:it.time?(()=>{try{const i=new Date(it.time),p=i.getFullYear(),y=String(i.getMonth()+1).padStart(2,"0"),k=String(i.getDate()).padStart(2,"0"),O=String(i.getHours()).padStart(2,"0"),m=String(i.getMinutes()).padStart(2,"0");return`${p}-${y}-${k}T${O}:${m}`}catch{return""}})():"",onChange:i=>{const p=i.target.value;if(p){const y=new Date(p),k=y.getFullYear(),O=String(y.getMonth()+1).padStart(2,"0"),m=String(y.getDate()).padStart(2,"0"),M=String(y.getHours()).padStart(2,"0"),I=String(y.getMinutes()).padStart(2,"0"),H=String(y.getSeconds()).padStart(2,"0");zt({...it,time:`${k}-${O}-${m} ${M}:${I}:${H}`})}},InputLabelProps:{shrink:!0}}),t.jsx(tt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:it.quantity,onChange:i=>{const p=i.target.value;(p===""||p==="-"||/^-?\d*\.?\d*$/.test(p))&&zt({...it,quantity:p})},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡º"}),t.jsx(tt,{label:"æ€»é‡‘é¢",type:"number",size:"small",fullWidth:!0,required:!0,variant:"outlined",value:it.totalAmount,onChange:i=>zt({...it,totalAmount:i.target.value}),inputProps:{min:0,step:.01},helperText:"ç”±äºåˆ¸å•†è®¡ç®—è§„åˆ™å¤æ‚ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ï¼ˆåŒ…å«æ‰€æœ‰è´¹ç”¨ï¼‰"}),(()=>{const i=parseFloat(it.quantity),p=parseFloat(it.totalAmount),y=!isNaN(i)&&i!==0&&!isNaN(p)&&p>0?p/Math.abs(i):null;return y!==null?t.jsx(tt,{label:"å•ä»·ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:y.toFixed(3),InputProps:{readOnly:!0},helperText:`æ€»é‡‘é¢ Ã· |æ•°é‡| = ${y.toFixed(3)}`}):null})()]})}),t.jsxs(ft,{sx:{px:2,pb:1.5},children:[t.jsx(D,{size:"small",onClick:()=>yt(null),children:"å–æ¶ˆ"}),t.jsx(D,{onClick:async()=>{if(!_t)return;const{code:i,isHistorical:p,transactionIndex:y}=_t,k=parseFloat(it.quantity),O=parseFloat(it.totalAmount);if(isNaN(k)||k===0||isNaN(O)||O<=0||!it.time)return;const m=O/Math.abs(k);if(k<0&&!p){const M=e.holdings[i];if(M){const I=Array.isArray(M.transactions)?M.transactions:[];let H=0;for(let lt=0;lt<I.length;lt++)lt!==y&&(H+=Number(I[lt].quantity)||0);const J=H+k;if(J<0){alert(`æŒä»“ä¸è¶³ï¼Œä¿®æ”¹åæŒä»“ï¼š${J.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(k).toFixed(0)}`);return}}}if(_t.transaction.id,it.time,p){const I=(c[i]||[])[y];if(I&&I.id){await Zt(I.id,{code:i,time:it.time,quantity:k,price:m,totalAmount:O});const H=await ye();await n(H),yt(null),zt({time:"",quantity:"",totalAmount:""});const J=await Pt();l(J)}}else{const M=e.holdings[i];if(M){const I=M.transactions[y],H=I.totalAmount??Math.abs(I.quantity)*I.price,J=I.quantity>0?-H:H,lt=k>0?-O:O,Dt=J-lt,qe=[...M.transactions];qe[y]={id:I.id,time:it.time,quantity:k,price:m,totalAmount:O};const mn=e.funds.available_funds+Dt,gn={...e,funds:{...e.funds,available_funds:Math.max(0,mn)},holdings:{...e.holdings,[i]:{...M,transactions:qe}}};n(gn).then(()=>{yt(null),zt({time:"",quantity:"",price:""})})}}},variant:"contained",children:"ä¿å­˜"})]})]}),t.jsxs(ct,{open:!!wt,onClose:()=>$t(null),children:[t.jsx(pt,{children:"ç¡®è®¤åˆ é™¤"}),t.jsx(dt,{children:t.jsx(L,{children:"ç¡®å®šè¦åˆ é™¤è¿™æ¡äº¤æ˜“è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"})}),t.jsxs(ft,{children:[t.jsx(D,{onClick:()=>$t(null),children:"å–æ¶ˆ"}),t.jsx(D,{onClick:async()=>{if(!wt)return;const{code:i,isHistorical:p,transactionIndex:y}=wt;if(p){const O=(c[i]||[])[y];if(O&&O.id){await Xt(O.id);const m=await ye();await n(m),$t(null);const M=await Pt();l(M)}}else{const k=e.holdings[i];if(k){const O=k.transactions[y],m=O.totalAmount??Math.abs(O.quantity)*O.price,M=O.quantity>0?e.funds.available_funds+m:e.funds.available_funds-m;O.id&&await Xt(O.id);const I=[...k.transactions];I.splice(y,1);const H={...e,funds:{...e.funds,available_funds:M},holdings:{...e.holdings,[i]:{...k,transactions:I}}};n(H).then(()=>{$t(null)})}}},size:"small",variant:"contained",color:"error",children:"åˆ é™¤"})]})]})]})},Kn=({version:e})=>t.jsxs(R,{component:"footer",sx:{position:"fixed",bottom:0,left:0,right:0,py:1.5,display:"flex",justifyContent:"center",alignItems:"center",gap:2,backgroundColor:"background.paper",zIndex:1e3},children:[t.jsxs(Cn,{href:"https://github.com/respawnlife/respawn-stocks-listen",target:"_blank",rel:"noopener noreferrer",sx:{display:"flex",alignItems:"center",gap:.5,color:"text.secondary",textDecoration:"none","&:hover":{color:"primary.main"}},children:[t.jsx(Tn,{fontSize:"small"}),t.jsx(L,{variant:"body2",sx:{fontSize:"0.75rem"},children:"GitHub"})]}),e&&t.jsxs(L,{variant:"body2",sx:{color:"text.secondary",fontSize:"0.75rem"},children:["ç‰ˆæœ¬: ",e]})]}),Qn="260119190444";function Gn(e,n){const a=Ke(e)?"ç¾è‚¡":"Aè‚¡",d=n[a];if(!(d!=null&&d.enabled))return!0;const s=new Date,o=s.getDay()===0?7:s.getDay();if(!(d.weekdays||[1,2,3,4,5]).includes(o))return!1;const l=s.getHours().toString().padStart(2,"0"),b=s.getMinutes().toString().padStart(2,"0"),_=`${l}:${b}`,C=d.morning;if(C){const S=C.start,$=C.end;if(S>$){if(_>=S||_<=$)return!0}else if(_>=S&&_<=$)return!0}const u=d.afternoon;if(u){const S=u.start,$=u.end;if(_>=S&&_<=$)return!0}return!1}function Jn(){const e=new Date;return e.getHours()>15||e.getHours()===15&&e.getMinutes()>=1}function He(e,n,a){const d=[];if(a.alert_triggered||(a.alert_triggered=new Set),a.alerts&&a.alerts.length>0){const s=a.last_price;for(const o of a.alerts){const c=`${o.type}-${o.price}`;let l=!1;o.type==="up"?n>=o.price?(!a.alert_triggered.has(c)||s!==null&&s<o.price)&&(l=!0,a.alert_triggered.add(c)):a.alert_triggered.delete(c):o.type==="down"&&(n<=o.price?(!a.alert_triggered.has(c)||s!==null&&s>o.price)&&(l=!0,a.alert_triggered.add(c)):a.alert_triggered.delete(c)),l&&d.push(o)}}else{const s=a.alert_up,o=a.alert_down,c=a.last_price;if(s!==null&&n>=s){const l=`up-${s}`;(!a.alert_triggered.has(l)||c!==null&&c<s)&&(d.push({type:"up",price:s}),a.alert_triggered.add(l))}else s!==null&&n<s&&a.alert_triggered.delete(`up-${s}`);if(o!==null&&n<=o){const l=`down-${o}`;(!a.alert_triggered.has(l)||c!==null&&c>o)&&(d.push({type:"down",price:o}),a.alert_triggered.add(l))}else o!==null&&n>o&&a.alert_triggered.delete(`down-${o}`)}return d}function Re(){try{const e=new(window.AudioContext||window.webkitAudioContext),n=e.createOscillator(),a=e.createGain();n.connect(a),a.connect(e.destination),n.frequency.value=1e3,n.type="sine",a.gain.setValueAtTime(.3,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),n.start(e.currentTime),n.stop(e.currentTime+.5)}catch(e){console.error("æ’­æ”¾å£°éŸ³å¤±è´¥:",e),"Notification"in window&&Notification.permission==="granted"&&new Notification("è‚¡ç¥¨æŠ¥è­¦",{body:"ä»·æ ¼è¾¾åˆ°æŠ¥è­¦é˜ˆå€¼",icon:"/favicon.ico"})}}async function Le(e,n){"Notification"in window&&(Notification.permission==="granted"?new Notification(e,{body:n}):Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&new Notification(e,{body:n}))}const Be=An({palette:{mode:"light",primary:{main:"#1976d2"}}});function Zn(){const[e,n]=w.useState(null),[a,d]=w.useState(new Map),[s,o]=w.useState(!1),[c,l]=w.useState(""),[b,_]=w.useState(!1),[C,u]=w.useState(!1),[S,$]=w.useState(!1),et=je.useRef(null),P=w.useRef(null),B=w.useRef(new Map),Y=w.useRef(!1),N=async()=>{try{const g=await nn(),q=JSON.stringify(g,null,2),U=new Blob([q],{type:"application/json"}),W=URL.createObjectURL(U),r=document.createElement("a");r.href=W,r.download=`stocks-backup-${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(W),l("æ•°æ®å¯¼å‡ºæˆåŠŸ")}catch(g){console.error("å¯¼å‡ºæ•°æ®å¤±è´¥:",g),l("å¯¼å‡ºæ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•")}},V=async g=>{var U;const q=(U=g.target.files)==null?void 0:U[0];if(q)try{const W=await q.text(),r=JSON.parse(W);if(!r||typeof r!="object"){l("å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®");return}u(!0),window.__pendingImportData=r}catch(W){console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",W),l("å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶è¯»å–é”™è¯¯")}finally{et.current&&(et.current.value="")}},K=async()=>{try{const g=window.__pendingImportData;if(!g){l("å¯¼å…¥å¤±è´¥ï¼šæ•°æ®æ— æ•ˆ");return}await sn(g);const q=await xe();n(q),u(!1),l("æ•°æ®å¯¼å…¥æˆåŠŸï¼Œé¡µé¢å°†åˆ·æ–°"),setTimeout(()=>{window.location.reload()},1e3)}catch(g){console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",g),l("å¯¼å…¥æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•"),u(!1)}finally{delete window.__pendingImportData}},X=async()=>{try{const g=await on();n(g),P.current=g,_(!1),l("æ•°æ®å·²é‡ç½®ä¸ºé»˜è®¤é…ç½®"),window.location.reload()}catch(g){console.error("é‡ç½®æ•°æ®å¤±è´¥:",g),l("é‡ç½®æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•")}};w.useEffect(()=>{(async()=>{try{const q=await xe();n(q)}catch(q){console.error("åŠ è½½é…ç½®å¤±è´¥:",q)}})()},[]),w.useEffect(()=>{P.current=e},[e]),w.useEffect(()=>{B.current=a},[a]),w.useEffect(()=>{e&&d(g=>{const q=new Map,U=Object.keys(e.holdings||{});for(const r of U){const f=e.holdings[r],h=Array.isArray(f.transactions)?f.transactions:[],[j,A]=In(h),x=g.get(r);q.set(r,{code:r,name:(x==null?void 0:x.name)||r,last_price:(x==null?void 0:x.last_price)??null,last_time:(x==null?void 0:x.last_time)??null,last_update_time:(x==null?void 0:x.last_update_time)||"--",last_change_pct:(x==null?void 0:x.last_change_pct)??0,holding_price:j>0?A:null,holding_quantity:j,transactions:h,alerts:f.alerts,alert_up:f.alert_up,alert_down:f.alert_down,alert_triggered:(x==null?void 0:x.alert_triggered)??new Set})}const W=Object.keys(e.watchlist||{});for(const r of W){if(q.has(r))continue;const f=e.watchlist[r],h=g.get(r);q.set(r,{code:r,name:(h==null?void 0:h.name)||r,last_price:(h==null?void 0:h.last_price)??null,last_time:(h==null?void 0:h.last_time)??null,last_update_time:(h==null?void 0:h.last_update_time)||"--",last_change_pct:(h==null?void 0:h.last_change_pct)??0,holding_price:null,holding_quantity:0,transactions:[],alerts:f.alerts,alert_up:f.alert_up,alert_down:f.alert_down,alert_triggered:(h==null?void 0:h.alert_triggered)??new Set})}return q})},[e]),w.useEffect(()=>{if(Y.current||s||!e)return;const g=()=>{const q=Array.from(a.keys());if(q.length===0){setTimeout(g,100);return}if(Y.current)return;Y.current=!0,(async()=>{console.log("æ­£åœ¨åˆå§‹åŒ–ï¼Œè·å–è‚¡ç¥¨æ•°æ®...");const W=await pe(q);d(r=>{const f=new Map(r),h=new Date,j=`${h.getHours().toString().padStart(2,"0")}:${h.getMinutes().toString().padStart(2,"0")}:${h.getSeconds().toString().padStart(2,"0")}`;for(const A of q){const x=f.get(A);if(x){const T=W.get(A);if(T){const F=T.yesterday_close>0?(T.price-T.yesterday_close)/T.yesterday_close*100:0,z=He(A,T.price,x);if(z.length>0){Re();const ot=z.map(E=>{const ht=E.type==="up"?"ä¸Šæ¶¨":"ä¸‹è·Œ";return`${T.name}(${A}) ä»·æ ¼${ht}è‡³ ${T.price.toFixed(2)}ï¼Œè¾¾åˆ°æŠ¥è­¦ä»·æ ¼ ${E.price.toFixed(2)}`}).join("ï¼›");l(ot),Le("è‚¡ç¥¨æŠ¥è­¦",ot)}f.set(A,{...x,name:T.name,last_price:T.price,last_time:new Date,last_update_time:T.update_time,last_change_pct:F})}else f.set(A,{...x,last_time:new Date,last_update_time:j})}}return f}),o(!0)})()};g()},[e,s,a]),w.useEffect(()=>{if(!s||!e)return;let g=!0;const q=e.update_interval??1e3,U=async()=>{if(!g)return;const r=Array.from(B.current.keys());if(r.length===0)return;const f=P.current;if(!f||Jn())return;const h=r.filter(j=>Gn(j,f.market_hours));if(h.length!==0)try{const j=await pe(h);if(!g)return;d(A=>{const x=new Map(A),T=new Date,F=`${T.getHours().toString().padStart(2,"0")}:${T.getMinutes().toString().padStart(2,"0")}:${T.getSeconds().toString().padStart(2,"0")}`;for(const E of h){const ht=x.get(E);if(ht){const st=j.get(E);if(st){const At=st.yesterday_close>0?(st.price-st.yesterday_close)/st.yesterday_close*100:0,jt=He(E,st.price,ht);if(jt.length>0){Re();const yt=jt.map(wt=>{const $t=wt.type==="up"?"ä¸Šæ¶¨":"ä¸‹è·Œ";return`${st.name}(${E}) ä»·æ ¼${$t}è‡³ ${st.price.toFixed(2)}ï¼Œè¾¾åˆ°æŠ¥è­¦ä»·æ ¼ ${wt.price.toFixed(2)}`}).join("ï¼›");l(yt),Le("è‚¡ç¥¨æŠ¥è­¦",yt)}x.set(E,{...ht,name:st.name,last_price:st.price,last_time:new Date,last_update_time:st.update_time,last_change_pct:At})}else x.set(E,{...ht,last_time:new Date,last_update_time:F})}}const z=rn(),Q=P.current,ot={date:z,stocks:Array.from(x.values()).map(E=>({code:E.code,name:E.name,price:E.last_price,change_pct:E.last_change_pct,holding_price:E.holding_price,holding_quantity:E.holding_quantity,holding_value:E.last_price!==null&&E.holding_quantity>0?E.last_price*E.holding_quantity:0,profit:E.holding_price!==null&&E.holding_quantity>0&&E.last_price!==null?(E.last_price-E.holding_price)*E.holding_quantity:null})),funds:Q.funds,timestamp:new Date().toISOString()};return an(z,ot).catch(E=>{console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",E)}),x})}catch(j){console.error("è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥:",j)}};U();const W=setInterval(U,q);return()=>{g=!1,clearInterval(W)}},[s,e==null?void 0:e.update_interval]);const nt=Array.from(a.values()).sort((g,q)=>g.code.localeCompare(q.code)),G=async()=>{if(!e)return;const g={...e,privacy_mode:!e.privacy_mode};n(g),P.current=g,await te(g)},Z=async g=>{n(g),P.current=g,await te(g)};w.useEffect(()=>{if(!e){document.title="--";return}const g=Array.from(a.values()),q=g.reduce((z,Q)=>Q.last_price!==null&&Q.holding_quantity>0?z+Q.last_price*Q.holding_quantity:z,0),U=(e.historical_holdings||[]).reduce((z,Q)=>z+Q.transactions.reduce((ot,E)=>ot+E.quantity*E.price,0),0),W=e.funds.available_funds+q+U,r=g.filter(z=>z.holding_price!==null&&z.holding_quantity>0).length,f=W-e.funds.total_original_funds,h=e.funds.total_original_funds>0?f/e.funds.total_original_funds*100:0,j=g.length>0?g.reduce((z,Q)=>z+Q.last_change_pct,0)/g.length:0,A=q>0||r>0,x=A?j:0,T=A?f:0,F=A?h:0;if(r>0){const z=T>=0?"+":"";document.title=`${z}${T.toFixed(2)}(${F>=0?"+":""}${F.toFixed(2)}%)`}else document.title=`${x>=0?"+":""}${x.toFixed(2)}%`},[e,a]);const xt=w.useRef(null),mt=w.useRef(null),It=async g=>{try{await new Promise(U=>setTimeout(U,100));const q=await pe([g]);if(q.has(g)){const U=q.get(g);d(W=>{const r=new Map(W);let f=r.get(g);if(!f){const j=P.current.watchlist[g];f={code:g,name:g,last_price:null,last_time:null,last_update_time:"--",last_change_pct:0,holding_price:null,holding_quantity:0,transactions:[],alert_up:(j==null?void 0:j.alert_up)||null,alert_down:(j==null?void 0:j.alert_down)||null,alert_triggered_up:!1,alert_triggered_down:!1}}const h=U.yesterday_close>0?(U.price-U.yesterday_close)/U.yesterday_close*100:0;return r.set(g,{...f,name:U.name,last_price:U.price,last_time:new Date,last_update_time:U.update_time,last_change_pct:h}),r})}}catch(q){console.error("è·å–æ–°æ·»åŠ è‚¡ç¥¨æ•°æ®å¤±è´¥:",q)}};return e?t.jsxs(Ee,{theme:Be,children:[t.jsx(Me,{}),t.jsxs(Oe,{maxWidth:"xl",sx:{mt:2,mb:8,pb:2},children:[t.jsx(On,{stocks:nt,funds:e.funds,privacyMode:e.privacy_mode,onPrivacyModeToggle:G,config:e,onConfigUpdate:Z}),t.jsx(Yn,{config:e,onConfigUpdate:Z,onStockAdded:It,stockStates:new Map(Array.from(a.entries()).map(([g,q])=>[g,{name:q.name,last_price:q.last_price}])),onOpenTransactionDialog:g=>{xt.current=g},onOpenAllTransactionsDialog:g=>{mt.current=g}}),t.jsx(Mn,{stocks:nt,privacyMode:e.privacy_mode,config:e,onConfigUpdate:Z,onAddTransaction:g=>{xt.current&&xt.current(g)},onOpenAllTransactionsDialog:g=>{mt.current&&mt.current(g)}}),t.jsx($n,{open:!!c,autoHideDuration:6e3,onClose:()=>l(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(Dn,{severity:"warning",onClose:()=>l(""),children:c})}),t.jsxs(R,{sx:{mt:3,mb:2,textAlign:"center",display:"flex",gap:2,justifyContent:"center"},children:[t.jsx(D,{variant:"outlined",color:"primary",onClick:()=>$(!0),sx:{textTransform:"none"},children:"æ•°æ®å¯¼å…¥å¯¼å‡º"}),t.jsx(D,{variant:"outlined",color:"error",onClick:()=>_(!0),sx:{textTransform:"none"},children:"é‡ç½®æ‰€æœ‰æ•°æ®"})]}),t.jsx("input",{type:"file",ref:et,accept:".json",style:{display:"none"},onChange:V}),t.jsx(Kn,{version:Qn}),t.jsxs(ct,{open:b,onClose:()=>_(!1),children:[t.jsx(pt,{children:"ç¡®è®¤é‡ç½®æ•°æ®"}),t.jsx(dt,{children:t.jsxs(he,{children:["æ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ç°æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬è‡ªé€‰è‚¡ã€äº¤æ˜“è®°å½•ã€å†å²æ•°æ®ç­‰ï¼‰ï¼Œå¹¶ç”¨é»˜è®¤é…ç½®è¦†ç›–ã€‚",t.jsx("br",{}),t.jsx("strong",{children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼"})]})}),t.jsxs(ft,{children:[t.jsx(D,{onClick:()=>_(!1),children:"å–æ¶ˆ"}),t.jsx(D,{onClick:X,color:"error",variant:"contained",children:"ç¡®è®¤é‡ç½®"})]})]}),t.jsxs(ct,{open:S,onClose:()=>$(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(pt,{children:"æ•°æ®å¯¼å…¥å¯¼å‡º"}),t.jsxs(dt,{children:[t.jsxs(he,{sx:{mb:3},children:["æœ¬é¡¹ç›®ä¸ä¼šä¸Šä¼ ä»»ä½•æ•°æ®åˆ°äº’è”ç½‘ï¼Œæ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ã€‚",t.jsx("br",{}),"å¦‚æœ‰å¤šè®¾å¤‡ä½¿ç”¨ï¼Œè¯·è‡ªè¡Œé€šè¿‡å¯¼å…¥å¯¼å‡ºåŠŸèƒ½åŒæ­¥æ•°æ®ã€‚"]}),t.jsxs(R,{sx:{display:"flex",gap:2,justifyContent:"center",mt:2},children:[t.jsx(D,{variant:"contained",color:"primary",onClick:()=>{$(!1),N()},sx:{textTransform:"none"},children:"å¯¼å‡ºæ•°æ®"}),t.jsx(D,{variant:"contained",color:"primary",onClick:()=>{var g;$(!1),(g=et.current)==null||g.click()},sx:{textTransform:"none"},children:"å¯¼å…¥æ•°æ®"})]})]}),t.jsx(ft,{children:t.jsx(D,{onClick:()=>$(!1),children:"å…³é—­"})})]}),t.jsxs(ct,{open:C,onClose:()=>u(!1),children:[t.jsx(pt,{children:"ç¡®è®¤å¯¼å…¥æ•°æ®"}),t.jsx(dt,{children:t.jsxs(he,{children:["æ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ç°æœ‰æ•°æ®ï¼Œå¹¶ç”¨å¯¼å…¥çš„æ•°æ®è¦†ç›–ã€‚",t.jsx("br",{}),t.jsx("strong",{children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼"})]})}),t.jsxs(ft,{children:[t.jsx(D,{onClick:()=>{u(!1),delete window.__pendingImportData},children:"å–æ¶ˆ"}),t.jsx(D,{onClick:K,color:"primary",variant:"contained",children:"ç¡®è®¤å¯¼å…¥"})]})]})]})]}):t.jsxs(Ee,{theme:Be,children:[t.jsx(Me,{}),t.jsx(Oe,{maxWidth:"xl",sx:{mt:2,mb:2},children:t.jsx(L,{children:"åŠ è½½é…ç½®ä¸­..."})})]})}function Xn(e){try{const n=JSON.parse(e),a={privacy_mode:n.privacy_mode||!1,funds:n.funds||{available_funds:0,total_original_funds:0},market_hours:n.market_hours||{Aè‚¡:{enabled:!0,morning:{start:"09:30",end:"11:30"},afternoon:{start:"13:00",end:"15:00"},weekdays:[1,2,3,4,5]},ç¾è‚¡:{enabled:!1,morning:{start:"22:30",end:"05:00"},afternoon:null,weekdays:[1,2,3,4,5]}},stocks:n.stocks||{}};return te(a).catch(d=>{console.error("ä¿å­˜é…ç½®å¤±è´¥:",d)}),!0}catch(n){return console.error("å¯¼å…¥é…ç½®å¤±è´¥:",n),!1}}typeof window<"u"&&(window.importStockConfig=Xn);"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission();Fn.createRoot(document.getElementById("root")).render(t.jsx(je.StrictMode,{children:t.jsx(Zn,{})}));export{In as c,zn as f,be as l};
