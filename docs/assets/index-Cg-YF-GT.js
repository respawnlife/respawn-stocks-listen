const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/KlineChart-CQjBmOP7.js","assets/react-mui-GIrKQtIc.js","assets/vendor-ST8YoCxk.js","assets/charts-DLsYqWXl.js"])))=>i.map(i=>d[i]);
import{r as m,j as t,B as N,T as un,P as Ie,b as hn,c as fn,d as je,e as E,f as pn,R as _e,D as He,C as Gt,I as ce,M as Re,g as Be,h as ct,i as St,k as Tt,l as Ct,m as pt,n as Dt,o as F,p as J,F as Jt,S as ae,q as Fn,A as we,s as In,t as Le,u as Ve,v as gn,w as qn,x as Mn,V as zn,y as Pn,z as Ke,H as En,E as ge,G as Nn,J as Wn,L as Hn,K as Rn,N as Bn,O as Qe,Q as Ye,U as Ue,W as Ln,X as Ae,Y as Vn}from"./react-mui-GIrKQtIc.js";import{N as Kn,O as Ge,P as Je,Q as Xe,S as Ze,T as tn,U as en,V as Qn,X as Yn,Y as Un,Z as mn,$ as xn}from"./vendor-ST8YoCxk.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&p(o)}).observe(document,{childList:!0,subtree:!0});function s(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function p(a){if(a.ep)return;a.ep=!0;const c=s(a);fetch(a.href,c)}})();const Gn="modulepreload",Jn=function(e){return"/"+e},nn={},qe=function(r,s,p){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(s.map(C=>{if(C=Jn(C),C in nn)return;nn[C]=!0;const _=C.endsWith(".css"),T=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${C}"]${T}`))return;const f=document.createElement("link");if(f.rel=_?"stylesheet":Gn,_||(f.as="script"),f.crossOrigin="",f.href=C,i&&f.setAttribute("nonce",i),document.head.appendChild(f),_)return new Promise((D,$)=>{f.addEventListener("load",D),f.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${C}`)))})}))}function c(o){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o}return a.then(o=>{for(const i of o||[])i.status==="rejected"&&c(i.reason);return r().catch(c)})};function sn(e){if(!e||e.length===0)return[0,0];let r=0,s=0;for(const a of e){const c=Number(a.quantity)||0,o=Number(a.price)||0;if(c!==0&&o>0){const i=c*o;s+=i,r+=c}}r=Math.max(0,r);const p=r>0?s/r:0;return[r,p]}function yn(e){return/^[A-Z]{1,5}$/.test(e)}function Xn(e){return yn(e)?e:e.startsWith("00")||e.startsWith("30")?`sz${e}`:`sh${e}`}function ke(e){return e==null?"--":e.toFixed(2)}const Zn=m.lazy(()=>qe(()=>import("./KlineChart-CQjBmOP7.js"),__vite__mapDeps([0,1,2,3])).then(e=>({default:e.KlineChart}))),ts=({stock:e,children:r})=>{const{attributes:s,listeners:p,setNodeRef:a,transform:c,transition:o,isDragging:i}=mn({id:e.code}),C={transform:xn.Transform.toString(c),transition:o,opacity:i?.5:1};return t.jsx(je,{ref:a,style:C,sx:{...i&&{backgroundColor:"rgba(0, 0, 0, 0.05)"},"&:nth-of-type(odd)":{backgroundColor:"#f5f5f5"},"&:hover":{backgroundColor:"#e3f2fd"},borderBottom:"none !important",borderTop:"none !important","& td":{borderBottom:"none !important",borderTop:"none !important"}},children:r({attributes:s,listeners:p,isDragging:i})})},es=({stocks:e,privacyMode:r,config:s,onConfigUpdate:p,onAddTransaction:a,onOpenAllTransactionsDialog:c,onToggleCategorySidebar:o})=>{var ye;const[i,C]=m.useState(new Set),[_,T]=m.useState(!1),[f,D]=m.useState(null),[$,B]=m.useState(""),[W,gt]=m.useState(null),[nt,Y]=m.useState(""),[L,at]=m.useState(null),[Z,ot]=m.useState(null),[Q,it]=m.useState(null),[Mt,Et]=m.useState(!1),[Ot,b]=m.useState([]),[v,A]=m.useState(null),V=n=>{const d=(s.categories||{})[n];return(d==null?void 0:d.isDefault)===!0},j=n=>{const d=(s.categories||{})[n];return(d==null?void 0:d.isHoldings)===!0},q=n=>V(n)||j(n),S=()=>{const n=s.categories||{};for(const[u,d]of Object.entries(n))if(d.isDefault===!0)return u;return null},G=()=>{const n=s.categories||{};for(const[u,d]of Object.entries(n))if(d.isHoldings===!0)return u;return null},dt=()=>{const n=s.categories||{},u=Object.keys(n),d=S(),h=G(),w=[],k=[];for(const R of u)R===d?w.unshift(R):R===h?w.push(R):k.push(R);return k.sort(),[...w,...k]};m.useEffect(()=>{const n=dt();if(n.length>1&&Q===null){const u=S();u&&n.includes(u)?it(u):n.length>0&&it(n[0])}},[s.categories,Q]),m.useEffect(()=>{const n=()=>{Et(u=>!u)};return o&&o(n),window.__toggleCategorySidebar=n,()=>{window.__toggleCategorySidebar&&delete window.__toggleCategorySidebar}},[o]);const I=["#1976d2","#2e7d32","#ed6c02","#9c27b0","#c62828","#1565c0","#388e3c","#f57c00","#7b1fa2","#d32f2f"],st=Kn(Ge(Un),Ge(Yn,{coordinateGetter:Qn})),Ft=n=>{const{active:u,over:d}=n;if(d&&u.id!==d.id){const h=e.findIndex(O=>O.code===u.id),w=e.findIndex(O=>O.code===d.id);if(h===-1||w===-1)return;const k=s.stock_order||e.map(O=>O.code),R=e.map(O=>O.code),tt=[...k.filter(O=>R.includes(O)),...R.filter(O=>!k.includes(O))],ut=tt.findIndex(O=>O===u.id),X=tt.findIndex(O=>O===d.id);if(ut===-1||X===-1)return;const et=en(tt,ut,X),wt={...s,stock_order:et};p(wt).then(()=>{console.log("æ’åºé¡ºåºå·²ä¿å­˜:",et)}).catch(O=>{console.error("ä¿å­˜æ’åºé¡ºåºå¤±è´¥:",O)})}},[rt,bt]=m.useState(null),[zt,M]=m.useState(null),[yt,lt]=m.useState(null),[Vt,Rt]=m.useState("refund"),[xt,vt]=m.useState(null),[Pt,Bt]=m.useState(null),[jt,mt]=m.useState({time:"",quantity:"",totalAmount:""}),Kt=n=>n>0?"error":n<0?"success":"default",de=n=>n===null?"default":n>0?"error":n<0?"success":"default",Qt=()=>{if(!rt)return;const{stockCode:n,index:u,transaction:d}=rt,h=parseFloat(jt.quantity),w=parseFloat(jt.totalAmount);if(isNaN(h)||h===0||isNaN(w)||w<=0||!jt.time)return;const k=w/Math.abs(h);if(h<0){const It=s.holdings[n];if(It){const oe=Array.isArray(It.transactions)?It.transactions:[];let l=0;for(let x=0;x<oe.length;x++)x!==u&&(l+=Number(oe[x].quantity)||0);const g=l+h;if(g<0){alert(`æŒä»“ä¸è¶³ï¼Œä¿®æ”¹åæŒä»“ï¼š${g.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(h).toFixed(0)}`);return}}}const R=s.holdings[n];if(!R)return;const tt=d.totalAmount??Math.abs(d.quantity)*d.price,ut=d.quantity>0?-tt:tt,X=h>0?-w:w,et=ut-X,wt=[...R.transactions];wt[u]={id:d.id,time:jt.time,quantity:h,price:k,totalAmount:w};const O=s.funds.available_funds+et,$t={...s,funds:{...s.funds,available_funds:Math.max(0,O)},holdings:{...s.holdings,[n]:{...R,transactions:wt}}};p($t).then(()=>{bt(null),mt({time:"",quantity:"",totalAmount:""})})},ue=async()=>{if(!zt)return;const{stockCode:n,index:u}=zt,d=s.holdings[n];if(!d)return;const h=d.transactions[u],w=h.totalAmount??Math.abs(h.quantity)*h.price;if(h.id){const{deleteTransaction:ut}=await qe(async()=>{const{deleteTransaction:X}=await Promise.resolve().then(()=>ds);return{deleteTransaction:X}},void 0);await ut(h.id)}const k=d.transactions.filter((ut,X)=>X!==u),R=h.quantity>0?s.funds.available_funds+w:s.funds.available_funds-w,tt={...s,funds:{...s.funds,available_funds:R},holdings:{...s.holdings,[n]:{...d,transactions:k}}};p(tt).then(()=>{M(null)})},Yt=n=>{lt(n)},he=()=>{if(!xt)return;const{stockCode:n,alerts:u}=xt,d=[];for(const w of u){const k=parseFloat(w.price.trim());!isNaN(k)&&k>0&&d.push({type:w.type,price:k})}const h={...s,holdings:{...s.holdings},watchlist:{...s.watchlist}};h.holdings[n]?h.holdings[n]={...h.holdings[n],alerts:d.length>0?d:void 0}:h.watchlist[n]?h.watchlist[n]={...h.watchlist[n],alerts:d.length>0?d:void 0}:h.watchlist[n]={alerts:d.length>0?d:void 0},vt(null),p(h)},Lt=n=>{const u=s.watchlist[n];if(u!=null&&u.categories&&u.categories.length>0)return u.categories;const d=s.categories||{},h=S();if(h){const k=d[h];if(k&&(k.codes||[]).includes(n))return[h]}const w=[];for(const[k,R]of Object.entries(d))(R.codes||[]).includes(n)&&w.push(k);return w.length>0?w:h?[h]:[]},fe=n=>{const d=(s.categories||{})[n];return(d==null?void 0:d.title)||n},Ut=n=>{const d=(s.categories||{})[n];return(d==null?void 0:d.color)||"#1976d2"},se=n=>{const d=(s.categories||{})[n];return((d==null?void 0:d.codes)||[]).length},ie=()=>{if(!yt)return;const n=yt,u=e.find(O=>O.code===n);if(u!=null&&u.name,Lt(n).length>1){const O={...s.categories};for(const oe of Object.keys(O)){const l=O[oe];l&&l.codes&&(O[oe]={...l,codes:l.codes.filter(g=>g!==n)})}const $t={...s.watchlist};$t[n]&&($t[n]={...$t[n],categories:[]});const It={...s,categories:O,watchlist:$t};p(It).then(()=>{lt(null),Rt("refund"),Y("å·²ä»å½“å‰åˆ†ç±»åˆ é™¤")});return}let w=0;if(s.holdings[n]){const O=s.holdings[n];O.transactions,w=O.transactions.reduce(($t,It)=>$t+It.quantity*It.price,0)}const k={...s.holdings};delete k[n];const R={...s.watchlist};let tt=s.funds.available_funds;if(Vt==="refund")tt=s.funds.available_funds+w,delete R[n];else if(!R[n]){const O=s.holdings[n];R[n]={alerts:O==null?void 0:O.alerts,alert_up:(O==null?void 0:O.alert_up)||null,alert_down:(O==null?void 0:O.alert_down)||null}}const ut={...s.categories};for(const O of Object.keys(ut)){const $t=ut[O];$t&&$t.codes&&(ut[O]={...$t,codes:$t.codes.filter(It=>It!==n)})}const et=(s.stock_order||[]).filter(O=>O!==n),wt={...s,stock_order:et,categories:ut,funds:{...s.funds,available_funds:tt},holdings:k,watchlist:R,historical_holdings:[]};p(wt).then(()=>{lt(null),Rt("refund")})},pe=n=>{const{active:u,over:d}=n;if(d&&u.id!==d.id){const h=Ot.findIndex(wt=>wt===u.id),w=Ot.findIndex(wt=>wt===d.id);if(h===-1||w===-1)return;const k=S(),R=G(),tt=k?Ot.indexOf(k):-1,ut=R?Ot.indexOf(R):-1;if(u.id===k||u.id===R)return;const X=Math.max(tt,ut)+1;if(w<X)return;const et=en(Ot,h,w);b(et)}},re=()=>{const n=dt();if(Ot.length===0)return n;const u=[],d=new Set;for(const h of Ot)n.includes(h)&&(u.push(h),d.add(h));for(const h of n)d.has(h)||u.push(h);return u};return t.jsxs(N,{sx:{display:"flex",gap:1},children:[t.jsx(N,{sx:{flex:Mt?"0 0 calc(100% - 200px)":"1 1 auto",transition:"flex 0.3s"},children:t.jsx(Je,{sensors:st,collisionDetection:Xe,onDragEnd:Ft,children:t.jsx(un,{component:Ie,children:t.jsxs(hn,{size:"small",sx:{minWidth:650,borderCollapse:"collapse"},children:[t.jsx(fn,{children:t.jsxs(je,{sx:{backgroundColor:"#1976d2"},children:[t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:40,p:.25,borderBottom:"none !important"}}),t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:140,p:.25,borderBottom:"none !important"},children:"åç§°"}),t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:100,p:.25,borderBottom:"none !important"},children:"ä»£ç "}),t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:80,p:.25,borderBottom:"none !important"},children:"ç°ä»·"}),t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:80,p:.25,borderBottom:"none !important"},children:"æ¶¨è·Œå¹…"}),t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:80,p:.25,borderBottom:"none !important"},children:"æˆæœ¬ä»·"}),t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:80,p:.25,borderBottom:"none !important"},children:"æ•°é‡"}),t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:200,p:.25,borderBottom:"none !important"},children:"ç›ˆäº"}),t.jsx(E,{sx:{color:"white",fontWeight:"bold",width:40,p:.25,borderBottom:"none !important"},children:"æ“ä½œ"})]})}),t.jsx(Ze,{items:(()=>{let n=e;if(Q){const d=(s.categories||{})[Q];if(d&&d.codes){const h=new Set(d.codes);n=e.filter(w=>h.has(w.code))}}return n.map(u=>u.code)})(),strategy:tn,children:t.jsx(pn,{children:(()=>{let n=e;if(Q){const d=(s.categories||{})[Q];if(d&&d.codes){const h=new Set(d.codes);n=e.filter(w=>h.has(w.code))}}return n})().map(n=>{n.last_price!==null&&n.holding_quantity>0&&n.last_price*n.holding_quantity;const u=n.holding_price!==null&&n.holding_quantity>0&&n.last_price!==null?(n.last_price-n.holding_price)*n.holding_quantity:null,d=n.holding_price!==null&&n.holding_price>0&&u!==null?u/(n.holding_price*n.holding_quantity)*100:null,h=u!==null&&d!==null?r?`***(${d.toFixed(2)}%)`:`${u.toFixed(2)}(${d.toFixed(2)}%)`:"--";return i.has(n.code),t.jsx(_e.Fragment,{children:t.jsx(ts,{stock:n,children:({attributes:w,listeners:k})=>t.jsxs(t.Fragment,{children:[t.jsx(E,{sx:{p:.25,cursor:"grab","&:active":{cursor:"grabbing"},borderBottom:"none !important"},...w,...k,children:t.jsx(He,{sx:{color:"text.secondary",fontSize:20}})}),t.jsx(E,{sx:{p:.25,borderBottom:"none !important"},children:r?"***":n.name}),t.jsx(E,{sx:{p:.25,borderBottom:"none !important"},children:r?"***":n.code}),t.jsx(E,{sx:{p:.25,borderBottom:"none !important"},children:n.last_price!==null?ke(n.last_price):"--"}),t.jsx(E,{sx:{p:.25,borderBottom:"none !important"},children:t.jsx(Gt,{label:`${n.last_change_pct>=0?"+":""}${n.last_change_pct.toFixed(2)}%`,color:Kt(n.last_change_pct),size:"small",sx:{height:20,fontSize:"0.75rem"}})}),t.jsx(E,{sx:{p:.25,borderBottom:"none !important"},children:n.holding_price!==null?r?"***":ke(n.holding_price):"--"}),t.jsx(E,{sx:{p:.25,borderBottom:"none !important"},children:n.holding_quantity>0?r?"***":String(Math.floor(n.holding_quantity)):"--"}),t.jsx(E,{sx:{p:.25,borderBottom:"none !important"},children:t.jsx(Gt,{label:h,color:de(u),size:"small",sx:{height:20,fontSize:"0.75rem"}})}),t.jsx(E,{sx:{p:.25,borderBottom:"none !important"},children:t.jsx(N,{sx:{display:"flex",alignItems:"center",gap:0},children:t.jsx(ce,{size:"small",onClick:R=>{A({el:R.currentTarget,stockCode:n.code})},sx:{p:.5},children:t.jsx(Re,{fontSize:"small"})})})})]})})},n.code)})})})]})})})}),Mt&&t.jsx(N,{sx:{flex:"0 0 200px",border:"1px solid #e0e0e0",borderRadius:0,backgroundColor:"#f5f5f5",p:1},children:t.jsx(Je,{sensors:st,collisionDetection:Xe,onDragEnd:pe,children:t.jsx(Ze,{items:re(),strategy:tn,children:t.jsx(N,{sx:{display:"flex",flexDirection:"column",gap:.5},children:re().map(n=>{const u=q(n),d=Q===n,h=()=>{const{attributes:w,listeners:k,setNodeRef:R,transform:tt,transition:ut,isDragging:X}=mn({id:n,disabled:u}),et={transform:xn.Transform.toString(tt),transition:ut,opacity:X?.5:1};return t.jsxs(N,{ref:R,style:et,sx:{display:"flex",alignItems:"center",gap:.5,p:.5,backgroundColor:d?`${Ut(n)}20`:"transparent",borderRadius:0,cursor:d?"default":"pointer","&:hover":{backgroundColor:d?`${Ut(n)}30`:"rgba(0, 0, 0, 0.04)"}},children:[!u&&t.jsx(N,{...w,...k,sx:{cursor:"grab","&:active":{cursor:"grabbing"}},children:t.jsx(He,{sx:{color:"text.secondary",fontSize:16}})}),t.jsx(F,{size:"small",onClick:()=>{it(n)},sx:{flex:1,justifyContent:"flex-start",color:d?Ut(n):"text.primary",textTransform:"none",minWidth:"auto",padding:"4px 8px",fontSize:"0.875rem",fontWeight:d?"bold":"normal"},children:fe(n)}),t.jsx(ce,{size:"small",onClick:wt=>{at({el:wt.currentTarget,categoryName:n})},sx:{padding:"2px"},children:t.jsx(Re,{fontSize:"small"})})]})};return t.jsx(h,{},n)})})})})}),t.jsx(Be,{anchorEl:v==null?void 0:v.el,open:!!v,onClose:()=>A(null),children:v&&(()=>{const n=e.find(h=>h.code===v.stockCode);if(!n)return null;const u=s.holdings[n.code],d=s.watchlist[n.code];return t.jsxs(t.Fragment,{children:[t.jsx(ct,{onClick:()=>{c&&c(n.code),A(null)},sx:{py:.25,fontSize:"0.875rem"},children:"äº¤æ˜“åˆ—è¡¨"}),t.jsx(ct,{onClick:()=>{const w=Lt(n.code).filter(k=>!j(k));D({stockCode:n.code,categories:[...w]}),T(!0),A(null)},sx:{py:.25,fontSize:"0.875rem"},children:"åˆ†ç»„"}),t.jsx(ct,{onClick:()=>{Bt({stockCode:n.code,stockName:n.name}),A(null)},sx:{py:.25,fontSize:"0.875rem"},children:"Kå›¾"}),t.jsx(ct,{onClick:()=>{const h=[];if(u!=null&&u.alerts&&u.alerts.length>0)u.alerts.forEach(w=>{h.push({type:w.type,price:w.price.toString()})});else if(d!=null&&d.alerts&&d.alerts.length>0)d.alerts.forEach(w=>{h.push({type:w.type,price:w.price.toString()})});else{const w=(u==null?void 0:u.alert_up)??(d==null?void 0:d.alert_up)??null,k=(u==null?void 0:u.alert_down)??(d==null?void 0:d.alert_down)??null;w!==null&&h.push({type:"up",price:w.toString()}),k!==null&&h.push({type:"down",price:k.toString()})}h.length===0&&h.push({type:"up",price:""}),vt({stockCode:n.code,alerts:h}),A(null)},sx:{py:.25,fontSize:"0.875rem"},children:"æŠ¥è­¦"}),t.jsx(ct,{onClick:()=>{Yt(n.code),A(null)},sx:{py:.25,fontSize:"0.875rem",color:"error.main"},children:"åˆ é™¤"})]})})()}),t.jsxs(St,{open:!!rt,onClose:()=>bt(null),maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.25,pt:.5,px:1},children:"ç¼–è¾‘äº¤æ˜“è®°å½•"}),t.jsx(Ct,{sx:{pt:.25,px:1},children:t.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx(pt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",size:"small",fullWidth:!0,variant:"outlined",value:jt.time?(()=>{try{const n=new Date(jt.time),u=n.getFullYear(),d=String(n.getMonth()+1).padStart(2,"0"),h=String(n.getDate()).padStart(2,"0"),w=String(n.getHours()).padStart(2,"0"),k=String(n.getMinutes()).padStart(2,"0");return`${u}-${d}-${h}T${w}:${k}`}catch{return""}})():"",onChange:n=>{const u=n.target.value;if(u){const d=new Date(u),h=d.getFullYear(),w=String(d.getMonth()+1).padStart(2,"0"),k=String(d.getDate()).padStart(2,"0"),R=String(d.getHours()).padStart(2,"0"),tt=String(d.getMinutes()).padStart(2,"0"),ut=String(d.getSeconds()).padStart(2,"0");mt({...jt,time:`${h}-${w}-${k} ${R}:${tt}:${ut}`})}},InputLabelProps:{shrink:!0}}),t.jsx(pt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:jt.quantity,onChange:n=>{const u=n.target.value;(u===""||u==="-"||/^-?\d*\.?\d*$/.test(u))&&mt({...jt,quantity:u})},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡º"}),t.jsx(pt,{label:"å•ä»·",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:jt.price,onChange:n=>mt({...jt,price:n.target.value}),inputProps:{min:0,step:.001}})]})}),t.jsxs(Dt,{sx:{px:1,pb:.25,pt:.25},children:[t.jsx(F,{size:"small",onClick:()=>bt(null),sx:{py:.25,px:1},children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:Qt,variant:"contained",sx:{py:.25,px:1},children:"ä¿å­˜"})]})]}),t.jsxs(St,{open:!!zt,onClose:()=>M(null),maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.25,pt:.5,px:1},children:"ç¡®è®¤åˆ é™¤"}),t.jsx(Ct,{sx:{pt:.25,px:1},children:t.jsx(J,{variant:"body2",children:"ç¡®å®šè¦åˆ é™¤è¿™æ¡äº¤æ˜“è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"})}),t.jsxs(Dt,{sx:{px:1,pb:.25,pt:.25},children:[t.jsx(F,{size:"small",onClick:()=>M(null),sx:{py:.25,px:1},children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:ue,variant:"contained",color:"error",sx:{py:.25,px:1},children:"åˆ é™¤"})]})]}),t.jsxs(St,{open:!!xt,onClose:()=>vt(null),maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"æŠ¥è­¦é…ç½®"}),t.jsx(Ct,{sx:{pt:.5},children:xt&&t.jsxs(t.Fragment,{children:[t.jsx(J,{variant:"body2",sx:{color:"text.secondary"},children:"è®¾ç½®ä»·æ ¼æŠ¥è­¦è§„åˆ™ï¼Œå½“è‚¡ä»·è¾¾åˆ°è®¾å®šä»·æ ¼æ—¶ä¼šå‘å‡ºæé†’ã€‚å¯ä»¥æ·»åŠ å¤šæ¡è§„åˆ™ã€‚"}),xt.alerts.map((n,u)=>t.jsxs(N,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(Jt,{size:"small",sx:{minWidth:100},children:t.jsxs(ae,{value:n.type,onChange:d=>{const h=[...xt.alerts];h[u].type=d.target.value,vt({...xt,alerts:h})},children:[t.jsx(ct,{value:"up",children:"ä¸Šæ¶¨"}),t.jsx(ct,{value:"down",children:"ä¸‹è·Œ"})]})}),t.jsx(pt,{label:"é‡‘é¢",type:"number",size:"small",fullWidth:!0,value:n.price,onChange:d=>{const h=[...xt.alerts];h[u].price=d.target.value,vt({...xt,alerts:h})},placeholder:"æŠ¥è­¦ä»·æ ¼",inputProps:{step:"0.01",min:"0"}}),t.jsx(ce,{size:"small",onClick:()=>{const d=xt.alerts.filter((h,w)=>w!==u);d.length===0&&d.push({type:"up",price:""}),vt({...xt,alerts:d})},color:"error",children:t.jsx(Fn,{})})]},u)),t.jsx(F,{size:"small",startIcon:t.jsx(we,{}),onClick:()=>{vt({...xt,alerts:[...xt.alerts,{type:"up",price:""}]})},children:"æ·»åŠ è§„åˆ™"})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:()=>vt(null),children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:he,variant:"contained",children:"ä¿å­˜"})]})]}),t.jsxs(St,{open:!!yt,onClose:()=>{lt(null),Rt("refund")},maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"ç¡®è®¤åˆ é™¤è‡ªé€‰è‚¡"}),t.jsxs(Ct,{sx:{pt:.5},children:[t.jsx(J,{variant:"body2",children:"ç¡®å®šè¦åˆ é™¤è¯¥è‡ªé€‰è‚¡å—ï¼Ÿè¯·é€‰æ‹©åˆ é™¤æ–¹å¼ï¼š"}),(!yt||Lt(yt).length<=1)&&t.jsx(Jt,{component:"fieldset",children:t.jsxs(In,{value:Vt,onChange:n=>Rt(n.target.value),children:[t.jsx(Le,{value:"refund",control:t.jsx(Ve,{}),label:t.jsxs(N,{children:[t.jsx(J,{variant:"body1",sx:{fontWeight:"bold"},children:"åˆ é™¤å¹¶é€€å›æ‰€æœ‰äº¤æ˜“"}),t.jsx(J,{variant:"body2",color:"text.secondary",children:"åˆ é™¤è¯¥è‚¡ç¥¨çš„æ‰€æœ‰äº¤æ˜“è®°å½•ï¼Œå¹¶å°†äº¤æ˜“é‡‘é¢é€€å›å¯ç”¨èµ„é‡‘"})]})}),t.jsx(Le,{value:"keep",control:t.jsx(Ve,{}),label:t.jsxs(N,{children:[t.jsx(J,{variant:"body1",sx:{fontWeight:"bold"},children:"åˆ é™¤ä½†ä¿ç•™äº¤æ˜“è®°å½•"}),t.jsx(J,{variant:"body2",color:"text.secondary",children:"åˆ é™¤è¯¥è‚¡ç¥¨ï¼Œä½†å°†äº¤æ˜“è®°å½•è½¬ç§»åˆ°å†å²äº¤æ˜“æ•°æ®ä¸­ï¼Œä¸é€€å›èµ„é‡‘"})]})})]})}),(!yt||Lt(yt).length<=1)&&t.jsx(J,{sx:{fontWeight:"bold",color:"error.main"},children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ"})]}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:()=>{lt(null),Rt("refund")},children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:ie,variant:"contained",color:"error",children:"ç¡®è®¤åˆ é™¤"})]})]}),t.jsxs(St,{open:_,onClose:()=>{T(!1),D(null),B("")},maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.25,pt:.5,px:1},children:"åˆ†ç»„ç®¡ç†"}),t.jsx(Ct,{sx:{pt:.25,px:1},children:f&&t.jsxs(t.Fragment,{children:[t.jsxs(J,{variant:"body2",sx:{color:"text.secondary"},children:["è‚¡ç¥¨ï¼š",((ye=e.find(n=>n.code===f.stockCode))==null?void 0:ye.name)||f.stockCode]}),t.jsxs(N,{sx:{display:"flex",gap:1},children:[t.jsx(pt,{label:"æ–°åˆ†ç»„åç§°",size:"small",fullWidth:!0,value:$,onChange:n=>B(n.target.value),onKeyPress:n=>{if(n.key==="Enter"&&$.trim()){const u=$.trim(),d=S();if(u===d){Y("è¯¥åç§°ä¸é»˜è®¤åˆ†ç»„å†²çªï¼Œä¸èƒ½åˆ›å»º");return}if(f.categories.includes(u)){Y("è¯¥åˆ†ç»„å·²å­˜åœ¨");return}D({...f,categories:[...f.categories,u]}),B("")}}}),t.jsx(F,{size:"small",variant:"outlined",onClick:()=>{if($.trim()){const n=$.trim(),u=S();if(n===u){Y("è¯¥åç§°ä¸é»˜è®¤åˆ†ç»„å†²çªï¼Œä¸èƒ½åˆ›å»º");return}if(f.categories.includes(n)){Y("è¯¥åˆ†ç»„å·²å­˜åœ¨");return}D({...f,categories:[...f.categories,n]}),B("")}},children:"åˆ›å»º"})]}),t.jsx(J,{variant:"body2",sx:{fontWeight:"bold"},children:"æ‰€å±åˆ†ç»„ï¼š"}),t.jsxs(N,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[f.categories.filter(n=>!j(n)).map(n=>t.jsx(Gt,{label:n,onDelete:()=>{if(q(n)&&f.categories.filter(u=>!j(u)).length===1){Y("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªåˆ†ç»„");return}D({...f,categories:f.categories.filter(u=>u!==n)})},color:q(n)?"primary":"default"},n)),f.categories.filter(n=>!j(n)).length===0&&t.jsx(J,{variant:"body2",color:"text.secondary",children:'æœªåˆ†ç»„ï¼ˆå°†è‡ªåŠ¨æ·»åŠ åˆ°"è‡ªé€‰"åˆ†ç»„ï¼‰'})]}),t.jsx(J,{variant:"body2",sx:{fontWeight:"bold"},children:"æ·»åŠ åˆ°åˆ†ç»„ï¼š"}),t.jsxs(N,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[Object.keys(s.categories||{}).filter(n=>!f.categories.includes(n)&&!j(n)).map(n=>t.jsx(Gt,{label:n,onClick:()=>{D({...f,categories:[...f.categories,n]})},sx:{cursor:"pointer"}},n)),(!s.categories||Object.keys(s.categories).length===0)&&(()=>{const n=S();return n&&!f.categories.includes(n)})()&&t.jsx(Gt,{label:S()||"è‡ªé€‰",onClick:()=>{const n=S()||"è‡ªé€‰";D({...f,categories:[...f.categories,n]})},sx:{cursor:"pointer"},color:"primary"})]})]})}),t.jsxs(Dt,{sx:{px:1,pb:.25,pt:.25},children:[t.jsx(F,{size:"small",onClick:()=>{T(!1),D(null),B("")},sx:{py:.25,px:1},children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:()=>{if(!f)return;const n=f.stockCode,u=S()||"è‡ªé€‰",d=f.categories.length>0?f.categories:[u],h={...s.categories||{}};for(const X of Object.keys(h)){const et=h[X];et&&(et.codes||(et.codes=[]),h[X]={...et,codes:(et.codes||[]).filter(wt=>wt!==n)})}h[u]||(h[u]={codes:[],title:u,color:"#1976d2",isDefault:!0});const w=G()||"æŒä»“";h[w]||(h[w]={codes:[],title:w,color:"#2e7d32",isHoldings:!0}),h[w].codes||(h[w].codes=[]);const k=e.find(X=>X.code===n);((k==null?void 0:k.holding_quantity)||0)>0?h[w].codes.includes(n)||(h[w]={...h[w],codes:[...h[w].codes||[],n]}):h[w]={...h[w],codes:(h[w].codes||[]).filter(X=>X!==n)};for(const X of d){h[X]||(h[X]={codes:[],title:X,color:"#1976d2"});const et=h[X];et&&!et.codes&&(et.codes=[]),et&&et.codes&&!et.codes.includes(n)&&(h[X]={...et,codes:[...et.codes,n]})}const tt={...s.watchlist};tt[n]?tt[n]={...tt[n],categories:d}:tt[n]={categories:d};const ut={...s,categories:h,watchlist:tt};p(ut).then(()=>{T(!1),D(null),B("")})},variant:"contained",children:"ä¿å­˜"})]})]}),t.jsx(Be,{anchorEl:L==null?void 0:L.el,open:!!L,onClose:()=>at(null),children:L&&t.jsxs(t.Fragment,{children:[t.jsx(ct,{onClick:()=>{const n=L.categoryName,d=(s.categories||{})[n]||{title:n,color:"#1976d2"};ot({name:n,title:d.title||n,color:d.color||"#1976d2"}),at(null)},children:"è®¾ç½®"}),t.jsx(ct,{onClick:()=>{const n=L.categoryName;if(q(n)){Y("ç³»ç»Ÿé»˜è®¤åˆ†ç»„ä¸èƒ½åˆ é™¤"),at(null);return}if(se(n)>0){Y("è¯¥åˆ†ç»„ä¸­è¿˜æœ‰è‚¡ç¥¨ï¼Œæ— æ³•åˆ é™¤"),at(null);return}const d={...s.categories};delete d[n];const h={...s,categories:d};p(h).then(()=>{at(null)})},disabled:q(L.categoryName)||se(L.categoryName)>0,children:"åˆ é™¤"})]})}),t.jsxs(St,{open:!!Z,onClose:()=>ot(null),maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"ç¼–è¾‘åˆ†ç»„"}),t.jsx(Ct,{sx:{pt:.5},children:Z&&t.jsxs(t.Fragment,{children:[t.jsx(pt,{label:"åˆ†ç»„æ ‡é¢˜",size:"small",fullWidth:!0,value:Z.title,onChange:n=>ot({...Z,title:n.target.value}),disabled:q(Z.name),helperText:q(Z.name)?"ç³»ç»Ÿé»˜è®¤åˆ†ç»„ä¸å…è®¸ä¿®æ”¹æ ‡é¢˜":""}),t.jsx(J,{variant:"body2",sx:{color:"text.secondary"},children:"åˆ†ç»„é¢œè‰²"}),t.jsx(N,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:I.map(n=>t.jsx(N,{onClick:()=>ot({...Z,color:n}),sx:{width:32,height:32,backgroundColor:n,borderRadius:"4px",cursor:"pointer",border:Z.color===n?"2px solid #000":"2px solid transparent","&:hover":{opacity:.8,transform:"scale(1.1)"},transition:"all 0.2s"}},n))})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:()=>ot(null),children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:()=>{if(!Z)return;const n={...s.categories},u=Z.name,d=n[u]||{codes:[]};n[u]={...d,title:Z.title,color:Z.color};const h={...s,categories:n};p(h).then(()=>{ot(null)})},variant:"contained",children:"ä¿å­˜"})]})]}),t.jsx(gn,{open:!!nt,autoHideDuration:3e3,onClose:()=>Y(""),message:nt}),Pt&&t.jsx(m.Suspense,{fallback:t.jsx(St,{open:!0,onClose:()=>Bt(null),maxWidth:"lg",fullWidth:!0,children:t.jsx(Ct,{children:t.jsx(N,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:t.jsx(qn,{})})})}),children:t.jsx(Zn,{open:!!Pt,onClose:()=>Bt(null),stockCode:Pt.stockCode,stockName:Pt.stockName})})]})},ns=({stocks:e,funds:r,privacyMode:s,onPrivacyModeToggle:p,config:a,onConfigUpdate:c})=>{const o=Q=>s?"***":Q.toFixed(2),i=e.reduce((Q,it)=>it.last_price!==null&&it.holding_quantity>0?Q+it.last_price*it.holding_quantity:Q,0),C=(a.historical_holdings||[]).reduce((Q,it)=>Q+it.transactions.reduce((Mt,Et)=>Mt+Et.quantity*Et.price,0),0),_=r.available_funds+i+C,T=e.filter(Q=>Q.holding_price!==null&&Q.holding_quantity>0).length,f=_-r.total_original_funds,D=r.total_original_funds>0?f/r.total_original_funds*100:0,$=e.length>0?e.reduce((Q,it)=>Q+it.last_change_pct,0)/e.length:0,B=_>0?i/_*100:0,W=i>0||T>0,gt=W?$:0,nt=W?f:0,Y=W?D:0,L=new Date,at=`${L.getFullYear()}-${String(L.getMonth()+1).padStart(2,"0")}-${String(L.getDate()).padStart(2,"0")} ${String(L.getHours()).padStart(2,"0")}:${String(L.getMinutes()).padStart(2,"0")}:${String(L.getSeconds()).padStart(2,"0")}`,Z=a.update_interval??1e3,ot=async Q=>{const it={...a,update_interval:Q};await c(it)};return t.jsxs(Ie,{sx:{p:.5,mb:.5,backgroundColor:"#f5f5f5",position:"relative",borderRadius:0},children:[t.jsxs(N,{sx:{position:"absolute",top:8,right:8,display:"flex",alignItems:"center",gap:1},children:[t.jsx(Jt,{size:"small",sx:{minWidth:80},children:t.jsxs(ae,{value:Z,onChange:Q=>ot(Q.target.value),sx:{fontSize:"0.75rem",height:"28px","& .MuiSelect-select":{py:.5}},children:[t.jsx(ct,{value:1e3,children:"1s"}),t.jsx(ct,{value:3e3,children:"3s"}),t.jsx(ct,{value:5e3,children:"5s"}),t.jsx(ct,{value:1e4,children:"10s"})]})}),t.jsx(Mn,{title:s?"æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯":"éšè—æ•æ„Ÿä¿¡æ¯",children:t.jsx(ce,{onClick:p,sx:{color:s?"text.secondary":"primary.main"},size:"small",children:s?t.jsx(zn,{}):t.jsx(Pn,{})})})]}),t.jsx(N,{sx:{mb:.5},children:t.jsxs(J,{variant:"body2",component:"span",sx:{color:"text.secondary",fontSize:"0.875rem"},children:["æ—¶é—´:",at," | è‡ªé€‰:",e.length," | æ¶¨è·Œå¹…:",t.jsxs(J,{variant:"body2",component:"span",sx:{color:W?gt>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:[gt>=0?"+":"",gt.toFixed(2),"%"]})," | æŒä»“:",T," | ç›ˆäº:",s?t.jsxs(J,{variant:"body2",component:"span",sx:{color:W?Y>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:["***(",Y>=0?"+":"",Y.toFixed(2),"%)"]}):t.jsxs(J,{variant:"body2",component:"span",sx:{color:W?nt>=0?"#d32f2f":"#2e7d32":"text.secondary",fontSize:"0.875rem",fontWeight:"bold"},children:[nt>=0?"+":"",o(nt),"(",Y>=0?"+":"",Y.toFixed(2),"%)"]})]})}),t.jsx(N,{children:t.jsxs(J,{variant:"body2",component:"span",sx:{color:"text.secondary",fontSize:"0.875rem"},children:["æœ¬é‡‘:",o(r.total_original_funds)," | å®æ—¶å¸‚å€¼:",o(_)," | æŒä»“å¸‚å€¼:",o(i)," | å¯ç”¨èµ„é‡‘:",o(r.available_funds)," | ä»“ä½:",B.toFixed(2),"%"]})})]})};async function wn(e){const r=new Map;if(e.length===0)return r;try{const s=e.map(c=>Xn(c)),p=new Map;s.forEach((c,o)=>{p.set(c,e[o])});const a=`https://qt.gtimg.cn/q=${s.join(",")}`;return new Promise((c,o)=>{const i=document.createElement("script"),C=`tencent_batch_callback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;window[C]=()=>{delete window[C],document.body.contains(i)&&document.body.removeChild(i);try{for(const _ of s){const T=p.get(_),f=`v_${_}`,D=window[f];if(!D||typeof D!="string")continue;const $=D.split("~");if($.length<5)continue;const B=$[1]||T,W=parseFloat($[3])||0,gt=parseFloat($[4])||0;if(W<=0)continue;let nt="";for(let Y=0;Y<$.length;Y++){const L=$[Y];if(/^\d{14}$/.test(L)){const at=L.substring(8,10),Z=L.substring(10,12),ot=L.substring(12,14);nt=`${at}:${Z}:${ot}.000`;break}}if(!nt){const Y=new Date,L=Y.getHours().toString().padStart(2,"0"),at=Y.getMinutes().toString().padStart(2,"0"),Z=Y.getSeconds().toString().padStart(2,"0"),ot=Y.getMilliseconds().toString().padStart(3,"0");nt=`${L}:${at}:${Z}.${ot}`}r.set(T,{price:W,name:B,yesterday_close:gt||W,update_time:nt})}}catch(_){console.error("è§£æè…¾è®¯APIæ‰¹é‡æ•°æ®å¤±è´¥:",_)}c(r)},i.src=a,i.onerror=()=>{delete window[C],document.body.contains(i)&&document.body.removeChild(i),c(r)},i.onload=()=>{setTimeout(()=>{window[C]?window[C]():c(r)},100)},document.body.appendChild(i),setTimeout(()=>{document.body.contains(i)&&(delete window[C],document.body.removeChild(i),c(r))},1e4)})}catch(s){return console.error("æ‰¹é‡è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥ï¼ˆè…¾è®¯ï¼‰:",s),r}}async function rn(e){try{return(await wn([e])).get(e)||null}catch(r){return console.warn(`è…¾è®¯APIè·å– ${e} å¤±è´¥:`,r),null}}async function $e(e){if(e.length===0)return new Map;try{return await wn(e)}catch(r){return console.error("æ‰¹é‡è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥:",r),new Map}}const ss=!1,rs={available_funds:1e4,total_original_funds:1e4},os={Aè‚¡:{enabled:!0,morning:{start:"09:30",end:"11:30"},afternoon:{start:"13:00",end:"15:00"},weekdays:[1,2,3,4,5]},ç¾è‚¡:{enabled:!1,morning:{start:"22:30",end:"05:00"},afternoon:null,weekdays:[1,2,3,4,5]}},as={},is={600228:{alert_up:null,alert_down:null},"002255":{alert_up:null,alert_down:null}},ls={privacy_mode:ss,funds:rs,market_hours:os,holdings:as,watchlist:is},bn="stocks_db",on=4,Wt="watchlist",At="transactions",te="config",ee="history";let Xt=null;async function cs(){return new Promise((e,r)=>{const s=indexedDB.deleteDatabase(bn);s.onsuccess=()=>{Xt=null,e()},s.onerror=()=>r(new Error("åˆ é™¤ IndexedDB å¤±è´¥")),s.onblocked=()=>r(new Error("åˆ é™¤ IndexedDB è¢«é˜»å¡"))})}function kt(){return Xt?Promise.resolve(Xt):new Promise((e,r)=>{const s=indexedDB.open(bn,on);s.onerror=()=>{r(new Error("æ‰“å¼€ IndexedDB å¤±è´¥"))},s.onupgradeneeded=p=>{const a=p.target.result,c=p.oldVersion||0;console.log(`IndexedDB å‡çº§: ä»ç‰ˆæœ¬ ${c} åˆ°ç‰ˆæœ¬ ${on}`),c>0&&(a.objectStoreNames.contains("holdings_transactions")&&a.deleteObjectStore("holdings_transactions"),a.objectStoreNames.contains("historical_holdings")&&a.deleteObjectStore("historical_holdings")),a.objectStoreNames.contains(Wt)||a.createObjectStore(Wt,{keyPath:"code"}).createIndex("code","code",{unique:!0}),a.objectStoreNames.contains(At)||a.createObjectStore(At,{keyPath:"id",autoIncrement:!0}).createIndex("code","code",{unique:!1}),a.objectStoreNames.contains(te)||a.createObjectStore(te,{keyPath:"key"}).createIndex("key","key",{unique:!0}),a.objectStoreNames.contains(ee)||a.createObjectStore(ee,{keyPath:"date"}).createIndex("date","date",{unique:!0})},s.onsuccess=()=>{Xt=s.result,e(Xt)}})}async function ne(e){try{const p=(await kt()).transaction([Wt],"readwrite").objectStore(Wt);await new Promise((a,c)=>{const o=p.put(e);o.onsuccess=()=>a(),o.onerror=()=>c(new Error("ä¿å­˜è‡ªé€‰è‚¡å¤±è´¥"))})}catch(r){throw console.error("ä¿å­˜è‡ªé€‰è‚¡å¤±è´¥:",r),r}}async function jn(e){try{const p=(await kt()).transaction([Wt],"readonly").objectStore(Wt);return new Promise((a,c)=>{const o=p.get(e);o.onsuccess=()=>{a(o.result||null)},o.onerror=()=>c(new Error("åŠ è½½è‡ªé€‰è‚¡å¤±è´¥"))})}catch(r){return console.error("åŠ è½½è‡ªé€‰è‚¡å¤±è´¥:",r),null}}async function me(){try{const s=(await kt()).transaction([Wt],"readonly").objectStore(Wt);return new Promise((p,a)=>{const c=s.getAll();c.onsuccess=()=>{const o={};c.result.forEach(i=>{o[i.code]=i}),p(o)},c.onerror=()=>a(new Error("åŠ è½½æ‰€æœ‰è‡ªé€‰è‚¡å¤±è´¥"))})}catch(e){return console.error("åŠ è½½æ‰€æœ‰è‡ªé€‰è‚¡å¤±è´¥:",e),{}}}async function _n(e){try{const p=(await kt()).transaction([Wt],"readwrite").objectStore(Wt);await new Promise((a,c)=>{const o=p.delete(e);o.onsuccess=()=>a(),o.onerror=()=>c(new Error("åˆ é™¤è‡ªé€‰è‚¡å¤±è´¥"))})}catch(r){throw console.error("åˆ é™¤è‡ªé€‰è‚¡å¤±è´¥:",r),r}}async function Te(e,r){try{const a=(await kt()).transaction([At],"readwrite").objectStore(At),c=new Error().stack,o=r||"unknown";return console.log("ğŸ”µ [æ·»åŠ äº¤æ˜“è®°å½•]",{source:o,code:e.code,time:e.time,quantity:e.quantity,price:e.price,stack:c==null?void 0:c.split(`
`).slice(1,5).join(`
`)}),new Promise((i,C)=>{const _=a.add(e);_.onsuccess=()=>{const T=_.result;console.log("âœ… [äº¤æ˜“è®°å½•å·²æ·»åŠ ]",{source:o,id:T,code:e.code,time:e.time}),i(T)},_.onerror=()=>C(new Error("æ·»åŠ äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(s){throw console.error("âŒ [æ·»åŠ äº¤æ˜“è®°å½•å¤±è´¥]",{source:r||"unknown",error:s,transaction:e}),s}}async function Se(e,r){try{const a=(await kt()).transaction([At],"readwrite").objectStore(At);await new Promise((c,o)=>{const i=a.put({...r,id:e});i.onsuccess=()=>c(),i.onerror=()=>o(new Error("æ›´æ–°äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(s){throw console.error("æ›´æ–°äº¤æ˜“è®°å½•å¤±è´¥:",s),s}}async function Ce(e){try{const p=(await kt()).transaction([At],"readwrite").objectStore(At);await new Promise((a,c)=>{const o=p.delete(e);o.onsuccess=()=>a(),o.onerror=()=>c(new Error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(r){throw console.error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥:",r),r}}async function Me(e){try{const a=(await kt()).transaction([At],"readonly").objectStore(At).index("code");return new Promise((c,o)=>{const i=a.getAll(e);i.onsuccess=()=>{c(i.result||[])},i.onerror=()=>o(new Error("åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(r){return console.error("åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥:",r),[]}}async function ze(){try{const s=(await kt()).transaction([At],"readonly").objectStore(At);return new Promise((p,a)=>{const c=s.getAll();c.onsuccess=()=>{const o={};c.result.forEach(i=>{o[i.code]||(o[i.code]=[]),o[i.code].push(i)}),p(o)},c.onerror=()=>a(new Error("åŠ è½½æ‰€æœ‰äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(e){return console.error("åŠ è½½æ‰€æœ‰äº¤æ˜“è®°å½•å¤±è´¥:",e),{}}}async function Pe(){try{Xt&&(Xt.close(),Xt=null),await new Promise(e=>setTimeout(e,100));try{await cs(),await new Promise(e=>setTimeout(e,100))}catch{console.log("åˆ é™¤æ•°æ®åº“è¢«é˜»å¡ï¼Œæ”¹ä¸ºæ¸…ç©ºå„ä¸ªè¡¨");const r=await kt(),p=r.transaction([Wt],"readwrite").objectStore(Wt);await new Promise((T,f)=>{const D=p.clear();D.onsuccess=()=>T(),D.onerror=()=>f(new Error("æ¸…ç©º watchlist å¤±è´¥"))});const c=r.transaction([At],"readwrite").objectStore(At);await new Promise((T,f)=>{const D=c.clear();D.onsuccess=()=>T(),D.onerror=()=>f(new Error("æ¸…ç©º transactions å¤±è´¥"))});const i=r.transaction([te],"readwrite").objectStore(te);await new Promise((T,f)=>{const D=i.clear();D.onsuccess=()=>T(),D.onerror=()=>f(new Error("æ¸…ç©º config å¤±è´¥"))});const _=r.transaction([ee],"readwrite").objectStore(ee);await new Promise((T,f)=>{const D=_.clear();D.onsuccess=()=>T(),D.onerror=()=>f(new Error("æ¸…ç©º history å¤±è´¥"))})}}catch(e){throw console.error("æ¸…ç©ºæ‰€æœ‰æ•°æ®å¤±è´¥:",e),e}}async function Sn(e){try{const p=(await kt()).transaction([At],"readwrite").objectStore(At),a=p.index("code");return new Promise((c,o)=>{const i=a.openKeyCursor(IDBKeyRange.only(e)),C=[];i.onsuccess=_=>{const T=_.target.result;if(T)C.push(T.primaryKey),T.continue();else{const f=C.map(D=>new Promise(($,B)=>{const W=p.delete(D);W.onsuccess=()=>$(),W.onerror=()=>B()}));Promise.all(f).then(()=>c()).catch(o)}},i.onerror=()=>o(new Error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥"))})}catch(r){throw console.error("åˆ é™¤äº¤æ˜“è®°å½•å¤±è´¥:",r),r}}async function be(e,r){const s=await Me(e),p=new Set(s.map(a=>a.id).filter(a=>a!==void 0));for(const a of s)a.id&&(r.some(o=>{if(o.id===a.id)return!0;const i=o.time===a.time,C=Math.abs(o.quantity-a.quantity)<1e-4,_=Math.abs(o.price-a.price)<1e-4;return i&&C&&_})||await Ce(a.id));for(const a of r){const c={code:e,time:a.time,quantity:a.quantity,price:a.price,totalAmount:a.totalAmount};if(a.id&&p.has(a.id))await Se(a.id,c);else{let o;for(const i of s)if(i.id){const C=i.time===a.time,_=Math.abs(i.quantity-a.quantity)<1e-4,T=Math.abs(i.price-a.price)<1e-4;if(C&&_&&T){o=i.id;break}}if(o){const i=s.find(C=>C.id===o);i&&(i.time!==c.time||Math.abs(i.quantity-c.quantity)>=1e-4||Math.abs(i.price-c.price)>=1e-4)&&await Se(o,c)}else await Te(c,`saveHoldingsTransactions-${e}`)}}}async function Cn(e){return(await Me(e)).map(s=>({id:s.id,time:s.time,quantity:s.quantity,price:s.price,totalAmount:s.totalAmount}))}async function Zt(){const e=await ze(),r={};for(const[s,p]of Object.entries(e))r[s]=p.map(a=>({id:a.id,time:a.time,quantity:a.quantity,price:a.price,totalAmount:a.totalAmount}));return r}async function vn(e){await Sn(e)}async function xe(e){try{const p=(await kt()).transaction([te],"readwrite").objectStore(te),a={key:"main",privacy_mode:e.privacy_mode,update_interval:e.update_interval,stock_order:e.stock_order,categories:e.categories,funds:e.funds,market_hours:e.market_hours,holdings:e.holdings,watchlist:e.watchlist};await new Promise((c,o)=>{const i=p.put(a);i.onsuccess=()=>c(),i.onerror=()=>o(new Error("ä¿å­˜é…ç½®å¤±è´¥"))})}catch(r){throw console.error("ä¿å­˜é…ç½®å¤±è´¥:",r),r}}async function Ee(){try{const s=(await kt()).transaction([te],"readonly").objectStore(te);return new Promise((p,a)=>{const c=s.get("main");c.onsuccess=()=>{const o=c.result;p(o?{privacy_mode:o.privacy_mode,update_interval:o.update_interval,stock_order:o.stock_order,categories:o.categories,funds:o.funds,market_hours:o.market_hours,holdings:o.holdings,watchlist:o.watchlist}:null)},c.onerror=()=>a(new Error("åŠ è½½é…ç½®å¤±è´¥"))})}catch(e){return console.error("åŠ è½½é…ç½®å¤±è´¥:",e),null}}async function Ne(e,r){try{const a=(await kt()).transaction([ee],"readwrite").objectStore(ee);await new Promise((c,o)=>{const i=a.put({date:e,data:r});i.onsuccess=()=>c(),i.onerror=()=>o(new Error("ä¿å­˜å†å²æ•°æ®å¤±è´¥"))})}catch(s){throw console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",s),s}}async function Tn(){try{const e=await me(),r=await ze(),s={};for(const[_,T]of Object.entries(r))s[_]=T.map(f=>({id:f.id,code:f.code,time:f.time,quantity:f.quantity,price:f.price,totalAmount:f.totalAmount}));const{loadHoldingsConfig:p}=await qe(async()=>{const{loadHoldingsConfig:_}=await Promise.resolve().then(()=>us);return{loadHoldingsConfig:_}},void 0),a=await p(),i=(await kt()).transaction([ee],"readonly").objectStore(ee),C={};return await new Promise((_,T)=>{const f=i.getAll();f.onsuccess=()=>{f.result.forEach(D=>{C[D.date]=D.data}),_()},f.onerror=()=>T(new Error("åŠ è½½å†å²æ•°æ®å¤±è´¥"))}),{watchlist:e,transactions:s,config:a,history:C}}catch(e){throw console.error("å¯¼å‡ºæ•°æ®å¤±è´¥:",e),e}}async function Dn(e){try{await Pe();for(const[r,s]of Object.entries(e.watchlist||{}))await ne(s);for(const[r,s]of Object.entries(e.transactions||{}))if(Array.isArray(s)&&s.length>0)for(const p of s){const{id:a,...c}=p,o={code:r,time:c.time,quantity:c.quantity,price:c.price,totalAmount:c.totalAmount};await Te(o,`import-${r}`)}e.config&&await xe(e.config);for(const[r,s]of Object.entries(e.history||{}))await Ne(r,s)}catch(r){throw console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",r),r}}const ds=Object.freeze(Object.defineProperty({__proto__:null,addTransaction:Te,clearAllData:Pe,deleteHoldingsTransactions:vn,deleteTransaction:Ce,deleteTransactionsByCode:Sn,deleteWatchlistItem:_n,exportAllData:Tn,importAllData:Dn,loadAllHoldingsTransactions:Zt,loadAllTransactions:ze,loadAllWatchlistItems:me,loadConfig:Ee,loadHoldingsTransactions:Cn,loadTransactionsByCode:Me,loadWatchlistItem:jn,saveConfig:xe,saveHistoryData:Ne,saveHoldingsTransactions:be,saveWatchlistItem:ne,updateTransaction:Se},Symbol.toStringTag,{value:"Module"}));function We(){return ls}async function Oe(){let e=await Ee(),r;if(e)if(r={privacy_mode:e.privacy_mode??!1,update_interval:e.update_interval??1e3,stock_order:e.stock_order,categories:e.categories,funds:e.funds||{available_funds:0,total_original_funds:0},market_hours:e.market_hours||{},holdings:{},watchlist:{},historical_holdings:[]},r.categories){for(const[o,i]of Object.entries(r.categories))o==="è‡ªé€‰"&&!i.isDefault&&(r.categories[o]={...i,isDefault:!0});r.categories.æŒä»“?r.categories.æŒä»“.isHoldings||(r.categories.æŒä»“={...r.categories.æŒä»“,isHoldings:!0}):r.categories.æŒä»“={codes:[],title:"æŒä»“",color:"#2e7d32",isHoldings:!0}}else r.categories={è‡ªé€‰:{codes:[],title:"è‡ªé€‰",color:"#1976d2",isDefault:!0},æŒä»“:{codes:[],title:"æŒä»“",color:"#2e7d32",isHoldings:!0}};else console.log("IndexedDB ä¸­æ²¡æœ‰é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®åˆå§‹åŒ–"),r=We(),r.update_interval||(r.update_interval=1e3),await xe(r);const s=await me(),p=await Zt();r.holdings={},r.watchlist={};const a=new Date,c=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`;for(const[o,i]of Object.entries(s)){const C=p[o]||[],_=Array.isArray(C)?C:[],T=i.add_time||c;let f;i.alert_up!==null&&i.alert_up!==void 0&&(f=f||[],f.push({type:"up",price:i.alert_up})),i.alert_down!==null&&i.alert_down!==void 0&&(f=f||[],f.push({type:"down",price:i.alert_down})),_.length>0?r.holdings[o]={transactions:_,alerts:f&&f.length>0?f:void 0,alert_up:i.alert_up,alert_down:i.alert_down}:r.watchlist[o]={alerts:f&&f.length>0?f:void 0,add_time:T,alert_up:i.alert_up,alert_down:i.alert_down},i.add_time||await ne({...i,add_time:c})}return r.historical_holdings=[],r}async function Fe(){const e=await Ee();let r;e?r={privacy_mode:e.privacy_mode??!1,update_interval:e.update_interval??1e3,funds:e.funds||{available_funds:0,total_original_funds:0},market_hours:e.market_hours||{},holdings:e.holdings||{},watchlist:e.watchlist||{},historical_holdings:[]}:r=We();const s=await me(),p=await Zt();r.holdings={},r.watchlist={};const a=new Date,c=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`;for(const[o,i]of Object.entries(s)){const C=p[o]||[],_=Array.isArray(C)?C:[],T=i.add_time||c;let f;i.alert_up!==null&&i.alert_up!==void 0&&(f=f||[],f.push({type:"up",price:i.alert_up})),i.alert_down!==null&&i.alert_down!==void 0&&(f=f||[],f.push({type:"down",price:i.alert_down})),_.length>0?r.holdings[o]={transactions:_,alerts:f&&f.length>0?f:void 0,alert_up:i.alert_up,alert_down:i.alert_down}:r.watchlist[o]={alerts:f&&f.length>0?f:void 0,add_time:T,alert_up:i.alert_up,alert_down:i.alert_down},i.add_time||await ne({...i,add_time:c})}return r.historical_holdings=[],r}async function ve(e){try{const r=new Set;Object.keys(e.holdings||{}).forEach(o=>r.add(o)),Object.keys(e.watchlist||{}).forEach(o=>r.add(o));for(const o of r){const i=e.holdings[o],C=e.watchlist[o];if(i){const _=await jn(o);let T=(_==null?void 0:_.add_time)||new Date().toISOString().replace("T"," ").substring(0,19);if(i.transactions&&i.transactions.length>0){const $=i.transactions.map(B=>B.time).filter(B=>B);if($.length>0){const B=$.map(nt=>new Date(nt.replace(" ","T"))),W=new Date(Math.min(...B.map(nt=>nt.getTime()))),gt=new Date(T.replace(" ","T"));if(W<gt){const nt=W.getFullYear(),Y=String(W.getMonth()+1).padStart(2,"0"),L=String(W.getDate()).padStart(2,"0"),at=String(W.getHours()).padStart(2,"0"),Z=String(W.getMinutes()).padStart(2,"0"),ot=String(W.getSeconds()).padStart(2,"0");T=`${nt}-${Y}-${L} ${at}:${Z}:${ot}`}}}let f=i.alert_up??null,D=i.alert_down??null;if(i.alerts&&i.alerts.length>0){const $=i.alerts.find(W=>W.type==="up"),B=i.alerts.find(W=>W.type==="down");f=$?$.price:null,D=B?B.price:null}if(await ne({code:o,name:o,alert_up:f,alert_down:D,add_time:T}),i.transactions&&i.transactions.length>0)if(i.transactions.every(B=>B.id!==void 0))await be(o,i.transactions);else{const B=await Cn(o);B.length===i.transactions.length?await be(o,B):await be(o,i.transactions)}else await vn(o)}else if(C){let _=C.alert_up??null,T=C.alert_down??null;if(C.alerts&&C.alerts.length>0){const f=C.alerts.find($=>$.type==="up"),D=C.alerts.find($=>$.type==="down");_=f?f.price:null,T=D?D.price:null}await ne({code:o,name:o,alert_up:_,alert_down:T,add_time:C.add_time})}}const s=await me(),p=await Zt();for(const o of Object.keys(s))r.has(o)||(!p[o]||p[o].length===0)&&await _n(o);await xe(e);const a=await Zt(),c={...e};for(const o of Object.keys(c.holdings||{}))a[o]&&a[o].length>0&&(c.holdings[o]={...c.holdings[o],transactions:a[o]});return c}catch(r){return console.error("ä¿å­˜é…ç½®å¤±è´¥:",r),e}return e}async function An(e,r){try{await Ne(e,r)}catch(s){console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",s)}}function $n(){return new Date().toISOString().split("T")[0]}async function kn(){try{await Pe();const e=We(),r=new Date,s=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}:${String(r.getSeconds()).padStart(2,"0")}`;for(const[a,c]of Object.entries(e.watchlist||{}))await ne({code:a,name:a,alert_up:c.alert_up,alert_down:c.alert_down,add_time:c.add_time||s});for(const[a,c]of Object.entries(e.holdings||{}))if(await ne({code:a,name:a,alert_up:c.alert_up,alert_down:c.alert_down,add_time:s}),c.transactions&&c.transactions.length>0)for(const o of c.transactions)await Te({code:a,time:o.time,quantity:o.quantity,price:o.price},`resetToDefaultConfig-${a}`);const p={...e,holdings:{},watchlist:{}};return await xe(p),{...e,holdings:{},watchlist:{}}}catch(e){throw console.error("é‡ç½®æ•°æ®å¤±è´¥:",e),e}}const us=Object.freeze(Object.defineProperty({__proto__:null,getTodayDate:$n,initializeConfig:Oe,loadHoldingsConfig:Fe,resetToDefaultConfig:kn,saveHistoryData:An,saveHoldingsConfig:ve},Symbol.toStringTag,{value:"Module"})),hs=({config:e,onConfigUpdate:r,onStockAdded:s,stockStates:p,onOpenTransactionDialog:a,onOpenAllTransactionsDialog:c,onToggleCategorySidebar:o})=>{const[i,C]=m.useState({});m.useEffect(()=>{(async()=>{const g=await Zt();C(g)})()},[e]);const[_,T]=m.useState(!1),[f,D]=m.useState(""),[$,B]=m.useState(!1),[W,gt]=m.useState(""),[nt,Y]=m.useState(!1),[L,at]=m.useState(""),[Z,ot]=m.useState(""),[Q,it]=m.useState(""),[Mt,Et]=m.useState("100"),[Ot,b]=m.useState(""),[v,A]=m.useState(!1),[V,j]=m.useState(""),[q,S]=m.useState(!1),[G,dt]=m.useState(!1),[I,st]=m.useState(""),[Ft,rt]=m.useState("add"),[bt,zt]=m.useState(!1),[M,yt]=m.useState(""),[lt,Vt]=m.useState("add"),[Rt,xt]=m.useState(!1),[vt,Pt]=m.useState(null),[Bt,jt]=m.useState(null),[mt,Kt]=m.useState({time:"",quantity:"",totalAmount:""}),[de,Qt]=m.useState(""),[ue,Yt]=m.useState(""),[he,Lt]=m.useState(""),[fe,Ut]=m.useState(""),[se,ie]=m.useState("gt"),[pe,re]=m.useState(""),ye=()=>{T(!0),D(""),gt("")},n=()=>{T(!1),D(""),gt("")},u=async()=>{if(!f.trim()){gt("è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ");return}const l=f.trim().toUpperCase();if(e.holdings[l]||e.watchlist[l]){gt("è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰æˆ–æŒä»“ä¸­");return}B(!0),gt("");try{if(!await rn(l)){gt("æ— æ³•è·å–è‚¡ç¥¨ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®"),B(!1);return}const x=new Date,K=x.getFullYear(),H=String(x.getMonth()+1).padStart(2,"0"),y=String(x.getDate()).padStart(2,"0"),P=String(x.getHours()).padStart(2,"0"),z=String(x.getMinutes()).padStart(2,"0"),U=String(x.getSeconds()).padStart(2,"0"),_t=`${K}-${H}-${y} ${P}:${z}:${U}`,ht=e.stock_order||[],qt=ht.includes(l)?ht:[...ht,l],Nt={...e.categories||{}};let Ht="è‡ªé€‰";for(const[De,On]of Object.entries(Nt))if(On.isDefault===!0){Ht=De;break}Nt[Ht]||(Nt[Ht]={codes:[],title:Ht,color:"#1976d2",isDefault:!0});const ft=Nt[Ht];ft&&!ft.codes.includes(l)&&(Nt[Ht]={...ft,codes:[...ft.codes,l]});const le={...e,stock_order:qt,categories:Nt,watchlist:{...e.watchlist,[l]:{alert_up:null,alert_down:null,add_time:_t,categories:["è‡ªé€‰"]}}};await r(le),s&&s(l),n()}catch(g){gt(g.message||"æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®")}finally{B(!1)}};m.useEffect(()=>{if(nt&&!Q){const l=new Date,g=l.getFullYear(),x=String(l.getMonth()+1).padStart(2,"0"),K=String(l.getDate()).padStart(2,"0"),H=String(l.getHours()).padStart(2,"0"),y=String(l.getMinutes()).padStart(2,"0"),P=String(l.getSeconds()).padStart(2,"0");it(`${g}-${x}-${K} ${H}:${y}:${P}`)}},[nt,Q]);const d=m.useMemo(()=>{const l=parseFloat(Mt),g=parseFloat(Ot);return isNaN(l)||l===0||isNaN(g)||g<=0?null:g/Math.abs(l)},[Mt,Ot]),h=()=>{const l=new Set;return Object.keys(e.holdings||{}).forEach(g=>l.add(g)),Object.keys(e.watchlist||{}).forEach(g=>l.add(g)),Array.from(l).sort()},w=m.useCallback(l=>{Y(!0),l?(at(l),ot(""),S(!0)):(at(""),ot(""),S(!1)),it(""),Et("100"),j("")},[p]);m.useEffect(()=>(a&&a(w),window.__openTransactionDialog=w,()=>{window.__openTransactionDialog&&delete window.__openTransactionDialog}),[w,a]);const k=m.useCallback(l=>{xt(!0),l?(Qt(l),Yt("")):(Qt(""),Yt("")),Lt(""),Ut(""),ie("gt"),re("")},[]);m.useEffect(()=>{c&&c(k)},[k,c]);const R=()=>{Y(!1),at(""),ot(""),it(""),Et("100"),b(""),j(""),S(!1)},tt=()=>{xt(!1),Qt(""),Yt(""),Lt(""),Ut(""),ie("gt"),re("")},ut=async()=>{const l=L||Z.trim().toUpperCase();if(!l){j("è¯·é€‰æ‹©æˆ–è¾“å…¥è‚¡ç¥¨ä»£ç ");return}A(!0),j("");try{if(L&&h().includes(L)){S(!0),A(!1);return}if(e.holdings[l]||e.watchlist[l]){j("è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰æˆ–æŒä»“ä¸­ï¼Œè¯·ä»ä¸‹æ‹‰æ¡†é€‰æ‹©"),A(!1);return}if(!await rn(l)){j("æ— æ³•è·å–è‚¡ç¥¨ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®"),A(!1);return}const x={...e,watchlist:{...e.watchlist,[l]:{alert_up:null,alert_down:null,add_time:new Date().toISOString().replace("T"," ").substring(0,19)}}};await r(x),s&&s(l),at(l),ot(""),S(!0)}catch(g){j(g.message||"éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®")}finally{A(!1)}},X=()=>{const l=L||Z.trim().toUpperCase();if(!l){j("è¯·é€‰æ‹©æˆ–è¾“å…¥è‚¡ç¥¨ä»£ç ");return}if(!q){j("è¯·å…ˆéªŒè¯è‚¡ç¥¨ä»£ç ");return}if(!Q){j("è¯·è¾“å…¥äº¤æ˜“æ—¶é—´");return}const g=parseFloat(Mt);if(isNaN(g)||g===0){j("è¯·è¾“å…¥æœ‰æ•ˆçš„äº¤æ˜“æ•°é‡ï¼ˆä¸èƒ½ä¸º0ï¼‰");return}const x=parseFloat(Ot);if(isNaN(x)||x<=0){j("è¯·è¾“å…¥æœ‰æ•ˆçš„æ€»é‡‘é¢");return}const K=x/Math.abs(g),H=e.holdings[l]||{transactions:[],alert_up:null,alert_down:null},y=Array.isArray(H.transactions)?H.transactions:[];if(g<0){let ft=0;for(const De of y)ft+=Number(De.quantity)||0;if(ft+g<0){j(`æŒä»“ä¸è¶³ï¼Œå½“å‰æŒä»“ï¼š${ft.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(g).toFixed(0)}`);return}}const P={time:Q,quantity:g,price:K,totalAmount:x},z=g>0?e.funds.available_funds-x:e.funds.available_funds+x,U=e.stock_order||[],_t=U.includes(l)?U:[...U,l],ht={...e.categories||{}};let qt="è‡ªé€‰";for(const[ft,le]of Object.entries(ht))if(le.isDefault===!0){qt=ft;break}ht[qt]||(ht[qt]={codes:[],title:qt,color:"#1976d2",isDefault:!0});let Nt=!1;for(const ft of Object.values(ht))if(ft&&ft.codes&&ft.codes.includes(l)){Nt=!0;break}if(!Nt){const ft=ht[qt];ht[qt]={...ft,codes:[...ft.codes,l]}}const Ht={...e,stock_order:_t,categories:ht,funds:{...e.funds,available_funds:Math.max(0,z)},holdings:{...e.holdings,[l]:{...H,transactions:[...y,P]}}};if(e.watchlist[l]){const{[l]:ft,...le}=e.watchlist;Ht.watchlist=le}r(Ht).then(()=>{R()}).catch(ft=>{console.error("ä¿å­˜äº¤æ˜“å¤±è´¥:",ft),j("ä¿å­˜äº¤æ˜“å¤±è´¥ï¼Œè¯·é‡è¯•")})},et=()=>{dt(!0),st(""),rt("add")},wt=()=>{dt(!1),st(""),rt("add")},O=()=>{const l=parseFloat(I);if(isNaN(l)||l<=0)return;let g=e.funds.total_original_funds,x=e.funds.available_funds;Ft==="add"?(g+=l,x+=l):(g=Math.max(0,g-l),x=Math.max(0,x-l));const K={...e,funds:{...e.funds,total_original_funds:g,available_funds:x}};r(K).then(()=>{wt()})},$t=()=>{zt(!0),yt(""),Vt("add")},It=()=>{zt(!1),yt(""),Vt("add")},oe=()=>{const l=parseFloat(M);if(isNaN(l)||l<=0)return;let g=e.funds.available_funds;lt==="add"?g+=l:g=Math.max(0,g-l);const x={...e,funds:{...e.funds,available_funds:g}};r(x).then(()=>{It()})};return t.jsxs(t.Fragment,{children:[t.jsxs(N,{sx:{mb:.5,display:"flex",justifyContent:"space-between",alignItems:"center",gap:.5},children:[t.jsxs(N,{sx:{display:"flex",gap:.5},children:[t.jsx(F,{variant:"outlined",color:"secondary",size:"small",startIcon:t.jsx(Ke,{}),onClick:et,children:"å¢å‡æœ¬é‡‘"}),t.jsx(F,{variant:"outlined",color:"secondary",size:"small",startIcon:t.jsx(Ke,{}),onClick:$t,children:"å¢å‡å¯ç”¨èµ„é‡‘"})]}),t.jsxs(N,{sx:{display:"flex",gap:.5},children:[t.jsx(F,{variant:"contained",size:"small",startIcon:t.jsx(we,{}),onClick:ye,children:"è‡ªé€‰"}),t.jsx(F,{variant:"contained",color:"secondary",size:"small",startIcon:t.jsx(we,{}),onClick:()=>w(),children:"äº¤æ˜“"}),t.jsx(F,{variant:"outlined",size:"small",startIcon:t.jsx(En,{}),onClick:()=>xt(!0),children:"äº¤æ˜“åˆ—è¡¨"}),t.jsx(F,{variant:"outlined",size:"small",onClick:()=>{window.__toggleCategorySidebar&&window.__toggleCategorySidebar()},children:"è‡ªé€‰åˆ†ç»„"})]})]}),t.jsxs(St,{open:_,onClose:n,maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"æ·»åŠ è‡ªé€‰è‚¡"}),t.jsx(Ct,{sx:{pt:.5},children:t.jsx(pt,{autoFocus:!0,size:"small",label:"è‚¡ç¥¨ä»£ç ",fullWidth:!0,variant:"outlined",value:f,onChange:l=>{D(l.target.value),gt("")},placeholder:"ä¾‹å¦‚ï¼š600228",error:!!W,helperText:W||"è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ",disabled:$,onKeyPress:l=>{l.key==="Enter"&&!$&&u()}})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:n,disabled:$,children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:u,variant:"contained",disabled:$,children:$?"éªŒè¯ä¸­...":"æ·»åŠ "})]})]}),t.jsxs(St,{open:nt,onClose:R,maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{children:"æ·»åŠ äº¤æ˜“è®°å½•"}),t.jsx(Ct,{children:t.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[t.jsxs(Jt,{fullWidth:!0,size:"small",children:[t.jsx(ge,{children:"è‚¡ç¥¨ä»£ç "}),t.jsx(ae,{value:L,label:"è‚¡ç¥¨ä»£ç ",onChange:l=>{const g=l.target.value;at(g),ot(""),j(""),g&&h().includes(g)?S(!0):S(!1)},disabled:v,children:h().map(l=>{var g,x;return t.jsxs(ct,{value:l,children:[l," ",(g=p==null?void 0:p.get(l))!=null&&g.name?`(${(x=p.get(l))==null?void 0:x.name})`:""]},l)})})]}),t.jsx(pt,{label:"æˆ–è¾“å…¥æ–°ä»£ç ",size:"small",fullWidth:!0,variant:"outlined",value:Z,onChange:l=>{ot(l.target.value),at(""),j(""),S(!1)},placeholder:"ä¾‹å¦‚ï¼š600228",disabled:v||!!L,helperText:L?"å·²é€‰æ‹©":"è¾“å…¥åéœ€éªŒè¯"}),!q&&Z&&t.jsx(F,{variant:"outlined",onClick:ut,disabled:v,fullWidth:!0,children:v?"éªŒè¯ä¸­...":"éªŒè¯è‚¡ç¥¨ä»£ç "}),V&&t.jsx(N,{sx:{color:"error.main",fontSize:"0.875rem"},children:V}),q&&t.jsxs(t.Fragment,{children:[t.jsx(pt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",fullWidth:!0,variant:"outlined",value:Q?(()=>{try{const l=new Date(Q),g=l.getFullYear(),x=String(l.getMonth()+1).padStart(2,"0"),K=String(l.getDate()).padStart(2,"0"),H=String(l.getHours()).padStart(2,"0"),y=String(l.getMinutes()).padStart(2,"0");return`${g}-${x}-${K}T${H}:${y}`}catch{return""}})():"",onChange:l=>{const g=l.target.value;if(g){const x=new Date(g),K=x.getFullYear(),H=String(x.getMonth()+1).padStart(2,"0"),y=String(x.getDate()).padStart(2,"0"),P=String(x.getHours()).padStart(2,"0"),z=String(x.getMinutes()).padStart(2,"0"),U=String(x.getSeconds()).padStart(2,"0");it(`${K}-${H}-${y} ${P}:${z}:${U}`)}},InputLabelProps:{shrink:!0}}),t.jsx(pt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",fullWidth:!0,variant:"outlined",value:Mt,onChange:l=>{const g=l.target.value;(g===""||g==="-"||/^-?\d*\.?\d*$/.test(g))&&Et(g)},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡ºï¼ˆå¦‚ï¼š-100è¡¨ç¤ºå–å‡º100è‚¡ï¼‰"}),t.jsx(pt,{label:"æ€»é‡‘é¢",type:"number",fullWidth:!0,required:!0,variant:"outlined",value:Ot,onChange:l=>b(l.target.value),inputProps:{min:0,step:.01},helperText:"ç”±äºåˆ¸å•†è®¡ç®—è§„åˆ™å¤æ‚ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ï¼ˆåŒ…å«æ‰€æœ‰è´¹ç”¨ï¼‰"}),d!==null&&t.jsx(pt,{label:"å•ä»·ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰",type:"number",fullWidth:!0,variant:"outlined",value:d.toFixed(3),InputProps:{readOnly:!0},helperText:`æ€»é‡‘é¢ Ã· |æ•°é‡| = ${d.toFixed(3)}`})]})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:R,disabled:v,children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:X,variant:"contained",disabled:v||!q,children:"æäº¤"})]})]}),t.jsxs(St,{open:G,onClose:wt,maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"å¢å‡æœ¬é‡‘"}),t.jsx(Ct,{sx:{pt:.5},children:t.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsxs(Jt,{fullWidth:!0,children:[t.jsx(ge,{children:"æ“ä½œç±»å‹"}),t.jsxs(ae,{value:Ft,label:"æ“ä½œç±»å‹",onChange:l=>rt(l.target.value),children:[t.jsx(ct,{value:"add",children:"å¢åŠ æœ¬é‡‘"}),t.jsx(ct,{value:"subtract",children:"å‡å°‘æœ¬é‡‘"})]})]}),t.jsx(pt,{label:"é‡‘é¢",type:"number",fullWidth:!0,variant:"outlined",value:I,onChange:l=>st(l.target.value),inputProps:{min:0,step:.01},helperText:Ft==="add"?"å¢åŠ æœ¬é‡‘æ—¶ï¼Œå¯ç”¨èµ„é‡‘ä¹Ÿä¼šåŒæ­¥å¢åŠ ":"å‡å°‘æœ¬é‡‘æ—¶ï¼Œå¯ç”¨èµ„é‡‘ä¹Ÿä¼šåŒæ­¥å‡å°‘"}),Ft==="subtract"&&t.jsx(N,{sx:{p:.5,backgroundColor:"#fff3cd",borderRadius:0},children:t.jsxs(J,{variant:"body2",sx:{color:"#856404",fontSize:"0.75rem"},children:["å½“å‰æœ¬é‡‘ï¼š",e.funds.total_original_funds.toFixed(2)," | å¯ç”¨ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å‡å°‘åæœ¬é‡‘ï¼š",Math.max(0,e.funds.total_original_funds-(parseFloat(I)||0)).toFixed(2)," | å¯ç”¨ï¼š",Math.max(0,e.funds.available_funds-(parseFloat(I)||0)).toFixed(2)]})}),Ft==="add"&&t.jsx(N,{sx:{p:.5,backgroundColor:"#d1ecf1",borderRadius:0},children:t.jsxs(J,{variant:"body2",sx:{color:"#0c5460",fontSize:"0.75rem"},children:["å½“å‰æœ¬é‡‘ï¼š",e.funds.total_original_funds.toFixed(2)," | å¯ç”¨ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å¢åŠ åæœ¬é‡‘ï¼š",(e.funds.total_original_funds+(parseFloat(I)||0)).toFixed(2)," | å¯ç”¨ï¼š",(e.funds.available_funds+(parseFloat(I)||0)).toFixed(2)]})})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:wt,children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:O,variant:"contained",disabled:!I||parseFloat(I)<=0,children:"ç¡®è®¤"})]})]}),t.jsxs(St,{open:bt,onClose:It,maxWidth:"xs",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"å¢å‡å¯ç”¨èµ„é‡‘"}),t.jsx(Ct,{sx:{pt:.5},children:t.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsxs(Jt,{fullWidth:!0,size:"small",children:[t.jsx(ge,{children:"æ“ä½œç±»å‹"}),t.jsxs(ae,{value:lt,label:"æ“ä½œç±»å‹",onChange:l=>Vt(l.target.value),children:[t.jsx(ct,{value:"add",children:"å¢åŠ å¯ç”¨èµ„é‡‘"}),t.jsx(ct,{value:"subtract",children:"å‡å°‘å¯ç”¨èµ„é‡‘"})]})]}),t.jsx(pt,{size:"small",label:"é‡‘é¢",type:"number",fullWidth:!0,variant:"outlined",value:M,onChange:l=>yt(l.target.value),inputProps:{min:0,step:.01},helperText:lt==="add"?"å¢åŠ å¯ç”¨èµ„é‡‘ï¼ˆä¸å½±å“æœ¬é‡‘ï¼‰":"å‡å°‘å¯ç”¨èµ„é‡‘ï¼ˆä¸å½±å“æœ¬é‡‘ï¼‰"}),lt==="subtract"&&t.jsx(N,{sx:{p:.5,backgroundColor:"#fff3cd",borderRadius:0},children:t.jsxs(J,{variant:"body2",sx:{color:"#856404",fontSize:"0.75rem"},children:["å½“å‰å¯ç”¨èµ„é‡‘ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å‡å°‘åå¯ç”¨èµ„é‡‘ï¼š",Math.max(0,e.funds.available_funds-(parseFloat(M)||0)).toFixed(2)]})}),lt==="add"&&t.jsx(N,{sx:{p:.5,backgroundColor:"#d1ecf1",borderRadius:0},children:t.jsxs(J,{variant:"body2",sx:{color:"#0c5460",fontSize:"0.75rem"},children:["å½“å‰å¯ç”¨èµ„é‡‘ï¼š",e.funds.available_funds.toFixed(2),t.jsx("br",{}),"å¢åŠ åå¯ç”¨èµ„é‡‘ï¼š",(e.funds.available_funds+(parseFloat(M)||0)).toFixed(2)]})})]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:It,children:"å–æ¶ˆ"}),t.jsx(F,{size:"small",onClick:oe,variant:"contained",disabled:!M||parseFloat(M)<=0,children:"ç¡®è®¤"})]})]}),t.jsxs(St,{open:Rt,onClose:tt,maxWidth:"lg",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:t.jsxs(N,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(J,{variant:"h6",children:"æ‰€æœ‰äº¤æ˜“è®°å½•"}),t.jsx(F,{variant:"contained",color:"secondary",startIcon:t.jsx(we,{}),onClick:()=>{xt(!1);const l=de||ue.trim().toUpperCase()||void 0;w(l)},size:"small",children:"äº¤æ˜“"})]})}),t.jsxs(Ct,{sx:{pt:.5},children:[t.jsx(N,{sx:{mt:.5,mb:.5,p:.5,border:"1px solid #e0e0e0",borderRadius:0},children:t.jsxs(N,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs(Jt,{size:"small",sx:{minWidth:100},children:[t.jsx(ge,{children:"è‚¡ç¥¨"}),t.jsxs(ae,{value:de,label:"è‚¡ç¥¨",onChange:l=>{Qt(l.target.value),Yt("")},children:[t.jsx(ct,{value:"",children:"å…¨éƒ¨"}),h().map(l=>{var g,x;return t.jsxs(ct,{value:l,children:[l," ",(g=p==null?void 0:p.get(l))!=null&&g.name?`(${(x=p.get(l))==null?void 0:x.name})`:""]},l)})]})]}),t.jsx(J,{variant:"body2",sx:{mx:.5},children:"æˆ–"}),t.jsx(pt,{label:"ä»£ç ",size:"small",value:ue,onChange:l=>{Yt(l.target.value.toUpperCase()),Qt("")},placeholder:"ä»£ç ",sx:{width:100}}),t.jsx(pt,{label:"å¼€å§‹æ—¥æœŸ",type:"date",size:"small",value:he,onChange:l=>Lt(l.target.value),InputLabelProps:{shrink:!0},sx:{width:150}}),t.jsx(J,{variant:"body2",sx:{mx:.5},children:"è‡³"}),t.jsx(pt,{label:"ç»“æŸæ—¥æœŸ",type:"date",size:"small",value:fe,onChange:l=>Ut(l.target.value),InputLabelProps:{shrink:!0},sx:{width:150}}),t.jsxs(Jt,{size:"small",sx:{minWidth:80},children:[t.jsx(ge,{children:"é‡‘é¢"}),t.jsxs(ae,{value:se,label:"é‡‘é¢",onChange:l=>ie(l.target.value),children:[t.jsx(ct,{value:"gt",children:"å¤§äº"}),t.jsx(ct,{value:"eq",children:"ç­‰äº"}),t.jsx(ct,{value:"lt",children:"å°äº"})]})]}),t.jsx(pt,{label:"é‡‘é¢",type:"number",size:"small",value:pe,onChange:l=>re(l.target.value),placeholder:"é‡‘é¢",sx:{width:120}}),t.jsx(F,{variant:"outlined",size:"small",onClick:()=>{Qt(""),Yt(""),Lt(""),Ut(""),ie("gt"),re("")},children:"æ¸…é™¤"})]})}),(()=>{var H;const l=[];Object.entries(e.holdings||{}).forEach(([y,P])=>{var _t;const z=Array.isArray(P.transactions)?P.transactions:[],U=((_t=p==null?void 0:p.get(y))==null?void 0:_t.name)||y;z.forEach((ht,qt)=>{l.push({code:y,name:U,transaction:ht,isHistorical:!1,transactionIndex:qt})})});const g=new Set(Object.keys(e.holdings||{}));for(const[y,P]of Object.entries(e.watchlist||{}))if(!g.has(y)){const z=i[y]||[],U=Array.isArray(z)?z:[];if(U.length>0){const _t=((H=p==null?void 0:p.get(y))==null?void 0:H.name)||y;U.forEach((ht,qt)=>{l.push({code:y,name:_t,transaction:ht,isHistorical:!0,transactionIndex:qt})})}}let x=l;const K=de||ue.trim().toUpperCase();if(K&&(x=x.filter(y=>y.code===K)),he){const y=new Date(he);y.setHours(0,0,0,0);const P=y.getTime();x=x.filter(z=>{const U=new Date(z.transaction.time);return U.setHours(0,0,0,0),U.getTime()>=P})}if(fe){const y=new Date(fe);y.setHours(23,59,59,999);const P=y.getTime();x=x.filter(z=>new Date(z.transaction.time).getTime()<=P)}if(pe){const y=parseFloat(pe);isNaN(y)||(x=x.filter(P=>{const z=P.transaction.quantity*P.transaction.price;return se==="gt"?z>y:se==="eq"?Math.abs(z-y)<.01:se==="lt"?z<y:!0}))}return x.sort((y,P)=>{const z=new Date(y.transaction.time).getTime();return new Date(P.transaction.time).getTime()-z}),x.length>0?t.jsx(un,{component:Ie,sx:{mt:2},children:t.jsxs(hn,{size:"small",children:[t.jsx(fn,{children:t.jsxs(je,{children:[t.jsx(E,{children:"ID"}),t.jsx(E,{children:"è‚¡ç¥¨ä»£ç "}),t.jsx(E,{children:"è‚¡ç¥¨åç§°"}),t.jsx(E,{children:"çŠ¶æ€"}),t.jsx(E,{children:"äº¤æ˜“æ—¶é—´"}),t.jsx(E,{children:"ç±»å‹"}),t.jsx(E,{children:"æ•°é‡ï¼ˆè‚¡ï¼‰"}),t.jsx(E,{children:"å•ä»·"}),t.jsx(E,{children:"æ€»é‡‘é¢"}),t.jsx(E,{align:"right",children:"æ“ä½œ"})]})}),t.jsx(pn,{children:x.map((y,P)=>{const z=y.transaction.quantity>0,U=y.transaction.totalAmount??Math.abs(y.transaction.quantity)*y.transaction.price;return t.jsxs(je,{children:[t.jsx(E,{children:y.transaction.id||"--"}),t.jsx(E,{children:y.code}),t.jsx(E,{children:y.name}),t.jsx(E,{children:y.isHistorical?t.jsx(Gt,{label:"å·²åˆ é™¤è‡ªé€‰",size:"small",color:"default"}):t.jsx(Gt,{label:"å½“å‰æŒä»“",size:"small",color:"primary"})}),t.jsx(E,{children:y.transaction.time}),t.jsx(E,{children:t.jsx(Gt,{label:z?"ä¹°å…¥":"å–å‡º",size:"small",color:z?"primary":"secondary"})}),t.jsx(E,{children:Math.floor(Math.abs(y.transaction.quantity)).toLocaleString()}),t.jsx(E,{children:ke(y.transaction.price)}),t.jsx(E,{children:U.toFixed(2)}),t.jsxs(E,{align:"right",children:[t.jsx(ce,{size:"small",onClick:()=>{const _t=y.transaction.totalAmount??Math.abs(y.transaction.quantity)*y.transaction.price;Pt({code:y.code,isHistorical:y.isHistorical,transactionIndex:y.transactionIndex,transaction:y.transaction}),Kt({time:y.transaction.time,quantity:y.transaction.quantity.toString(),totalAmount:_t.toString()})},sx:{color:"#1976d2"},children:t.jsx(Nn,{fontSize:"small"})}),t.jsx(ce,{size:"small",onClick:()=>jt({code:y.code,isHistorical:y.isHistorical,transactionIndex:y.transactionIndex}),sx:{color:"error.main"},children:t.jsx(Wn,{fontSize:"small"})})]})]},`${y.isHistorical?"historical":"current"}-${y.code}-${y.transactionIndex}-${P}`)})})]})}):t.jsx(J,{sx:{mt:2,textAlign:"center",color:"text.secondary"},children:l.length>0?"æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„äº¤æ˜“è®°å½•":"æš‚æ— äº¤æ˜“è®°å½•"})})()]}),t.jsx(Dt,{sx:{px:1,pb:.5},children:t.jsx(F,{onClick:tt,children:"å…³é—­"})})]}),t.jsxs(St,{open:!!vt,onClose:()=>Pt(null),maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{sx:{pb:.5},children:"ç¼–è¾‘äº¤æ˜“è®°å½•"}),t.jsx(Ct,{sx:{pt:.5},children:t.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:1.5,mt:.5},children:[t.jsx(pt,{label:"äº¤æ˜“æ—¶é—´",type:"datetime-local",size:"small",fullWidth:!0,variant:"outlined",value:mt.time?(()=>{try{const l=new Date(mt.time),g=l.getFullYear(),x=String(l.getMonth()+1).padStart(2,"0"),K=String(l.getDate()).padStart(2,"0"),H=String(l.getHours()).padStart(2,"0"),y=String(l.getMinutes()).padStart(2,"0");return`${g}-${x}-${K}T${H}:${y}`}catch{return""}})():"",onChange:l=>{const g=l.target.value;if(g){const x=new Date(g),K=x.getFullYear(),H=String(x.getMonth()+1).padStart(2,"0"),y=String(x.getDate()).padStart(2,"0"),P=String(x.getHours()).padStart(2,"0"),z=String(x.getMinutes()).padStart(2,"0"),U=String(x.getSeconds()).padStart(2,"0");Kt({...mt,time:`${K}-${H}-${y} ${P}:${z}:${U}`})}},InputLabelProps:{shrink:!0}}),t.jsx(pt,{label:"æ•°é‡ï¼ˆè‚¡ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:mt.quantity,onChange:l=>{const g=l.target.value;(g===""||g==="-"||/^-?\d*\.?\d*$/.test(g))&&Kt({...mt,quantity:g})},inputProps:{step:1},helperText:"æ­£æ•°ä¸ºä¹°å…¥ï¼Œè´Ÿæ•°ä¸ºå–å‡º"}),t.jsx(pt,{label:"æ€»é‡‘é¢",type:"number",size:"small",fullWidth:!0,required:!0,variant:"outlined",value:mt.totalAmount,onChange:l=>Kt({...mt,totalAmount:l.target.value}),inputProps:{min:0,step:.01},helperText:"ç”±äºåˆ¸å•†è®¡ç®—è§„åˆ™å¤æ‚ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ï¼ˆåŒ…å«æ‰€æœ‰è´¹ç”¨ï¼‰"}),(()=>{const l=parseFloat(mt.quantity),g=parseFloat(mt.totalAmount),x=!isNaN(l)&&l!==0&&!isNaN(g)&&g>0?g/Math.abs(l):null;return x!==null?t.jsx(pt,{label:"å•ä»·ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰",type:"number",size:"small",fullWidth:!0,variant:"outlined",value:x.toFixed(3),InputProps:{readOnly:!0},helperText:`æ€»é‡‘é¢ Ã· |æ•°é‡| = ${x.toFixed(3)}`}):null})()]})}),t.jsxs(Dt,{sx:{px:1,pb:.5},children:[t.jsx(F,{size:"small",onClick:()=>Pt(null),children:"å–æ¶ˆ"}),t.jsx(F,{onClick:async()=>{if(!vt)return;const{code:l,isHistorical:g,transactionIndex:x}=vt,K=parseFloat(mt.quantity),H=parseFloat(mt.totalAmount);if(isNaN(K)||K===0||isNaN(H)||H<=0||!mt.time)return;const y=H/Math.abs(K);if(K<0&&!g){const P=e.holdings[l];if(P){const z=Array.isArray(P.transactions)?P.transactions:[];let U=0;for(let ht=0;ht<z.length;ht++)ht!==x&&(U+=Number(z[ht].quantity)||0);const _t=U+K;if(_t<0){alert(`æŒä»“ä¸è¶³ï¼Œä¿®æ”¹åæŒä»“ï¼š${_t.toFixed(0)}ï¼Œæ— æ³•å–å‡º ${Math.abs(K).toFixed(0)}`);return}}}if(vt.transaction.id,mt.time,g){const z=(i[l]||[])[x];if(z&&z.id){await Se(z.id,{code:l,time:mt.time,quantity:K,price:y,totalAmount:H});const U=await Fe();await r(U),Pt(null),Kt({time:"",quantity:"",totalAmount:""});const _t=await Zt();C(_t)}}else{const P=e.holdings[l];if(P){const z=P.transactions[x],U=z.totalAmount??Math.abs(z.quantity)*z.price,_t=z.quantity>0?-U:U,ht=K>0?-H:H,qt=_t-ht,Nt=[...P.transactions];Nt[x]={id:z.id,time:mt.time,quantity:K,price:y,totalAmount:H};const Ht=e.funds.available_funds+qt,ft={...e,funds:{...e.funds,available_funds:Math.max(0,Ht)},holdings:{...e.holdings,[l]:{...P,transactions:Nt}}};r(ft).then(()=>{Pt(null),Kt({time:"",quantity:"",price:""})})}}},variant:"contained",children:"ä¿å­˜"})]})]}),t.jsxs(St,{open:!!Bt,onClose:()=>jt(null),children:[t.jsx(Tt,{children:"ç¡®è®¤åˆ é™¤"}),t.jsx(Ct,{children:t.jsx(J,{children:"ç¡®å®šè¦åˆ é™¤è¿™æ¡äº¤æ˜“è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"})}),t.jsxs(Dt,{children:[t.jsx(F,{onClick:()=>jt(null),children:"å–æ¶ˆ"}),t.jsx(F,{onClick:async()=>{if(!Bt)return;const{code:l,isHistorical:g,transactionIndex:x}=Bt;if(g){const H=(i[l]||[])[x];if(H&&H.id){await Ce(H.id);const y=await Fe();await r(y),jt(null);const P=await Zt();C(P)}}else{const K=e.holdings[l];if(K){const H=K.transactions[x],y=H.totalAmount??Math.abs(H.quantity)*H.price,P=H.quantity>0?e.funds.available_funds+y:e.funds.available_funds-y;H.id&&await Ce(H.id);const z=[...K.transactions];z.splice(x,1);const U={...e,funds:{...e.funds,available_funds:P},holdings:{...e.holdings,[l]:{...K,transactions:z}}};r(U).then(()=>{jt(null)})}}},size:"small",variant:"contained",color:"error",children:"åˆ é™¤"})]})]})]})},fs=({version:e})=>t.jsxs(N,{component:"footer",sx:{position:"fixed",bottom:0,left:0,right:0,py:1.5,display:"flex",justifyContent:"center",alignItems:"center",gap:2,backgroundColor:"background.paper",zIndex:1e3},children:[t.jsxs(Hn,{href:"https://github.com/respawnlife/respawn-stocks-listen",target:"_blank",rel:"noopener noreferrer",sx:{display:"flex",alignItems:"center",gap:.5,color:"text.secondary",textDecoration:"none","&:hover":{color:"primary.main"}},children:[t.jsx(Rn,{fontSize:"small"}),t.jsx(J,{variant:"body2",sx:{fontSize:"0.75rem"},children:"GitHub"})]}),e&&t.jsxs(J,{variant:"body2",sx:{color:"text.secondary",fontSize:"0.75rem"},children:["ç‰ˆæœ¬: ",e]})]}),ps="260120111813";function gs(e,r){const s=yn(e)?"ç¾è‚¡":"Aè‚¡",p=r[s];if(!(p!=null&&p.enabled))return!0;const a=new Date,c=a.getDay()===0?7:a.getDay();if(!(p.weekdays||[1,2,3,4,5]).includes(c))return!1;const i=a.getHours().toString().padStart(2,"0"),C=a.getMinutes().toString().padStart(2,"0"),_=`${i}:${C}`,T=p.morning;if(T){const D=T.start,$=T.end;if(D>$){if(_>=D||_<=$)return!0}else if(_>=D&&_<=$)return!0}const f=p.afternoon;if(f){const D=f.start,$=f.end;if(_>=D&&_<=$)return!0}return!1}function ms(){const e=new Date;return e.getHours()>15||e.getHours()===15&&e.getMinutes()>=1}function an(e,r,s){const p=[];if(s.alert_triggered||(s.alert_triggered=new Set),s.alerts&&s.alerts.length>0){const a=s.last_price;for(const c of s.alerts){const o=`${c.type}-${c.price}`;let i=!1;c.type==="up"?r>=c.price?(!s.alert_triggered.has(o)||a!==null&&a<c.price)&&(i=!0,s.alert_triggered.add(o)):s.alert_triggered.delete(o):c.type==="down"&&(r<=c.price?(!s.alert_triggered.has(o)||a!==null&&a>c.price)&&(i=!0,s.alert_triggered.add(o)):s.alert_triggered.delete(o)),i&&p.push(c)}}else{const a=s.alert_up,c=s.alert_down,o=s.last_price;if(a!==null&&r>=a){const i=`up-${a}`;(!s.alert_triggered.has(i)||o!==null&&o<a)&&(p.push({type:"up",price:a}),s.alert_triggered.add(i))}else a!==null&&r<a&&s.alert_triggered.delete(`up-${a}`);if(c!==null&&r<=c){const i=`down-${c}`;(!s.alert_triggered.has(i)||o!==null&&o>c)&&(p.push({type:"down",price:c}),s.alert_triggered.add(i))}else c!==null&&r>c&&s.alert_triggered.delete(`down-${c}`)}return p}function ln(){try{const e=new(window.AudioContext||window.webkitAudioContext),r=e.createOscillator(),s=e.createGain();r.connect(s),s.connect(e.destination),r.frequency.value=1e3,r.type="sine",s.gain.setValueAtTime(.3,e.currentTime),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),r.start(e.currentTime),r.stop(e.currentTime+.5)}catch(e){console.error("æ’­æ”¾å£°éŸ³å¤±è´¥:",e),"Notification"in window&&Notification.permission==="granted"&&new Notification("è‚¡ç¥¨æŠ¥è­¦",{body:"ä»·æ ¼è¾¾åˆ°æŠ¥è­¦é˜ˆå€¼",icon:"/favicon.ico"})}}async function cn(e,r){"Notification"in window&&(Notification.permission==="granted"?new Notification(e,{body:r}):Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&new Notification(e,{body:r}))}const dn=Bn({palette:{mode:"light",primary:{main:"#1976d2"}},shape:{borderRadius:0},components:{MuiPaper:{styleOverrides:{root:{borderRadius:0}}},MuiButton:{styleOverrides:{root:{borderRadius:0}}},MuiChip:{styleOverrides:{root:{borderRadius:0}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:0}}}},MuiSelect:{styleOverrides:{root:{borderRadius:0}}},MuiDialog:{styleOverrides:{paper:{borderRadius:0}}}}});function xs(){const[e,r]=m.useState(null),[s,p]=m.useState(new Map),[a,c]=m.useState(!1),[o,i]=m.useState(""),[C,_]=m.useState(!1),[T,f]=m.useState(!1),[D,$]=m.useState(!1),B=_e.useRef(null),W=m.useRef(null),gt=m.useRef(new Map),nt=m.useRef(!1),Y=async()=>{try{const b=await Tn(),v=JSON.stringify(b,null,2),A=new Blob([v],{type:"application/json"}),V=URL.createObjectURL(A),j=document.createElement("a");j.href=V,j.download=`stocks-backup-${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.json`,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(V),i("æ•°æ®å¯¼å‡ºæˆåŠŸ")}catch(b){console.error("å¯¼å‡ºæ•°æ®å¤±è´¥:",b),i("å¯¼å‡ºæ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•")}},L=async b=>{var A;const v=(A=b.target.files)==null?void 0:A[0];if(v)try{const V=await v.text(),j=JSON.parse(V);if(!j||typeof j!="object"){i("å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®");return}f(!0),window.__pendingImportData=j}catch(V){console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",V),i("å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶è¯»å–é”™è¯¯")}finally{B.current&&(B.current.value="")}},at=async()=>{try{const b=window.__pendingImportData;if(!b){i("å¯¼å…¥å¤±è´¥ï¼šæ•°æ®æ— æ•ˆ");return}await Dn(b);const v=await Oe();r(v),f(!1),i("æ•°æ®å¯¼å…¥æˆåŠŸï¼Œé¡µé¢å°†åˆ·æ–°"),setTimeout(()=>{window.location.reload()},1e3)}catch(b){console.error("å¯¼å…¥æ•°æ®å¤±è´¥:",b),i("å¯¼å…¥æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•"),f(!1)}finally{delete window.__pendingImportData}},Z=async()=>{try{const b=await kn();r(b),W.current=b,_(!1),i("æ•°æ®å·²é‡ç½®ä¸ºé»˜è®¤é…ç½®"),window.location.reload()}catch(b){console.error("é‡ç½®æ•°æ®å¤±è´¥:",b),i("é‡ç½®æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•")}};m.useEffect(()=>{(async()=>{try{const v=await Oe();r(v)}catch(v){console.error("åŠ è½½é…ç½®å¤±è´¥:",v)}})()},[]),m.useEffect(()=>{W.current=e},[e]),m.useEffect(()=>{gt.current=s},[s]),m.useEffect(()=>{e&&p(b=>{const v=new Map,A=Object.keys(e.holdings||{});for(const j of A){const q=e.holdings[j],S=Array.isArray(q.transactions)?q.transactions:[],[G,dt]=sn(S),I=b.get(j);v.set(j,{code:j,name:(I==null?void 0:I.name)||j,last_price:(I==null?void 0:I.last_price)??null,last_time:(I==null?void 0:I.last_time)??null,last_update_time:(I==null?void 0:I.last_update_time)||"--",last_change_pct:(I==null?void 0:I.last_change_pct)??0,holding_price:G>0?dt:null,holding_quantity:G,transactions:S,alerts:q.alerts,alert_up:q.alert_up,alert_down:q.alert_down,alert_triggered:(I==null?void 0:I.alert_triggered)??new Set})}const V=Object.keys(e.watchlist||{});for(const j of V){if(v.has(j))continue;const q=e.watchlist[j],S=b.get(j);v.set(j,{code:j,name:(S==null?void 0:S.name)||j,last_price:(S==null?void 0:S.last_price)??null,last_time:(S==null?void 0:S.last_time)??null,last_update_time:(S==null?void 0:S.last_update_time)||"--",last_change_pct:(S==null?void 0:S.last_change_pct)??0,holding_price:null,holding_quantity:0,transactions:[],alerts:q.alerts,alert_up:q.alert_up,alert_down:q.alert_down,alert_triggered:(S==null?void 0:S.alert_triggered)??new Set})}return v})},[e]),m.useEffect(()=>{if(nt.current||a||!e)return;const b=()=>{const v=Array.from(s.keys());if(v.length===0){setTimeout(b,100);return}if(nt.current)return;nt.current=!0,(async()=>{console.log("æ­£åœ¨åˆå§‹åŒ–ï¼Œè·å–è‚¡ç¥¨æ•°æ®...");const V=await $e(v);p(j=>{const q=new Map(j),S=new Date,G=`${S.getHours().toString().padStart(2,"0")}:${S.getMinutes().toString().padStart(2,"0")}:${S.getSeconds().toString().padStart(2,"0")}`;for(const dt of v){const I=q.get(dt);if(I){const st=V.get(dt);if(st){const Ft=st.yesterday_close>0?(st.price-st.yesterday_close)/st.yesterday_close*100:0,rt=an(dt,st.price,I);if(rt.length>0){ln();const zt=rt.map(M=>{const yt=M.type==="up"?"ä¸Šæ¶¨":"ä¸‹è·Œ";return`${st.name}(${dt}) ä»·æ ¼${yt}è‡³ ${st.price.toFixed(2)}ï¼Œè¾¾åˆ°æŠ¥è­¦ä»·æ ¼ ${M.price.toFixed(2)}`}).join("ï¼›");i(zt),cn("è‚¡ç¥¨æŠ¥è­¦",zt)}q.set(dt,{...I,name:st.name,last_price:st.price,last_time:new Date,last_update_time:st.update_time,last_change_pct:Ft})}else q.set(dt,{...I,last_time:new Date,last_update_time:G})}}return q}),c(!0)})()};b()},[e,a,s]),m.useEffect(()=>{if(!a||!e)return;let b=!0;const v=e.update_interval??1e3,A=async()=>{if(!b)return;const j=Array.from(gt.current.keys());if(j.length===0)return;const q=W.current;if(!q||ms())return;const S=j.filter(G=>gs(G,q.market_hours));if(S.length!==0)try{const G=await $e(S);if(!b)return;p(dt=>{const I=new Map(dt),st=new Date,Ft=`${st.getHours().toString().padStart(2,"0")}:${st.getMinutes().toString().padStart(2,"0")}:${st.getSeconds().toString().padStart(2,"0")}`;for(const M of S){const yt=I.get(M);if(yt){const lt=G.get(M);if(lt){const Vt=lt.yesterday_close>0?(lt.price-lt.yesterday_close)/lt.yesterday_close*100:0,Rt=an(M,lt.price,yt);if(Rt.length>0){ln();const vt=Rt.map(Pt=>{const Bt=Pt.type==="up"?"ä¸Šæ¶¨":"ä¸‹è·Œ";return`${lt.name}(${M}) ä»·æ ¼${Bt}è‡³ ${lt.price.toFixed(2)}ï¼Œè¾¾åˆ°æŠ¥è­¦ä»·æ ¼ ${Pt.price.toFixed(2)}`}).join("ï¼›");i(vt),cn("è‚¡ç¥¨æŠ¥è­¦",vt)}I.set(M,{...yt,name:lt.name,last_price:lt.price,last_time:new Date,last_update_time:lt.update_time,last_change_pct:Vt})}else I.set(M,{...yt,last_time:new Date,last_update_time:Ft})}}const rt=$n(),bt=W.current,zt={date:rt,stocks:Array.from(I.values()).map(M=>({code:M.code,name:M.name,price:M.last_price,change_pct:M.last_change_pct,holding_price:M.holding_price,holding_quantity:M.holding_quantity,holding_value:M.last_price!==null&&M.holding_quantity>0?M.last_price*M.holding_quantity:0,profit:M.holding_price!==null&&M.holding_quantity>0&&M.last_price!==null?(M.last_price-M.holding_price)*M.holding_quantity:null})),funds:bt.funds,timestamp:new Date().toISOString()};return An(rt,zt).catch(M=>{console.error("ä¿å­˜å†å²æ•°æ®å¤±è´¥:",M)}),I})}catch(G){console.error("è·å–è‚¡ç¥¨æ•°æ®å¤±è´¥:",G)}};A();const V=setInterval(A,v);return()=>{b=!1,clearInterval(V)}},[a,e==null?void 0:e.update_interval]);const ot=_e.useMemo(()=>{const b=Array.from(s.values()),v=(e==null?void 0:e.stock_order)||[];if(v.length>0){const A=new Map(v.map((V,j)=>[V,j]));return b.sort((V,j)=>{const q=A.get(V.code),S=A.get(j.code);return q!==void 0&&S!==void 0?q-S:q!==void 0?-1:S!==void 0?1:V.code.localeCompare(j.code)})}return b.sort((A,V)=>A.code.localeCompare(V.code))},[s,e==null?void 0:e.stock_order]),Q=async()=>{if(!e)return;const b={...e,privacy_mode:!e.privacy_mode},v=await ve(b);r(v),W.current=v},it=async b=>{const v={...b},A=v.categories||{};let V="æŒä»“";for(const[S,G]of Object.entries(A))if(G.isHoldings===!0){V=S;break}A[V]||(A[V]={codes:[],title:V,color:"#2e7d32",isHoldings:!0});const j=new Set;for(const[S,G]of Object.entries(v.holdings||{})){const dt=Array.isArray(G.transactions)?G.transactions:[],[I]=sn(dt);I>0&&j.add(S)}A[V]={...A[V],codes:Array.from(j)},v.categories=A;const q=await ve(v);r(q),W.current=q};m.useEffect(()=>{if(!e){document.title="--";return}const b=Array.from(s.values()),v=b.reduce((rt,bt)=>bt.last_price!==null&&bt.holding_quantity>0?rt+bt.last_price*bt.holding_quantity:rt,0),A=(e.historical_holdings||[]).reduce((rt,bt)=>rt+bt.transactions.reduce((zt,M)=>zt+M.quantity*M.price,0),0),V=e.funds.available_funds+v+A,j=b.filter(rt=>rt.holding_price!==null&&rt.holding_quantity>0).length,q=V-e.funds.total_original_funds,S=e.funds.total_original_funds>0?q/e.funds.total_original_funds*100:0,G=b.length>0?b.reduce((rt,bt)=>rt+bt.last_change_pct,0)/b.length:0,dt=v>0||j>0,I=dt?G:0,st=dt?q:0,Ft=dt?S:0;if(j>0){const rt=st>=0?"+":"";document.title=`${rt}${st.toFixed(2)}(${Ft>=0?"+":""}${Ft.toFixed(2)}%)`}else document.title=`${I>=0?"+":""}${I.toFixed(2)}%`},[e,s]);const Mt=m.useRef(null),Et=m.useRef(null),Ot=async b=>{try{await new Promise(A=>setTimeout(A,100));const v=await $e([b]);if(v.has(b)){const A=v.get(b);p(V=>{const j=new Map(V);let q=j.get(b);if(!q){const G=W.current.watchlist[b];q={code:b,name:b,last_price:null,last_time:null,last_update_time:"--",last_change_pct:0,holding_price:null,holding_quantity:0,transactions:[],alert_up:(G==null?void 0:G.alert_up)||null,alert_down:(G==null?void 0:G.alert_down)||null,alert_triggered_up:!1,alert_triggered_down:!1}}const S=A.yesterday_close>0?(A.price-A.yesterday_close)/A.yesterday_close*100:0;return j.set(b,{...q,name:A.name,last_price:A.price,last_time:new Date,last_update_time:A.update_time,last_change_pct:S}),j})}}catch(v){console.error("è·å–æ–°æ·»åŠ è‚¡ç¥¨æ•°æ®å¤±è´¥:",v)}};return e?t.jsxs(Qe,{theme:dn,children:[t.jsx(Ye,{}),t.jsxs(Ue,{maxWidth:"xl",sx:{mt:0,mb:0,pb:0,px:0},children:[t.jsx(ns,{stocks:ot,funds:e.funds,privacyMode:e.privacy_mode,onPrivacyModeToggle:Q,config:e,onConfigUpdate:it}),t.jsx(hs,{config:e,onConfigUpdate:it,onStockAdded:Ot,stockStates:new Map(Array.from(s.entries()).map(([b,v])=>[b,{name:v.name,last_price:v.last_price}])),onOpenTransactionDialog:b=>{Mt.current=b},onOpenAllTransactionsDialog:b=>{Et.current=b}}),t.jsx(es,{stocks:ot,privacyMode:e.privacy_mode,config:e,onConfigUpdate:it,onAddTransaction:b=>{Mt.current&&Mt.current(b)},onOpenAllTransactionsDialog:b=>{Et.current&&Et.current(b)},onToggleCategorySidebar:b=>{window.__toggleCategorySidebar=b}}),t.jsx(gn,{open:!!o,autoHideDuration:6e3,onClose:()=>i(""),anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(Ln,{severity:"warning",onClose:()=>i(""),children:o})}),t.jsxs(N,{sx:{mt:3,mb:2,textAlign:"center",display:"flex",gap:2,justifyContent:"center"},children:[t.jsx(F,{variant:"outlined",color:"primary",onClick:()=>$(!0),sx:{textTransform:"none"},children:"æ•°æ®å¯¼å…¥å¯¼å‡º"}),t.jsx(F,{variant:"outlined",color:"error",onClick:()=>_(!0),sx:{textTransform:"none"},children:"é‡ç½®æ‰€æœ‰æ•°æ®"})]}),t.jsx("input",{type:"file",ref:B,accept:".json",style:{display:"none"},onChange:L}),t.jsx(fs,{version:ps}),t.jsxs(St,{open:C,onClose:()=>_(!1),children:[t.jsx(Tt,{children:"ç¡®è®¤é‡ç½®æ•°æ®"}),t.jsx(Ct,{children:t.jsxs(Ae,{children:["æ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ç°æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬è‡ªé€‰è‚¡ã€äº¤æ˜“è®°å½•ã€å†å²æ•°æ®ç­‰ï¼‰ï¼Œå¹¶ç”¨é»˜è®¤é…ç½®è¦†ç›–ã€‚",t.jsx("br",{}),t.jsx("strong",{children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼"})]})}),t.jsxs(Dt,{children:[t.jsx(F,{onClick:()=>_(!1),children:"å–æ¶ˆ"}),t.jsx(F,{onClick:Z,color:"error",variant:"contained",children:"ç¡®è®¤é‡ç½®"})]})]}),t.jsxs(St,{open:D,onClose:()=>$(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(Tt,{children:"æ•°æ®å¯¼å…¥å¯¼å‡º"}),t.jsxs(Ct,{children:[t.jsxs(Ae,{sx:{mb:3},children:["æœ¬é¡¹ç›®ä¸ä¼šä¸Šä¼ ä»»ä½•æ•°æ®åˆ°äº’è”ç½‘ï¼Œæ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ã€‚",t.jsx("br",{}),"å¦‚æœ‰å¤šè®¾å¤‡ä½¿ç”¨ï¼Œè¯·è‡ªè¡Œé€šè¿‡å¯¼å…¥å¯¼å‡ºåŠŸèƒ½åŒæ­¥æ•°æ®ã€‚"]}),t.jsxs(N,{sx:{display:"flex",gap:2,justifyContent:"center",mt:2},children:[t.jsx(F,{variant:"contained",color:"primary",onClick:()=>{$(!1),Y()},sx:{textTransform:"none"},children:"å¯¼å‡ºæ•°æ®"}),t.jsx(F,{variant:"contained",color:"primary",onClick:()=>{var b;$(!1),(b=B.current)==null||b.click()},sx:{textTransform:"none"},children:"å¯¼å…¥æ•°æ®"})]})]}),t.jsx(Dt,{children:t.jsx(F,{onClick:()=>$(!1),children:"å…³é—­"})})]}),t.jsxs(St,{open:T,onClose:()=>f(!1),children:[t.jsx(Tt,{children:"ç¡®è®¤å¯¼å…¥æ•°æ®"}),t.jsx(Ct,{children:t.jsxs(Ae,{children:["æ­¤æ“ä½œå°†æ¸…ç©ºæ‰€æœ‰ç°æœ‰æ•°æ®ï¼Œå¹¶ç”¨å¯¼å…¥çš„æ•°æ®è¦†ç›–ã€‚",t.jsx("br",{}),t.jsx("strong",{children:"æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼"})]})}),t.jsxs(Dt,{children:[t.jsx(F,{onClick:()=>{f(!1),delete window.__pendingImportData},children:"å–æ¶ˆ"}),t.jsx(F,{onClick:at,color:"primary",variant:"contained",children:"ç¡®è®¤å¯¼å…¥"})]})]})]})]}):t.jsxs(Qe,{theme:dn,children:[t.jsx(Ye,{}),t.jsx(Ue,{maxWidth:"xl",sx:{mt:2,mb:2},children:t.jsx(J,{children:"åŠ è½½é…ç½®ä¸­..."})})]})}function ys(e){try{const r=JSON.parse(e),s={privacy_mode:r.privacy_mode||!1,funds:r.funds||{available_funds:0,total_original_funds:0},market_hours:r.market_hours||{Aè‚¡:{enabled:!0,morning:{start:"09:30",end:"11:30"},afternoon:{start:"13:00",end:"15:00"},weekdays:[1,2,3,4,5]},ç¾è‚¡:{enabled:!1,morning:{start:"22:30",end:"05:00"},afternoon:null,weekdays:[1,2,3,4,5]}},stocks:r.stocks||{}};return ve(s).catch(p=>{console.error("ä¿å­˜é…ç½®å¤±è´¥:",p)}),!0}catch(r){return console.error("å¯¼å…¥é…ç½®å¤±è´¥:",r),!1}}typeof window<"u"&&(window.importStockConfig=ys);"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission();Vn.createRoot(document.getElementById("root")).render(t.jsx(_e.StrictMode,{children:t.jsx(xs,{})}));export{sn as c,Xn as f,Me as l};
