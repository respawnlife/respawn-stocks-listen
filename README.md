# 股票投资管理系统

一个基于 React + TypeScript 的股票投资管理 Web 应用，提供实时股价监控、交易记录管理、持仓统计、K线图分析等功能。

## 功能特性

### 📊 实时股价监控
- 自动批量获取自选股票的实时价格
- 支持自定义更新频率（1秒/3秒/5秒/10秒）
- 仅在交易时间内自动更新
- 显示涨跌幅、涨跌额等实时数据

### 📈 持仓管理
- **自选股票管理**：添加/删除自选股票
- **持仓统计**：实时计算持仓市值、盈亏、仓位比例
- **成本价计算**：基于买入卖出交易自动计算持仓成本价
- **持仓数量**：自动统计持仓股票数量

### 💰 交易记录管理
- **买入/卖出交易**：记录每笔交易的股票代码、时间、数量、总金额
- **交易列表**：查看所有交易记录（包括历史持仓）
- **交易编辑**：支持修改和删除交易记录
- **交易筛选**：按股票、时间范围、金额筛选交易
- **交易类型标识**：清晰显示买入/卖出类型

### 📉 K线图分析
- **多周期支持**：日K、周K、月K
- **数据范围**：
  - 日K：显示最近60天
  - 周K：显示最近180天
  - 月K：显示最近3年
- **交易标记**：在K线图上标记买入/卖出点
- **价格参考线**：
  - 当前持仓成本价（蓝色虚线）
  - 最高价、最低价、平均价（黑色虚线，可切换显示）
- **交互提示**：鼠标悬停显示详细价格信息和交易记录

### 🔔 价格报警
- **多规则支持**：为每只股票设置多个价格报警规则
- **上涨/下跌报警**：分别设置上涨和下跌触发价格
- **实时监控**：自动检测价格变化并触发报警
- **通知提醒**：支持浏览器通知和声音提醒

### 💵 资金管理
- **本金管理**：记录和调整总本金
- **可用资金**：实时跟踪可用资金变化
- **资金统计**：
  - 实时市值 = 可用资金 + 持仓市值
  - 总盈亏 = 实时市值 - 总本金
  - 仓位比例 = 持仓市值 / 实时市值

### 🔒 隐私模式
- 一键切换隐私模式，隐藏关键敏感数据
- 配置自动保存到本地存储

### 📤 数据管理
- **数据导出**：导出所有配置和交易数据为 JSON 文件
- **数据导入**：从 JSON 文件导入数据（覆盖现有数据）
- **数据重置**：一键重置为初始样例数据
- **本地存储**：所有数据存储在浏览器 IndexedDB 中，无需服务器

### 📱 其他功能
- **响应式设计**：适配不同屏幕尺寸
- **紧凑型UI**：优化界面布局，信息密度高
- **页面标题动态更新**：根据盈亏或涨跌幅自动更新
- **历史交易记录**：永久保存所有交易记录，支持查看历史持仓

## 技术栈

- **前端框架**：React 18 + TypeScript
- **UI 组件库**：Material-UI (MUI)
- **图表库**：lightweight-charts
- **构建工具**：Vite
- **数据存储**：IndexedDB
- **数据源**：腾讯股票 API、东方财富 API

## 项目结构

```
frontend/
├── src/
│   ├── components/          # React 组件
│   │   ├── ActionBar.tsx     # 操作栏（添加自选、交易等）
│   │   ├── Statistics.tsx    # 统计信息展示
│   │   ├── StockTable.tsx    # 股票列表表格
│   │   ├── KlineChart.tsx    # K线图组件
│   │   └── Footer.tsx        # 页脚
│   ├── services/             # 服务层
│   │   ├── indexedDB.ts      # IndexedDB 数据操作
│   │   ├── storage.ts        # 配置存储管理
│   │   ├── stockData.ts      # 股票数据获取
│   │   └── klineData.ts      # K线数据获取
│   ├── utils/                # 工具函数
│   │   ├── calculations.ts   # 计算函数（成本价、盈亏等）
│   │   ├── tradingTime.ts    # 交易时间判断
│   │   └── alert.ts          # 报警功能
│   ├── types/                # TypeScript 类型定义
│   ├── config/               # 配置文件
│   └── App.tsx               # 主应用组件
```

## 安装与运行

### 环境要求
- Node.js 18+ 或 Bun
- 现代浏览器（支持 IndexedDB）

### 安装依赖
```bash
cd frontend
bun install
# 或
npm install
```

### 开发模式
```bash
bun run dev
# 或
npm run dev
```

### 构建生产版本
```bash
bun run build
# 或
npm run build
```

构建产物位于 `docs/` 目录，可直接部署到静态网站托管服务（如 GitHub Pages）。

## 使用说明

### 添加自选股票
1. 点击操作栏的 "+ 自选" 按钮
2. 输入股票代码（如：002255）
3. 系统会自动验证股票代码并获取股票信息
4. 验证成功后自动添加到自选列表

### 添加交易记录
1. 点击操作栏的 "🛒 交易" 按钮，或点击股票列表中的 "交易" 链接
2. 选择股票（可从自选列表选择或输入新代码）
3. 填写交易信息：
   - 时间（默认当前时间）
   - 数量（正数为买入，负数为卖出）
   - 总金额（必填，系统自动计算单价）
4. 保存后自动更新持仓和资金

### 查看K线图
1. 点击股票列表中的 "K图" 按钮
2. 选择周期（日K/周K/月K）
3. 查看价格走势和交易标记点
4. 可切换显示价格参考线

### 设置价格报警
1. 点击股票列表中的 "报警" 按钮
2. 添加报警规则（上涨/下跌 + 价格）
3. 可添加多条规则
4. 保存后自动监控价格变化

### 数据导入导出
1. 点击页面底部的 "数据导入导出" 按钮
2. 导出：点击 "导出数据" 下载 JSON 文件
3. 导入：点击 "导入数据" 选择 JSON 文件（会覆盖现有数据）

## 数据存储

所有数据存储在浏览器的 IndexedDB 中，包括：
- **watchlist 表**：自选股票列表
- **transactions 表**：所有交易记录
- **config 表**：主配置（资金、更新频率等）
- **history 表**：历史数据

数据完全本地存储，不会上传到任何服务器。

## 注意事项

1. **交易时间**：系统仅在交易时间内自动更新股价（工作日 9:30-11:30, 13:00-15:00）
2. **数据精度**：价格显示保留2位小数，交易金额保留3位小数
3. **成本价计算**：基于买入卖出净额和净数量计算：`(买入总金额 - 卖出总金额) / (买入总股数 - 卖出总股数)`
4. **历史记录**：删除自选股票时，可选择保留交易记录到历史持仓
5. **数据备份**：建议定期导出数据备份，以防浏览器数据丢失

## 许可证

MIT License
